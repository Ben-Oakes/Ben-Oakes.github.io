function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}!function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},n=i[e]=i[e]||[];return n.indexOf(t)==-1&&n.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{},n=i[e]=i[e]||{};return n[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var n=i.indexOf(t);return n!=-1&&i.splice(n,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var n=0,s=i[n];t=t||[];for(var o=this._onceEvents&&this._onceEvents[e];s;){var r=o&&o[s];r&&(this.off(e,s),delete o[s]),s.apply(this,t),n+=r?0:1,s=i[n]}return this}},e}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("lib/imagesLoaded",["ev-emitter/ev-emitter"],function(i){return t(e,i)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter")):e.imagesLoaded=t(e,e.EvEmitter)}(window,function(e,t){function i(e,t){for(var i in t)e[i]=t[i];return e}function n(e){var t=[];if(Array.isArray(e))t=e;else if("number"==typeof e.length)for(var i=0;i<e.length;i++)t.push(e[i]);else t.push(e);return t}function s(e,t,o){return this instanceof s?("string"==typeof e&&(e=document.querySelectorAll(e)),this.elements=n(e),this.options=i({},this.options),"function"==typeof t?o=t:i(this.options,t),o&&this.on("always",o),this.getImages(),a&&(this.jqDeferred=new a.Deferred),void setTimeout(function(){this.check()}.bind(this))):new s(e,t,o)}function o(e){this.img=e}function r(e,t){this.url=e,this.element=t,this.img=new Image}var a=e.jQuery,h=e.console;s.prototype=Object.create(t.prototype),s.prototype.options={},s.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},s.prototype.addElementImages=function(e){"IMG"==e.nodeName&&this.addImage(e),this.options.background===!0&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&c[t]){for(var i=e.querySelectorAll("img"),n=0;n<i.length;n++){var s=i[n];this.addImage(s)}if("string"==typeof this.options.background){var o=e.querySelectorAll(this.options.background);for(n=0;n<o.length;n++){var r=o[n];this.addElementBackgroundImages(r)}}}};var c={1:!0,9:!0,11:!0};return s.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var i=/url\((['"])?(.*?)\1\)/gi,n=i.exec(t.backgroundImage);null!==n;){var s=n&&n[2];s&&this.addBackground(s,e),n=i.exec(t.backgroundImage)}},s.prototype.addImage=function(e){var t=new o(e);this.images.push(t)},s.prototype.addBackground=function(e,t){var i=new r(e,t);this.images.push(i)},s.prototype.check=function(){function e(e,i,n){setTimeout(function(){t.progress(e,i,n)})}var t=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(t){t.once("progress",e),t.check()}):void this.complete()},s.prototype.progress=function(e,t,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&h&&h.log("progress: "+i,e,t)},s.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred){var t=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[t](this)}},o.prototype=Object.create(t.prototype),o.prototype.check=function(){var e=this.getIsImageComplete();return e?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},o.prototype.getIsImageComplete=function(){return this.img.complete&&void 0!==this.img.naturalWidth},o.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.img,t])},o.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},o.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},o.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},o.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},r.prototype=Object.create(o.prototype),r.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url;var e=this.getIsImageComplete();e&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},r.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},r.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},s.makeJQueryPlugin=function(t){t=t||e.jQuery,t&&(a=t,a.fn.imagesLoaded=function(e,t){var i=new s(this,e,t);return i.jqDeferred.promise(a(this))})},s.makeJQueryPlugin(),s});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();define("banner/banner",["lib/lodash","lib/jquery/full","backbone","lib/imagesLoaded"],function(e,t,i,n){"use strict";function s(){var t=["#site-xpromo-banner","#eu-cookie-warning-banner","#partner-banner"],i=[];if(t.forEach(function(e){var t=o(e);t&&i.push(t)}),!i.length)return!1;var n=e.some(i,function(e){return e.hasActiveBanner()===!0});return n}function o(e){var i=t(e);if(i.length){var n=new r({el:i});return n.initializeBanner(),n}}var r=function(i){function s(){return _classCallCheck(this,s),_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return _inherits(s,i),_createClass(s,[{key:"initializeBanner",value:function(){var e=this.$el.find(".js-page-banner-link");return this.machineName=e.data("banner"),this.dismissable=this.$el.find(".js-dismiss-button").length>0,this.dismissed=this.dismissable&&this.getDismissedFromLocalStorage(),this.$bannerEl=this.$el,this.dismissed?void this.remove():(this.onReveal(),void(this.$el.hasClass("js-is-sticky")&&this.initializeSticky()))}},{key:"hasActiveBanner",value:function(){return this.machineName&&!this.dismissed}},{key:"initializeSticky",value:function(){e.bindAll(this,"onScroll"),this.$el.addClass("is-stuck"),this.$el.hasClass("top")&&(t(window).on("scroll",this.onScroll),t(window).on("resize",this.onScroll))}},{key:"uninitializeSticky",value:function(){this.$el.hasClass("top")&&(t(window).off("scroll",this.onScroll),t(window).off("resize",this.onScroll))}},{key:"onScroll",value:function(){var e=0,i=["div","nav"];i.forEach(function(i){var n=t(i).filter(function(e,i){var n="fixed"===t(i).css("position"),s=i.className.indexOf("sticky")>-1||i.className.indexOf("stuck")>-1,o="0px"===t(i).css("top");return n&&s&&o});n.each(function(i,n){e+=t(n).height()})}),this.$bannerEl.css("top",e)}},{key:"onReveal",value:function(){var e=this;this.$bannerEl.hasClass("hidden")&&(this.$bannerEl.removeClass("hidden"),this.$bannerEl.hasClass("alert-banner")?this.$bannerEl.removeClass("fadeout"):n(this.$bannerEl,{background:!0},function(){e.$bannerEl.removeClass("fadeout")}))}},{key:"onDismiss",value:function(e){var t=this;e&&e.preventDefault(),this.$bannerEl.addClass("fadeout"),this.$bannerEl.on("transitionend",function(){t.uninitializeSticky(),t.remove()}),this.saveDismissedToLocalStorage()}},{key:"getDismissedFromLocalStorage",value:function(){return"dismissed"===localStorage.getItem(this.machineName)}},{key:"saveDismissedToLocalStorage",value:function(){localStorage.setItem(this.machineName,"dismissed")}}]),s}(i.View);return r.prototype.events={"click .js-dismiss-button":"onDismiss"},{init:s,initWithId:o,XPromoBannerView:r}});
//# sourceMappingURL=banner.js.map