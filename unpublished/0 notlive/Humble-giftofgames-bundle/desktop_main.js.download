function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}define("constants/csrfConstants",["require"],function(e){return{CSRF_COOKIE_KEY:"csrf_cookie",CSRF_COOKIE_VERSION:1,CSRF_FORM_KEY:"_le_csrf_token",CSRF_HEADER_KEY:"CSRF-Prevention-Token"}}),define("pubsub",["backbone","underscore"],function(e,t){"use strict";var n=function(){t.extend(this,e.Events),this._store={},this.subscribe=function(e,n){t.has(this._store,e)&&n.apply(null,this._store[e]),this.on(e,n)},this.publish=function(e){var t=Array.prototype.slice.call(arguments,1);this._store[e]=t,this.trigger.apply(this,arguments)},t.bindAll(this,"subscribe","publish")};return n}),define("charity/helpers",["constants/csrfConstants","pubsub"],function(e,t){function n(){var t=e.CSRF_COOKIE_KEY+"=",n=document.cookie.lastIndexOf(t)+t.length,i=document.cookie.slice(n);return i&&i.split(";")[0]}function i(t,i,s){t[e.CSRF_FORM_KEY]=n(),$.ajax({type:"POST",url:"/api/v1/user/charity",data:t,error:s,success:i})}function s(t,i){var s={};s[e.CSRF_HEADER_KEY]=n(),$.ajax({type:"DELETE",url:"/api/v1/user/charity",headers:s,error:i,success:t})}return{BODY_SEARCH_PAGE_SIZE:14,ORDER_FORM_SEARCH_PAGE_SIZE:6,DEFAULT_CHARITY_IMAGE:"https://humblebundle-a.akamaihd.net/misc/files/hashed/c046248875f8bbb55008e8d80911cda882721762.gif",charityPubSub:new t,updateUserCharity:i,removeUserCharity:s}});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("bundle/models/User",["require","backbone","charity/helpers"],function(e){"use strict";var t=e("backbone"),n=e("charity/helpers"),i=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"updateCharity",value:function(e){var t=this;if(this.get("is_logged_in"))if(e){var i={charity_id:e};n.updateUserCharity(i,function(){return t.set("charity_api_success",!0)},function(){return t.set("charity_api_success",!1)})}else n.removeUserCharity(function(){return t.set("charity_api_success",!0)},function(){return t.set("charity_api_success",!1)});this.set("charity_id",e||this.featuredCharityId)}}]),t}(t.Model);return i}),define("charity/models",["backbone"],function(e){var t=e.Model.extend({idAttribute:"charity_id",defaults:{human_name:"",logo_url:"",charity_id:"",featured:!1}}),n=e.Collection.extend({model:t,comparator:function(e){return e.get("human_name")}});return{Charity:t,CharityList:n}}),define("lib/hbTemplate!charity/templates/selectionError.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"  <div class='charity-selection-message'>\n    <h1>Loading failed</h1>\n    <p>You may have a connection problem, or our server may be experiencing issues.</p>\n  </div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!charity/templates/selectionLoading.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"  <div class='charity-selection-message'>\n    <img src='xSTATIC_URLx/static/hashed/26faf55c6e36ba3b1a57f9001942059fe05050f2.gif' alt='' />\n    <h1>Loading…</h1>\n  </div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!charity/templates/selectionNoResults.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"  <div class='charity-selection-message'>\n    <h1>No results.</h1>\n  </div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("charity/baseViews",["backbone","charity/helpers","util/main","hbtemplate!./templates/selectionError.html","hbtemplate!./templates/selectionLoading.html","hbtemplate!./templates/selectionNoResults.html"],function(e,t,n,i,s,a){"use strict";var o=_.template(i),r=_.template(s),l=_.template(a),c=e.View.extend({className:"charity-preview",events:{"click .js-remove-charity":"removeCharity"},initialize:function(e){this.options=e,_.bindAll(this,"render","select_this_charity","removeCharity"),this.constants=this.options.constants,this.is_disallowed=e.is_disallowed,this.pubSub=t.charityPubSub,this.rendered=!1},render:function(){this.rendered=!0,this.model.disableSelection||this.$(".js-select-charity").on("click",this.select_this_charity),this.is_disallowed&&this.$el.addClass("is-disallowed"),_.each(this.$(".charity-img"),function(e){n.preload_background_image_with_default(e,t.DEFAULT_CHARITY_IMAGE)})},get_template_params:function(){var e=this.model.toJSON();return e.url=e.url||"",e.country=this.constants.CHARITY_SEARCH_PARAMS.country[this.model.get("country")],e.is_disallowed=this.is_disallowed,e.current_url=window.location.origin+window.location.pathname,e},select_this_charity:function(e){e.preventDefault(),e.stopPropagation(),!this.is_disallowed&&this.model&&this.pubSub.publish("set_charity",{current_charity_is_random:!1,current_charity:this.model})},removeCharity:function(){this.pubSub.publish("set_charity",{remove_charity:!0,current_charity_is_random:!0})}}),u=e.View.extend({tagName:"div",className:"charity-list",events:{},initialize:function(e){this.options=e,_.bindAll(this,"render","renderCharityPreview"),this.constants=this.options.constants,this.pubSub=this.options.pubSub,this.featuredCharityId=this.options.featuredCharityId},render:function(){var e=this;return this.$el.empty(),this.collection.each(function(t){e.$el.append(e.renderCharityPreview(_.extend(t,{disableSelection:e.options.disableSelection})))}),this.delegateEvents(),this.el}}),d=e.View.extend({initialize:function(e){this.pubSub=e.pubSub,this.last_sent_request_id=0,this.last_received_request_id=-1,this.UNITED_STATES="US",this.num_results=0,this.page=1,this.PAGE_SIZE=void 0,_(this).bindAll("handleServerResponse","handleCountryChange","showNoResultsState","showLoadingState","showErrorState")},handleServerResponse:function(e){var t=Math.min(1e3,e.num_results);return this.num_results=t,0==e.results.length?void this.showNoResultsState():(1==e.num_results?this.$(".js-results-heading").text(e.num_results+" result for search"):e.num_results>1e3?(this.$(".js-results-heading").text("1000+ results"),this.$(".js-results-heading-disclaimer").show()):this.$(".js-results-heading").text(e.num_results+" results for search"),this.collection.add(e.results),this.search_results_collection.reset(e.results),void this.renderSearchResults())},handleCountryChange:function(){var e=this.$(".js-country-label"),t=this.$(".js-state-label"),n=this.$(".js-charity-country");n.val()==this.UNITED_STATES?(t.addClass("is-united-states"),e.addClass("is-united-states")):(t.removeClass("is-united-states"),e.removeClass("is-united-states"))},showLoadingState:function(){this.$(".js-results-heading").text(""),this.$(".js-results-heading-disclaimer").hide();var e=this.$(".js-charity-results");e.html(r({}))},showErrorState:function(){this.$(".js-results-heading").text("");var e=this.$(".js-charity-results");e.html(o({}))},showNoResultsState:function(){this.$(".js-results-heading").text("0 results for search");var e=this.$(".js-charity-results");e.html(l({}))},searchCharities:function(e){var t=this,n=5;e.page-=1;var i=function(n){e.request=++t.last_sent_request_id,t.showLoadingState(),$.ajax({type:"GET",url:"/api/v1/charity/search",data:e,error:function(){0===n?t.showErrorState():i(n-1)},success:function(e){var n=parseInt(e.request);n>t.last_received_request_id?(t.last_received_request_id=n,t.handleServerResponse(e)):console.log("ignoring")}})};i(n)}});return{BaseCharityPreviewView:c,BaseCharityListView:u,BaseSelectionView:d}}),define("util/templating",["module","underscore","util/main"],function(e,t,n){"use strict";function i(e,n){return e.replace(/<%\s*include\(\s*['"]([^'"]+)['"](?:\s*,\s*({[^}]+}))?\s*\)\s*%>/g,function(e,s,a){if(t.contains(n,s))throw new Error("Cycle detected: "+s);var o=document.getElementById(s),r=o?o.innerHTML:"";a&&(r="<% with("+a+") { %>"+r+"<% } %>");var l=n.slice(0);return l.push(s),i(r.trim(),l)})}function s(e,t){t=t||{};var n=document.getElementById(e);if(!n)throw new Error('no template with id "'+e+'"');var i=n?n.innerHTML:"";return a(i,t)}function a(e,n){n=t.extend({},n);var s=i(e.trim(),[]),e=t.template(s);t.extend(n,l);try{return e(n)}catch(e){throw Raven.captureException(e),e}}var o=function(e){return t.template(i(jQuery(e).html().trim(),[]))},r=e.config().STATIC_URL,l={STATIC_URL:r,moneyfmt:n.moneyfmt};return{renderTemplateId:s,renderTemplate:a,getTemplate:o}}),define("lib/hbTemplate!common/modal/templates/ModalView.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="display-modal-overlay"></div>\n<div class="display-modal" id="display-modal">\n  <div class="display-modal-inside" id="display-modal-inside"></div>\n  <div class="close-button"><i class="hb hb-times"></i></div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("common/modal/templates/all",["require","util/templating","hbtemplate!./ModalView.html"],function(e){"use strict";function t(e){return function(t){return n.renderTemplate(e,t)}}var n=e("util/templating"),i=e("hbtemplate!./ModalView.html");return{ModalView:t(i)}});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("common/modal/views/ModalView",["require","backbone","common/modal/templates/all"],function(e){"use strict";var t=e("backbone"),n=e("common/modal/templates/all"),i=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"attachSubview",value:function(e){this.subview=e,this.$("#display-modal-inside").html(this.subview.render().$el)}},{key:"closeModal",value:function(){this.trigger("onRemove"),this.subview&&this.subview.remove(),this.remove()}},{key:"render",value:function(){$("body").append(this.$el),this.$el.html(this.template)}}]),t}(t.View);return i.prototype.template=n.ModalView,i.prototype.events={"click .close-button":"closeModal"},i}),define("lib/hbTemplate!charity/templates/bundleCTA.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="charity-support">\n  <div class="charity-highlight">\n  <% if (typeof logo_url !== "undefined" && typeof heading !== "undefined") { %>\n    <div class="charity-item">\n      <div class="charity-image-wrapper charity-img js-selected-charity-info" style="background-image:url(<%- logo_url %>)"></div>\n      <div class="bottom-right js-cyoc-cta"><i class="hb hb-pencil charity-edit"></i></div>\n    </div>\n    <div class="charity-description">\n      <h4><%= heading %></h4>\n      <p>If you would like to support a different charity, <a href="javascript:void(0)" class="js-cyoc-cta">select a new one</a> from our database of thousands.</p>\n    </div>\n  <% } else { %>\n    <div class="charity-item none-chosen">\n      <div class="charity-image-wrapper charity-img" style="background-color: grey;text-align: center;font-size: 24px;">Select a charity</div>\n      <div class="bottom-right js-cyoc-cta"><i class="hb hb-pencil charity-edit"></i></div>\n    </div>\n    <div class="charity-description">\n      <p>If you would like to support a different charity, <a href="javascript:void(0)" class="js-cyoc-cta">select a new one</a> from our database of thousands.</p>\n    </div>\n  <% } %>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!charity/templates/charityCTAMessage.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="charity-account-cta-message">\n      <p>\n<% if (success) { %>\n      <strong>Selection updated.</strong> Your selection has been saved to your account for future purchases.\n<% } else { %>\n      <strong>An error occurrred while saving your charity selection.</strong> However, your selection is still set for your current purchase.\n<% } %>\n      </p>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!charity/templates/slideOutHolder.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div>\n  <div class="js-cyoc-cta"></div>\n</div>\n<div class="slideout-expandable js-cyoc-selector-slide cyoc-selector-slide">\n  <div>\n    <div class="selected-game-arrow top-arrow"></div>\n    <div class="js-cyoc-select-holder charity-selection"></div>\n  </div>\n</div>\n<div class="js-charity-details-popup-holder charity-details-popup-holder"></div>\n'.replace(/xSTATIC_URLx/g,t);
}()}),define("lib/hbTemplate!charity/templates/selectionView.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<% if (isModal) { %>\n  <h1>Select a charity</h1>\n<% } %>\n    <h2>Charity Search</h2>\n    <div class=\"js-featured-charities-holder\"></div>\n    <div class='charity-search js-charity-search'>\n      <label class='query'>\n        <input type='text' name='search' class='js-charity-query' placeholder='Search names or keywords'>\n        <i class='hb hb-search'></i>\n      </label><label class='category'>Category\n        <select name='category' class='js-charity-category'>\n          <option value='' selected>All</option>\n<% _.each(categories, function(val, key) { %>\n          <option value='<%- key %>'><%- val %></option>\n<% }); %>\n        </select>\n      </label><label class='country js-country-label'>Country\n        <select name='country' class='js-charity-country'>\n          <option value='' selected>All</option>\n<% _.each(countries, function(val, key) { %>\n          <option value='<%- key %>'><%- val %></option>\n<% }); %>\n        </select>\n      </label><label class='state js-state-label'>State\n        <select name='state' class='js-charity-state'>\n          <option value='' selected>All</option>\n<% _.each(_.sortBy(_.pairs(states), function(tuple) { return tuple[1]; }), function(tuple) { %>\n          <option value='<%- tuple[0] %>'><%- tuple[1] %></option>\n<% }); %>\n        </select>\n      </label><button class='js-submit-search' type='submit'>Search</button>\n    </div>\n    <h3 class='js-results-heading results-heading'>Suggested charities</h3>\n    <h4 class='js-results-heading-disclaimer results-heading-disclaimer'>Note: only 1000 results are displayed per search</h4>\n    <div class='js-charity-results charity-results'></div>\n    <div class=\"partnership-line\">In partnership with <a href=\"https://www.paypal.com/givingfund/\" target=\"_blank\">PayPal Giving Fund</a></div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!charity/templates/charityPreview.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'  <div class="js-see-details charity-img" style="background-image: url(\'<%= logo_url %>\');"></div>\n  <div class="charity-name">\n    <a class="js-see-details see-details" data-charity-id="<%= charity_id %>">\n      <h4 title="<%= human_name %>"><%= human_name %></h4>\n      <h5 class="location"><% if (country == \'United States\') {  %><%- city %>, <%- state %><% } else { %><%- country %><% } %></h5>\n    </a>\n    <button class="\n      select-charity\n      js-select-charity\n  <% if (featured && is_selected) { %>\n      is-featured\n  <% } else if (is_selected) { %>\n      is-selected\n  <% } else if (featured) { %>\n      is-unselected-featured\n  <% } %>\n  <% if (is_disallowed) { %>\n      is-disallowed\n  <% } %>\n    ">\n      <span class="selected-text">Selected</span>\n      <span class="featured-text">Featured</span>\n      <span class="unselected-text">Select</span>\n      <span class="disallowed-text">Default</span>\n    </button>\n  <% if (is_selected && !featured) { %>\n    <br>\n    <button class="js-remove-charity" title="Defer to our monthly featured charity">\n      <span>Remove</span>\n    </button>\n  <% } %>\n  </div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!charity/templates/charityPopUp.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="charity-popup">\n  <div class="close-button-holder">\n    <img class="js-close close-button" src="xSTATIC_URLx/static/hashed/c0ff4994a7eb5d28cbb610f9dd515b08e3fdb8d1.png" alt="">\n  </div>\n  <div class=\'charity-info-wrapper\'>\n    <% if (logo_url) { %>\n      <img class="charity-logo" src="<%= logo_url %>"/>\n    <% } %>\n    <div class=\'charity-title\'>\n      <h2><%= human_name %></h2>\n    </div>\n  <% if (charity_id) { %>\n      <p class=\'charity-info\'><strong>Category:</strong> <i><%= category %></i></p>\n      <p class=\'charity-info\'><strong>Location:</strong>\n        <i>\n    <% if (country == \'United States\') { %>\n          <%- city %>, <%- state %>\n    <% } else { %>\n          <%- country %>\n    <% } %>\n        </i>\n      </p>\n  <% } %>\n  <% if (url) { %>\n      <a class=\'charity-link\' href=\'<%= url %>\' rel="nofollow" target="_blank">Visit their website</a>\n  <% } %>\n      <div class=\'charity-description\'>\n  <% if (ppgf_disclaimer) { %>\n        <em>Payments to <%= human_name %> are made via the <a href="https://support.humblebundle.com/hc/en-us/articles/205183597" target="_blank">PayPal Giving Fund</a>.</em><br /><br />\n  <% } %>\n        <%= description %>\n      </div>\n  <% if (charity_id) { %>\n      <p class=\'charity-info\'>\n        <strong>Recommend this charity</strong><br>\n        Use this link to refer a friend to this bundle in support of <%= human_name %>:<br>\n        <a href="<%= current_url %>?charity=<%= charity_id %>" rel="nofollow"><%= current_url %>?charity=<%= charity_id %></a>\n      </p>\n  <% } %>\n  </div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("charity/templates/bundle",["underscore","hbtemplate!./bundleCTA.html","hbtemplate!./charityCTAMessage.html","hbtemplate!./slideOutHolder.html","hbtemplate!./selectionView.html","hbtemplate!./charityPreview.html","hbtemplate!./charityPopUp.html"],function(e,t,n,i,s,a,o){return{bundleCTA:e.template(t),charityCTAMessage:e.template(n),slideOutHolder:e.template(i),selectionView:e.template(s),charityPreview:e.template(a),charityPopUp:e.template(o)}}),define("lib/hbTemplate!pagination/templates/paginationControls.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<% if (totalPages > 1) { %>\n<div class="pagination">\n  <% var lastRendered = 0 %>\n  <% if (currentPage !== 0) { %>\n  <div class="js-jump-to-page jump-to-page" data-index="<%= currentPage - 1 %>"><i class="hb hb-chevron-left"></i></div>\n  <% } %>\n  <% for (var i = 0; i < totalPages; i++) { %>\n    <% var shouldShow = indicesToShow.indexOf(i) !== -1 %>\n    <% if (shouldShow) { %>\n      <% if (i - lastRendered > 1) { %>\n    ...\n      <% } %>\n      <% lastRendered = i %>\n  <div class="js-jump-to-page jump-to-page<% if (i === currentPage) { %> current<% } %>" data-index="<%= i %>"><%= i + 1 %></div>\n    <% } %>\n  <% } %>\n  <% if (currentPage !== totalPages - 1) { %>\n  <div class="js-jump-to-page jump-to-page" data-index="<%= currentPage + 1 %>"><i class="hb hb-chevron-right"></i></div>\n  <% } %>\n</div>\n<% } %>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("pagination/pagination",["lib/lodash","jquery","hbtemplate!./templates/paginationControls.html"],function(e,t,n){"use strict";function i(e,t,n){n=n||o;var i=n*t;return{controls:s(e.length,t,n),pageItems:e.slice(i,i+n)}}function s(e,t,n){n=n||o;var i=Math.ceil(e/n),s=[0,1,i-1,i-2,t-1,t,t+1];return r({totalPages:i,currentPage:t,indicesToShow:s})}function a(e){return parseInt(t(e.target).closest(".js-jump-to-page").data("index"))}var o=20,r=e.template(n);return{paginate:i,parseClick:a,renderControls:s}}),define("charity/bundle",["backbone","lib/lodash","charity/helpers","charity/models","charity/baseViews","common/modal/views/ModalView","./templates/bundle","pagination/pagination","util/main"],function(e,t,n,i,s,a,o,r,l){"use strict";var c=s.BaseCharityPreviewView.extend({events:{"click .js-see-details":"seeDetails","click .js-select-charity":"select_this_charity","click .js-remove-charity":"removeCharity"},initialize:function(e){s.BaseCharityPreviewView.prototype.initialize.call(this,e),t.bindAll(this,"render","select_this_charity","removeCharity","seeDetails"),this.user=e.user,this.listenTo(this.user,"change:charity_id",this.render)},render:function(){var e=this.get_template_params();return e.is_selected=this.user.get("charity_id")===this.model.id,this.$el.html(o.charityPreview(e)),s.BaseCharityPreviewView.prototype.render.call(this),this.el},select_this_charity:function(){this.user.updateCharity(this.model&&this.model.id)},removeCharity:function(){this.user.updateCharity(null)},seeDetails:function(){new u({el:$(".grayout-inner"),constants:this.constants,model:this.model,user:this.user})}}),u=c.extend({initialize:function(e){this.constants=e.constants,this.user=e.user,this.render()},events:t.assignIn(c.prototype.events,{click:"stop_propagation","click .js-close":"close"}),get_template_params:function(){var e=s.BaseCharityPreviewView.prototype.get_template_params.call(this);return e.ppgf_disclaimer=this.model.get("ppgf_disclaimer"),e},render:function(){var e=$(".grayout");e.show();var t=$(".grayout-inner");t.on("click",this.close),this.$el.html(o.charityPopUp(this.get_template_params())),this.$el.show(),s.BaseCharityPreviewView.prototype.render.call(this)},close:function(){var e=$(".grayout");e.hide(),e.off("click")},stop_propagation:function(e){e.stopPropagation()}}),d=s.BaseCharityListView.extend({initialize:function(e){s.BaseCharityListView.prototype.initialize.call(this,e),this.user=e.user},renderCharityPreview:function(e){var n=t.includes(this.constants.disallowed_charity_ids,e.get("charity_id")),i=new c({model:e,constants:this.constants,is_disallowed:n,user:this.user});return i.render()}}),h=s.BaseSelectionView.extend({className:"charity-selection-view",events:{"click .js-submit-search":"submitSearch","keyup .js-charity-query":"submitSearch","change .js-charity-country":"handleCountryChange","click .js-jump-to-page":"jumpToPage"},initialize:function(e){s.BaseSelectionView.prototype.initialize.call(this,e),_(this).bindAll("submitSearch","jumpToPage"),this.constants=e.constants,this.isModal=e.isModal,this.user=e.user,this.collection||(this.collection=new i.CharityList(this.constants.featured_charities)),this.search_results_collection||(this.search_results_collection=new i.CharityList(this.collection.models)),this.PAGE_SIZE=e.page_size,this.UNITED_STATES="US",this.charitySearchResultsView=new d({disallowed_charity_ids:this.constants.disallowed_charity_ids,collection:this.search_results_collection,constants:this.constants,user:this.user,disableSelection:e.disableSelection})},jumpToPage:function(e){e.preventDefault();var t=r.parseClick(e);this.page=t+1,this.submitSearch(e)},render:function(){var e={categories:this.constants.CHARITY_SEARCH_PARAMS.category,countries:this.constants.CHARITY_SEARCH_PARAMS.country,states:this.constants.CHARITY_SEARCH_PARAMS.state,isModal:this.isModal};return this.$el.html(o.selectionView(e)),this},submitSearch:function(e){if(!e.keyCode||13==e.keyCode){e.preventDefault();var t=this.$(".js-charity-query").val(),n=this.$(".js-charity-category").val(),i=this.$(".js-charity-country").val(),s="";i==this.UNITED_STATES&&(s=this.$(".js-charity-state").val()),this.searchCharities({query:t,category:n,country:i,state:s,page:this.page,page_size:this.PAGE_SIZE})}},showNoResultsState:function(){this.$(".js-results-heading").text("No results found"),this.$(".js-charity-results").empty()},renderSearchResults:function(){this.$(".pagination").remove();var e=this.$(".js-charity-results");e.empty(),e.append(this.charitySearchResultsView.render()),e.append(r.renderControls(this.num_results,this.page-1,this.PAGE_SIZE))}}),m=e.View.extend({events:{"click .js-cyoc-cta":"displayCharitySelector","click .js-selected-charity-info":"displayCharityInfo"},LOCALSTORAGE_KEY:"charity_id",initialize:function(e){this.user=e.user,this.featuredCharityId=e.featuredCharityId,this.constants=e.constants,this.isModal=e.isModal,this.charities=e.charities,this.initializeCharity(),this.listenTo(this.user,"change:charity_id",this.updateCharity),this.listenTo(this.user,"change:charity_api_success",this.handleAPISuccess),$(window).bind("beforeunload",this.saveToLocalstorage.bind(this))},initializeCharity:function(){this.user.featuredCharityId=this.featuredCharityId;var e=this.user.get("charity_id");if(this.isCharityAllowed(e)&&(this.model=this.charities.get(e)),!this.model){var t=this.loadFromLocalstorage();return this.isCharityAllowed(t)&&(this.model=this.charities.get(t)),this.model?void this.user.set("charity_id",t):void(this.isCharityAllowed(this.featuredCharityId)&&(this.user.set("charity_id",this.featuredCharityId),this.model=this.charities.get(this.user.get("charity_id"))))}},isCharityAllowed:function(e){return e&&!t.includes(this.constants.disallowed_charity_ids,e)},loadFromLocalstorage:function(){var e=Util.getLocalStorage();return e.getItem(this.LOCALSTORAGE_KEY)},saveToLocalstorage:function(){var e=Util.getLocalStorage();e.setItem(this.LOCALSTORAGE_KEY,this.user.get("charity_id"))},updateCharity:function(){this.model=this.charities.get(this.user.get("charity_id")),this.modalView&&this.modalView.closeModal(),this.render()},displayCharitySelector:function(){this.modalView=new a,this.modalView.render();var e=new h({page_size:n.BODY_SEARCH_PAGE_SIZE,constants:this.constants,collection:this.charities,user:this.user,isModal:this.isModal});this.modalView.attachSubview(e),e.$(".js-charity-results").append(e.charitySearchResultsView.render())},displayCharityInfo:function(){this.model&&new u({el:$(".grayout-inner"),constants:this.constants,model:this.model,user:this.user})},handleAPISuccess:function(){this.$el.append(o.charityCTAMessage({success:this.user.get("charity_api_success")})),$(".charity-account-cta-message").clearQueue().animate({bottom:0},100).delay(5e3).animate({bottom:-100},300,"linear",function(){$(".charity-account-cta-message").remove()}),this.user.set("charity_api_success",null,{silent:!0})},render:function(){this.model?(this.$el.html(o.bundleCTA({heading:this.model.get("human_name"),logo_url:this.model.get("logo_url")})),l.preload_background_image_with_default(this.$(".charity-img"),n.DEFAULT_CHARITY_IMAGE)):this.$el.html(o.bundleCTA())}});return{CharityCTAView:m,CharitySelectionView:h,CharityDetailsView:u}}),define("bundle/image_loader/image_loader",["require","jquery","util/main"],function(e){"use strict";var t=e("jquery"),n=e("util/main");return{loadImages:function(){var e,i;n.isRetinaDisplay()?(i="retina-src",e=t("img[data-"+i+"]")):(i="src",e=t("img[data-"+i+"]")),e.on("load",function(){t(this).closest(".u-lazy-load").addClass("s-loaded")}).on("error",function(){t(this).closest(".u-lazy-load").addClass("s-error")}),e.each(function(){t(this).attr("src",t(this).data(i))})}}}),define("pubnub",["jquery","lib/pubnub"],function(e,t){"use strict";function n(e){this._log=[];var t=this;e.forEach(function(e){t[e]=function(){t._log.push([e,Array.prototype.slice.call(arguments)])}}),this._playback=function(e){t._log.forEach(function(t){methodname=t[0],args=t[1],method=e[methodname],method.apply(e,args)})}}function i(e,t){var n=m[e]||[];n.push(t),m[e]=n}function s(e){delete m[e]}function a(e,t,n){var i=!0,s=!1,a=void 0;try{for(var o,r=m[n][Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var l=o.value;l(e)}}catch(e){s=!0,a=e}finally{try{!i&&r.return&&r.return()}finally{if(s)throw a}}}function o(n){u||(c=n.preamble,u=t.init(n.credentials)),d||(d={},e.extend(d,u),d.subscribe=function(e){return i(e.channel,e.callback),e.callback=a,u.subscribe(e)},d.unsubscribe=function(e){return s(e.channel),u.unsubscribe(e)},d.ready(),h._playback(d))}function r(e){var t=_.extend({},e,{channel:c+e.channel});return d.subscribe(t)}function l(e){var t=_.extend({},e,{channel:c+e.channel});return d.unsubscribe(t)}var c,u,d,h=new n(["subscribe","unsubscribe","history"]),m={};return{initialize:o,subscribe:r,unsubscribe:l}});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("bundle/content_counter/content_counter",["require","backbone","pubnub"],function(e){"use strict";var t=e("backbone"),n=e("pubnub"),i=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e,t){var i=this;this.mostRecentPubnubTimestamp=0,this.productMachineName=t.productMachineName,n.subscribe({channel:"humble"+this.productMachineName,callback:function(e){e.counters&&(i.mostRecentPubnubTimestamp>e.timestamp||(i.mostRecentPubnubTimestamp=e.timestamp,i.set(e.counters)))}})}}]),t}(t.Model),s=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){this.counters=e.counters,this.listenTo(this.counters,"change",this.render),this.identifier=this.$el.data("counterIdentifier"),this.available=this.$el.data("countAvailable")}},{key:"render",value:function(){var e=this.available;this.counters.get(this.identifier)&&(e-=this.counters.get(this.identifier),e=Math.max(e,0)),this.$(".js-count-remaining").html(e)}}]),t}(t.View),a=function(e,t,n){var a=new i(t,{productMachineName:n});return e.each(function(e,t){new s({el:t,counters:a})}),a};return a}),define("commonModels/Product",["backbone"],function(e){"use strict";var t=e.Model.extend({idAttribute:"machine_name",defaults:{machine_name:"",category:"",start:"",end:"",expand_subsplits:!1,media_type:"",tpkd_cutoff_amount:1,stats_template:"",cutoff_warning_override:"",product_has_steam_keys:!1,monetary_content_event_data:{},has_free_keys:"",default_dollar_price:25,has_free_content:!1,disclaimer_text:"",order_form_vars:{},bundle_display_vars:{},giving_fund:"ppgf"}});return t}),define("commonModels/HumbleOrder",["backbone"],function(e){"use strict";var t=e.Model.extend({idAttribute:"gamekey",defaults:{gamekey:"",amount:0,cleanfamilytotal:0,avg:"",avghash:"",avguuid:"",forced_content_events:[]},isDefined:function(){return""!==this.get("gamekey")}});return t}),define("common/DOMLessView",["require","marionette","util/templating"],function(e){"use strict";var t=e("marionette"),n=e("util/templating"),i=t.ItemView.extend({_renderTemplate:function(){var e=this.getTemplate();if(e!==!1){if(!e)throw new t.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var i=this.mixinTemplateHelpers(this.serializeData()),s=n.renderTemplate(e,i);return this.attachElContent(s),this}}});return i}),define("constants/processorConstants",["require"],function(e){return{ALIPAY:"alipay",GOOGLEWALLET:"wallet",AMAZONHP:"amazonhp",PAYPAL:"paypal",FREE:"free",IDEAL:"ideal",STRIPE:"stripe",COINBASE:"coinbase",STORED_CREDENTIAL:"stored_credential",AMAZONFPS:"amazon",SOFORT:"sofort",SIMULATOR:"simulator",HUMBLEWALLET:"humblewallet"}}),define("lib/hbTemplate!orderform/templates/pricing/amount_radio_buttons.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<%= action %>\n<br />\n<div class="radio-collection"></div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!orderform/templates/pricing/amount_radio_button.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<% if (custom) { %>\n  <input type="radio" name="radio-amount" class="radio-amount custom-radio-amount" value="custom">\n  <label>Custom Amount</label>\n  <div class="customAmountHolder">\n    <input name="master-amount" class="master-amount" type="text" value="<%- min_price %>"\n           style="display:none"></input>\n  </div>\n<% } else { %>\n  <input type="radio" name="radio-amount" class="radio-amount" value="<%- min_price %>"<% if (checked) { %> checked<% } %>>\n  <% if (title) { %>\n  <label>$<%- min_price %> - <%- title %></label>\n  <br/>\n  <%= desc %>\n  <br/><br/>\n  <% } else { %>\n  <label>$<%- min_price %></label>\n  <br />\n  <% } %>\n<% } %>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!orderform/templates/pricing/radio_amount_selector.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<label class="order-form-amount-selection-label">Pay What You Want</label>\n<div class="order-form-amount-buttons-wrapper">\n<% selections.each(function (selection) { %>\n  <% if (selection.id === \'custom\'){ %>\n    <% if (editing) { %>\n  <div class="order-form-radio-custom-amount-wrapper">\n    <span>$</span>\n    <input\n      type="number"\n      step="0.01"\n      class="order-form-radio-custom-amount-input js-custom-amount-input"\n      value="<%- amountDollars %>" />\n  </div>\n    <% } else { %>\n  <button\n    type="button"\n    class="order-form-radio-custom-amount-button js-custom-amount-button<% if (selection.get(\'selected\')) { %> is-selected<% } %>">\n    <%= selection.escape(\'label\') %>\n  </button>\n    <% } %>\n  <% } else { %>\n  <button\n    type="button"\n    class="order-form-radio-amount-button<% if (selection.get(\'selected\')) { %> is-selected<% } %>"\n    data-value="<%= selection.escape(\'value\') %>">\n    $<%= selection.escape(\'label\') %>\n  </button>\n  <% } %>\n<% }); %>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("orderform/AmountButtons",["lib/jquery/full","lib/lodash","util/main","backbone","common/DOMLessView","hbtemplate!./templates/pricing/amount_radio_buttons.html","hbtemplate!./templates/pricing/amount_radio_button.html","hbtemplate!./templates/pricing/radio_amount_selector.html"],function(e,t,n,i,s,a,o,r){"use strict";var l=function(e){return Math.round(100*e)},c=function(e){return e/100},u=function(t){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,t),_createClass(n,[{key:"initialize",value:function(){this.$window=e(window),this.updateSize(),this.$window.resize(this.updateSize.bind(this))}},{key:"updateSize",value:function(){this.set({medium:this.$window.width()<=this.MEDIUM_BREAKPOINT,small:this.$window.width()<=this.SMALL_BREAKPOINT})}}]),n}(i.Model);u.prototype.MEDIUM_BREAKPOINT=900,u.prototype.SMALL_BREAKPOINT=750;var d=function(t){function s(){return _classCallCheck(this,s),_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return _inherits(s,t),_createClass(s,[{key:"initialize",value:function(e){this.windowSize=e.windowSize;var t=this.getSelectionData(e.pricingTiers);this.selections=new i.Collection(t),this.listenTo(this.model,"change:amount_pennies",this.render.bind(this)),this.listenTo(this.windowSize,"change:medium",this.render.bind(this))}},{key:"getSelectionData",value:function(e){var t=this,n=b(e);return n.map(function(e){if("custom"===e)return{id:e,value:t.model.get("amount_pennies"),label:"Custom Amount"};var n=e%1===0?e.toString():e.toFixed(2);return{label:n,id:l(e),value:l(e)}})}},{key:"serializeData",value:function(){var e=this.model.get("amount_pennies");return this.updateSelection(e),{selections:this.selections,amountDollars:c(e).toFixed(2),editing:this.editing||this.windowSize.get("medium")}}},{key:"onRender",value:function(){this.editing&&this.selectInputField()}},{key:"updateSelection",value:function(e){this.selections.each(function(e){return e.set("selected",!1)});var t=this.selections.get(e);t?this.selections.get("custom").set("label","Custom Amount"):(t=this.selections.get("custom"),t.set("label",n.moneyfmt(c(e),"USD"))),t.set("selected",!0)}},{key:"setStandardAmount",value:function(t){var n=e(t.target).data("value");_gaTrackEventNoninteractive(void 0,"Order form","Payment amount clicked",n),this.model.set("amount_pennies",parseInt(n,10))}},{key:"editCustomAmount",value:function(){this.editing=!0,_gaTrackEventNoninteractive(void 0,"Order form","Custom payment amount clicked"),this.render()}},{key:"setCustomAmount",value:function(e){var t=13,i=void 0;"keypress"===e.type&&e.keyCode!==t||(e.preventDefault(),i=e.target.value.replace(",","."),i=l(parseFloat(n.unmoneyformat(i))),this.editing=!1,this.model.set("amount_pennies",i))}},{key:"selectInputField",value:function(){this.$(".js-custom-amount-input").select()}}]),s}(s);d.prototype.template=r,d.prototype.events={"click .js-custom-amount-button":"editCustomAmount","click .order-form-radio-amount-button":"setStandardAmount","keypress .js-custom-amount-input":"setCustomAmount","click .js-custom-amount-input":"selectInputField","blur .js-custom-amount-input":"setCustomAmount","change .js-custom-amount-input":"setCustomAmount"};var h=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),t}(i.Model);h.prototype.defaults={title:null,desc:null,checked:!1,editing:!1,custom:!1},h.prototype.idAttribute="min_price";var m=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),t}(i.Collection);m.prototype.model=h;var p=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){var t=e.amountModel,n=e.personalTotal;this.amountModel=t,this.personalTotal=n,this.amountModel.on("change:amount_pennies",this.removeCustom,this)}},{key:"radioButtonClickHandler",value:function(e){this.model.get("custom")&&this.$(".master-amount").fadeIn();var t=100*this.model.get("min_price");this.personalTotal&&(t-=100*this.personalTotal),this.amountModel.set("amount_pennies",parseInt(t,10))}},{key:"customAmountChange",value:function(e){var t=e.target.value.replace(",","."),i=parseFloat(n.unmoneyformat(t)),s=Math.round(100*i);this.model.set("min_price",i),this.amountModel.set("amount_pennies",parseInt(s,10))}},{key:"removeCustom",value:function(){this.model.get("custom")&&!this.$(".custom-radio-amount").prop("checked")&&this.$(".master-amount").fadeOut()}}]),t}(s);p.prototype.template=o,p.prototype.events={"change .master-amount":"customAmountChange","click .radio-amount":"radioButtonClickHandler"};var f=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){var t=e.templateVariables;this.templateVariables=t,this.createUpgradeTiers(t)}},{key:"createUpgradeTiers",value:function(e){var t=e.upgradeTiers,n=e.defaultDollarPrice,i=e.initialValue;this.tierCollection=new m,0==t.length?(this.action="Name your price:",this.tierCollection.add([{min_price:100},{min_price:50},{min_price:n,checked:!0},{min_price:10},{min_price:i,custom:!0}])):(this.action="Choose your tier:",this.tierCollection.add(t))}},{key:"serializeData",value:function(){return{action:this.action}}},{key:"onRender",value:function(){var e=this,t=void 0;this.templateVariables.isOrderAdder&&this.templateVariables.upgradeTiers.length&&(t-=100*this.templateVariables.personalTotal),this.tierCollection.each(function(n){var i=new p({model:n,amountModel:e.model,personalTotal:t});e.$(".radio-collection").append(i.render().el)})}}]),t}(s);f.prototype.template=a;var b=function(e){if(t.isEmpty(e))return[10,25,50,100,"custom"];var n=[],i=0;return e.avg&&(i=e.avg,n.push(Math.ceil(i+.1))),n=n.concat(t.filter(e,function(e){return e>i})),n.sort(function(e,t){return e-t}),!e.avg&&n.length>0&&(1==n.length||n[0]+1<n[1])&&n.splice(1,0,n[0]+1),n[n.length-1]<25&&n.push(25),n=t.sortedUniq(n),n.push("custom"),n};return{AmountRadios:f,RadioAmountSelector:d,WindowSize:u,getRadioButtonAmounts:b}}),define("lib/hbTemplate!orderform/templates/error_message_template.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<aside class="order-form-error-msg <%- identifierClass %> <%- warningClass %>">\n  <div class="order-form-error-text-container">\n    <p class="order-form-error-text"><%= errorText %></p>\n<% if (typeof price !== \'undefined\' && warningClass !== \'warning-unlocked\') { %>\n    <a href="#" class="js-readjust-order-amount order-form-error-call-to-action">Add <%= priceDifference %></a>\n<% } %>\n  </div>\n</aside>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("orderform/AmountError",["backbone","lib/lodash","util/main","common/DOMLessView","hbtemplate!./templates/error_message_template.html"],function(e,t,n,i,s){"use strict";var a=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),t}(e.Model);a.prototype.idAttribute="identifierClass";var o=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),t}(e.Collection);o.prototype.model=a;var r=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){var t=e.amountModel;this.amountModel=t}},{key:"readjustOrderAmount",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.model.get("price");this.amountModel.set("amount_pennies",t),_gaTrackEventNoninteractive(void 0,"Order form","Warning clicked to readjust order amount",t)}},{key:"onBeforeDestroy",value:function(){this.$el.fadeOut()}}]),t}(i);r.prototype.events={"click .js-readjust-order-amount":"readjustOrderAmount"},r.prototype.template=s;var l=function(e){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return _inherits(i,e),_createClass(i,[{key:"initialize",value:function(e){var t=e.product,n=e.personalTotal,i=e.avg,s=e.isOrderAdder;this.product=t,this.personalTotal=n,this.avg=i,this.isOrderAdder=s,this.errors=new o,this.errorViews={},this.sortMonetaryContentEventData(),this.validateAmount(),this.listenTo(this.model,"change:amount_pennies",this.validateAmount.bind(this)),this.listenTo(this.errors,"add",this.addErrorView.bind(this)),this.listenTo(this.errors,"remove",this.removeError.bind(this))}},{key:"sortMonetaryContentEventData",value:function(){var e=this;this.monetaryContentEventData=this.product.get("monetary_content_event_data")||[],this.monetaryContentEventData=t.sortBy(this.monetaryContentEventData,function(t){return"average"===t.type?e.avg:"average_plus"===t.type?e.avg+t.average_plus:t.amount})}},{key:"addError",value:function(e,i,s,a){var o=n.moneyfmt(e-this.model.getCurrentDollarAmount(),"USD");a||(a=""),this.errors.get(i)&&this.errors.remove(i),this.errors.add({errorText:t.template(s)({money_difference:o}),price:100*e,priceDifference:o,identifierClass:i,warningClass:a})}},{key:"addErrorView",value:function(e){var t=new r({model:e,amountModel:this.model});this.$el.append(t.render().$el),this.errorViews[e.id]=t}},{key:"removeError",value:function(e){this.errorViews[e.id]&&(this.errorViews[e.id].remove(),delete this.errorViews[e.id])}},{key:"validateAmount",value:function(){
this.validatePennyMinimum(),this.validateForSteamKeys(),this.createWarningMessages()}},{key:"validatePennyMinimum",value:function(){this.model.isValid(this.product.get("has_free_content"))?this.errors.remove("penny-error"):this.addError(.01,"penny-error","Please enter at least one penny (preferably a lot more to help cover our costs!)")}},{key:"validateForSteamKeys",value:function(){var e=this.model.getCurrentDollarAmount(),t=this.product.get("tpkd_cutoff_amount");this.isOrderAdder&&(t-=this.personalTotal,t=+t.toFixed(2)),(this.product.get("has_any_keys")||this.product.get("cutoff_warning_override"))&&e<t?this.product.get("cutoff_warning_override")?this.addError(t,"tpkd-error",this.product.get("cutoff_warning_override")):this.product.get("has_steam_keys")&&!this.product.get("has_nonsteam_keys")?this.addError(t,"tpkd-error","You must pay at least "+n.moneyfmt(t,"USD")+" to get Steam keys"):this.product.get("has_steam_keys")&&this.product.get("has_nonsteam_keys")?this.addError(t,"tpkd-error","You must pay at least "+n.moneyfmt(t,"USD")+" to get Steam keys and other keys"):this.addError(t,"tpkd-error","You must pay at least "+n.moneyfmt(t,"USD")+" to get keys"):this.errors.remove("tpkd-error")}},{key:"createWarningMessages",value:function(){for(var e=0;e<this.monetaryContentEventData.length;e++){var t=null,n=this.monetaryContentEventData[e],i=n.type;if("average"===i?(t=Math.round(100*this.avg)/100,t+=.01):"average_plus"===i?t=Math.round(100*(parseFloat(this.avg)+n.average_plus))/100:"price"===i&&(t=n.amount),null!==t){this.isOrderAdder&&(t-=this.personalTotal,t=+t.toFixed(2));var s="warning-"+e;this.model.getCurrentDollarAmount()<t?n.warning_locked?this.addError(t,s,n.warning_locked,"warning-locked"):this.errors.remove(s):n.warning_unlocked?this.addError(t,s,n.warning_unlocked,"warning-unlocked"):this.errors.remove(s)}}}},{key:"render",value:function(){var e=this;this.errors.each(function(t){return e.addErrorView(t)})}}]),i}(e.View);return l});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("orderform/AmountModel",["lib/jquery/full","lib/lodash","util/main","backbone"],function(e,t,n,i){"use strict";function s(e,n){return t.each(n,function(t,i){n.hasOwnProperty(i)&&(e.hasOwnProperty(i)?e[i]+=n[i]:e[i]=n[i])}),e}var a="cyoc",o="charity",r=function(e){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return _inherits(r,e),_createClass(r,[{key:"initialize",value:function(){this.set({is_cyoc:this.get("secondary_id").toLowerCase()==a,default_sibling_split:this.get("default_sibling_split")||this.get("sibling_split"),amount_pennies:parseInt(this.get("amount_pennies"),10)}),this.get("subsplits")&&this.set("subsplit",this.get("subsplits")),this.initializeChildren(),this.on("change:amount_pennies",this.propagateAmountChangeDown,this)}},{key:"initializeChildren",value:function(){var e=this;this.children=new i.Collection;var n=this.get("subsplit");n&&(this.set("has_children",!0),t.each(n,function(t){return e.addChild(t)}))}},{key:"getSiblings",value:function(){var e=this;return this.parent.children.filter(function(t){return t.cid!==e.cid})}},{key:"hasCharitySplit",value:function(){return this.children.filter(function(e){return e.isCharityClass()}).length}},{key:"isCharityClass",value:function(){return this.get("class")===o}},{key:"isAllDisabled",value:function(){return this.children.every(function(e){return e.get("enabled")===!1})}},{key:"isValid",value:function(e){return this.get("amount_pennies")>=1||e}},{key:"addChild",value:function(e){e.amount_pennies||(e.amount_pennies=parseInt(e.sibling_split*this.get("amount_pennies"),10)),e.expand_subsplits=this.get("expand_subsplits");var t=new r(e);t.parent=this,this.children.add(t)}},{key:"getHumanAmount",value:function(){return n.moneyfmt(parseInt(this.get("amount_pennies"),10)/100,"USD")}},{key:"getCurrentDollarAmount",value:function(){return(this.get("amount_pennies")/100).toFixed(2)}},{key:"distributePenniesDownOneLevel",value:function(){if(this.children.length){for(var e=this.children.reduce(function(e,t){return e+t.get("amount_pennies")},0),t=this.get("amount_pennies")-e,n=this.get("start_index");t>0;){var i=this.children.at(n%this.children.length);i.set("amount_pennies",i.get("amount_pennies")+1),t--,n++}this.set("start_index",n)}}},{key:"loadFromLocalStorage",value:function(e){void 0!==e.amount_pennies&&this.set("amount_pennies",e.amount_pennies),void 0!==e.sibling_split&&this.set("sibling_split",e.sibling_split),e.subsplit&&e.subsplit.length===this.children.length&&this.children.each(function(t,n){t.loadFromLocalStorage(e.subsplit[n])})}},{key:"resetToDefaultSiblingSplit",value:function(){var e=this.parent.get("amount_pennies");this.set("sibling_split",this.get("default_sibling_split")),this.set("amount_pennies",parseInt(e*this.get("sibling_split"),10)),this.children.each(function(e){return e.resetToDefaultSiblingSplit()})}},{key:"propagateAmountChangeDown",value:function(){var e=this.get("amount_pennies");this.children.each(function(t){var n=parseInt(e*t.get("sibling_split"),10);t.set({amount_pennies:n,enabled:0!=e}),t.unset("error")}),this.distributePenniesDownOneLevel()}},{key:"setNewSplit",value:function(e){var n=this.parent.get("amount_pennies");if(0!==n){var i=parseInt(e*n,10),s=n-this.get("amount_pennies"),a=n-i,o=this.getSiblings();this.set({sibling_split:e,amount_pennies:i}),t.each(o,function(e){var t=1/o.length;0!=s&&a>0&&(t=e.get("amount_pennies")/s);var i=parseInt(t*a,10);e.set({sibling_split:i/n,amount_pennies:i})}),this.parent.distributePenniesDownOneLevel()}}},{key:"serializeTree",value:function(){var e=this.attributes;return delete e.error,this.children.length&&(e.subsplit=this.children.map(function(e){return e.serializeTree()})),e}},{key:"flattenPercentageTree",value:function(e){void 0===e&&(e=1);var t=this.get("sibling_split")*e;if(!this.children.length){var n=this.get("class"),i=n,a=this.get("secondary_id");a&&(i+="-"+a);var o={};return o["split-"+i]=100*t,o}return this.children.reduce(function(e,n){return s(e,n.flattenPercentageTree(t))},{})}}]),r}(i.Model);return r.prototype.defaults={amount_pennies:0,sibling_split:1,default_sibling_split:0,secondary_id:"",has_children:!1,enabled:!0,start_index:0,expand_subsplits:!1},r}),define("lib/hbTemplate!orderform/templates/leaderboard_template.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'You\'re a top contributor! Please provide a name for our leaderboard:\n<div class="leaderboard-input-group">\n  <input\n    type="text"\n    id="leaderboard_topname"\n    class="order-form-leaderboard-input"\n    name="topname"\n    value="Anonymous"\n    maxlength="70" />\n  <span\n    class="order-form-leaderboard-no-thanks-button js-no-thanks-button">No thanks</span>\n</div>\n\n<a href="https://support.humblebundle.com/hc/en-us/articles/202421394-top-contributor-faq"\n   class="order-form-leaderboard-faq-link"\n   target="_blank"\n   title="Top Contributor FAQ">\n  <i class="hb hb-support"></i>\n</a>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("orderform/Leaderboard",["common/DOMLessView","hbtemplate!./templates/leaderboard_template.html"],function(e,t){"use strict";var n=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){var t=e.minLeaderboard;this.minLeaderboard=t,this.listenTo(this.model,"change:amount_pennies",this.renderLeaderboardState.bind(this))}},{key:"showLeaderboardStep",value:function(){this.model.set("topallow",!0),this.$el.slideDown()}},{key:"hideLeaderboardStep",value:function(){this.model.set("topallow",!1),this.$el.slideUp()}},{key:"renderLeaderboardState",value:function(){var e=this.model.get("amount_pennies")/100;null!==this.minLeaderboard&&e>this.minLeaderboard?this.showLeaderboardStep():this.hideLeaderboardStep()}},{key:"updateModel",value:function(e){var t=$(e.target);this.model.set(t.attr("name"),t.val())}},{key:"onRender",value:function(){this.renderLeaderboardState()}}]),t}(e);return n.prototype.events={"click .js-no-thanks-button":"hideLeaderboardStep",input:"updateModel"},n.prototype.template=t,n}),define("lib/hbTemplate!orderform/templates/paypal_disclaimer_template.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'  <div class="order-form-ppgf-disclaimer">\n<% if (inContext) { %>\n    Administered by\n<% } else { %>\n    Charitable contributions administered by\n<% } %>\n    <a href="https://support.humblebundle.com/hc/en-us/articles/205183597" class="color-neutral-link" target="_blank">PayPal Giving Fund</a>\n  </div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!orderform/templates/paypal_tides_disclaimer_template.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'  <div class="order-form-ppgf-tides-disclaimer">\n<% if (inContext) { %>\n    Administered by\n<% } else { %>\n    Charitable contributions administered by\n<% } %>\n    <a href="https://support.humblebundle.com/hc/en-us/articles/205183597" class="color-neutral-link" target="_blank">PayPal Giving Fund</a> and <a href="https://support.humblebundle.com/hc/en-us/articles/205501708" class="color-neutral-link" target="_blank">Tides Foundation</a>\n  </div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!orderform/templates/paypal_direct_disclaimer_template.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'  <div class="order-form-ppgf-direct-disclaimer">\n<% if (inContext) { %>\n    Administered by\n<% } else { %>\n    Charitable contributions administered by\n<% } %>\n    <a href="https://support.humblebundle.com/hc/en-us/articles/205183597" class="color-neutral-link" target="_blank">PayPal Giving Fund</a> or paid directly to the organization.\n  </div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!orderform/templates/tides_disclaimer_template.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'  <div class="order-form-tides-disclaimer">\n<% if (inContext) { %>\n    Administered by\n<% } else { %>\n    Charitable contributions administered by\n<% } %>\n    <a href="https://support.humblebundle.com/hc/en-us/articles/205501708" class="color-neutral-link" target="_blank">Tides Foundation</a>\n  </div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!orderform/templates/splits_template.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<% if (subsplit && subsplit.length > 1) { %>\n  <div class="order-form-split-header js-split-toggle">\n    <div class="disclosure-triangle<%= expand_subsplits ? \' target-is-expanded\' :\'\' %>"></div>\n    <p class="order-form-split-message js-order-admin-edit" data-entity-kind="product" data-machine-name="<%- productMachineName %>" data-anchor-name="#row_splits" data-link-position="after">\n      Choose where your money goes\n    </p>\n    <div class="u-order-form-redesign disclosure-triangle"></div>\n    <button type="button" class="order-form-split-reset-button js-split-reset-button">Reset</button>\n  </div>\n\n  <div class=\'custom-values\'>\n    <div class=\'custom-values-inner\'>\n      <div class=\'splits-holder\'></div>\n    </div>\n  <% if (splitDisclaimer) { %>\n    <div class="order-form-split-disclaimer">\n      <%- splitDisclaimer %>\n    </div>\n  <% } %>\n  </div>\n<% } else { %>\n    <%= sliderReplacementText %>\n<% } %>'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!orderform/templates/single_slider_holder_template.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="order-form-split-payee slider-container">\n  <div class="order-form-split"></div>\n</div>\n<% if (is_cyoc) { %>\n<div class="js-cyoc-wrapper cyoc-wrapper">\n  <div class="top-arrow"></div>\n</div>\n<% } %>\n<div class="order-form-split-error"></div>\n<div class="order-form-subsplit<% if (!expand_subsplits) {%> u-display-none<% } %>">\n  <div class="subsplit-wrapper"></div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!orderform/templates/slider.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="ui-slider-handle">\n  <div class="tri-left"></div>\n  <div class="tri-right"></div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!orderform/templates/amount_input.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<span>$</span>\n<input type="number"\n       step=".01"\n       min="0"\n       max="<%= parent_amount %>"\n       class="order-form-split-payee-amount-input<% if (!enabled) { %> order-form-split-input-disabled<% } %>"\n       <% if (!enabled) { %>disabled<% } %>\n       value="<%= human_amount %>"/>'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!orderform/templates/split.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="order-form-split-payee-label js-subsplit-toggle">\n<% if (has_children) { %>\n  <div class="disclosure-triangle<%= expand_subsplits ? \' target-is-expanded\' :\'\' %>"></div>\n<% } %>\n  <div\n    class="order-form-split-payee-name js-order-form-split-payee-name <%= is_cyoc ? \'js-show-charity-selector show-charity-selector\' : \'\' %>"\n    style="<%= (has_children) ? \'cursor: pointer;\' :\'\' %>"\n    title="<%- name %>">\n    <%- name %>\n  </div>\n</div>\n<div class="order-form-slider-small">\n  <div class="order-form-split-payee-slider"></div>\n  <div class="order-form-amount-input-wrapper"></div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!orderform/templates/split_error_template.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<%= error %>".replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("orderform/Splits",["jquery","lib/jquery/ui/full","lib/lodash","util/main","backbone","common/DOMLessView","charity/bundle","charity/helpers","common/modal/views/ModalView","hbtemplate!./templates/paypal_disclaimer_template.html","hbtemplate!./templates/paypal_tides_disclaimer_template.html","hbtemplate!./templates/paypal_direct_disclaimer_template.html","hbtemplate!./templates/tides_disclaimer_template.html","hbtemplate!./templates/splits_template.html","hbtemplate!./templates/single_slider_holder_template.html","hbtemplate!./templates/slider.html","hbtemplate!./templates/amount_input.html","hbtemplate!./templates/split.html","hbtemplate!./templates/split_error_template.html","lib/jquery/plugins/jquery.ui.touch-punch"],function(e,t,n,i,s,a,o,r,l,c,u,d,h,m,p,f,b,v,g){"use strict";var _=r.charityPubSub,y={ppgf:c,"ppgf-tides":u,"ppgf-direct":d,tides:h},w=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e,t){this.model=new s.Model({inContext:t}),this.givingFund=e}},{key:"getTemplate",value:function(){return y[this.givingFund]||!1}}]),t}(a),k=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){this.listenTo(this.model,"change:sibling_split",this.updateSlider.bind(this)),this.listenTo(this.model,"change:enabled",this.toggleDisableInput.bind(this))}},{key:"toggleDisableInput",value:function(){this.model.get("enabled")?(this.$el.slider({disabled:!1}),this.$el.css({opacity:1})):(this.$el.slider({disabled:!0}),this.$el.css({opacity:.1}))}},{key:"updateSlider",value:function(){this.rendered&&this.$el.slider("value",this.sliderIncrements*this.model.get("sibling_split"))}},{key:"onSlide",value:function(){var e=this.$el.slider("option","value"),t=e/this.sliderIncrements;isNaN(t)||t<0?t=0:t>1&&(t=1),this.model.setNewSplit(t)}},{key:"onRender",value:function(){this.$el.slider({range:"min",min:0,max:this.sliderIncrements,value:this.sliderIncrements*this.model.get("sibling_split")}),this.rendered=!0,this.toggleDisableInput()}}]),t}(a);k.prototype.events={"mousedown .ui-slider":"onSlide",slide:"onSlide",slidestop:"onSlide"},k.prototype.rendered=!1,k.prototype.sliderIncrements=1e3,k.prototype.template=f;var C=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){this.listenTo(this.model,"change:error",this.render.bind(this))}},{key:"serializeData",value:function(){return{error:this.model.get("error")}}}]),t}(a);C.prototype.template=g;var T=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){this.listenTo(this.model,"change:amount_pennies",this.render.bind(this)),this.listenTo(this.model,"change:enabled",this.render.bind(this)),this.listenTo(this.model,"change:error",this.render.bind(this))}},{key:"amountEditedDirectly",value:function(){var e=this.$(".order-form-split-payee-amount-input").val(),t=parseFloat(i.unmoneyformat(e));isNaN(t)&&(t=0);var n=parseInt(Math.round(100*t),10);if(n<=this.model.parent.get("amount_pennies"))this.model.setNewSplit(n/this.model.parent.get("amount_pennies"));else{var s=this.model.parent.get("name")?this.model.parent.get("name")+" ":"";this.model.set("error","Amount cannot be greater than total "+s+"amount")}}},{key:"selectInputField",value:function(){this.$(".order-form-split-payee-amount-input").select()}},{key:"serializeData",value:function(){return{human_amount:this.model.getCurrentDollarAmount(),parent_amount:this.model.parent.getCurrentDollarAmount(),enabled:this.model.get("enabled")}}}]),t}(a);T.prototype.events={change:"amountEditedDirectly","click .order-form-split-payee-amount-input":"selectInputField"},T.prototype.template=b;var S=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){this.givingFund=e.givingFund,this.charityConstants=e.charityConstants,this.user=e.user,this.charities=e.charities,this.model.on("change:name",this.render.bind(this)),this.model.get("is_cyoc")&&(this.updateCyoc(),this.listenTo(this.user,"change:charity_id",this.updateCyoc.bind(this)))}},{key:"toggleCharitySelector",value:function(){this.model.get("is_cyoc")&&(this.modalView=new l,this.charitySelectionView||(this.charitySelectionView=new o.CharitySelectionView({pubSub:_,page_size:r.ORDER_FORM_SEARCH_PAGE_SIZE,constants:this.charityConstants,isModal:!0,user:this.user,collection:this.charities})),this.modalView.render(),this.modalView.attachSubview(this.charitySelectionView),this.charitySelectionView.$(".js-charity-results").append(this.charitySelectionView.charitySearchResultsView.render()))}},{key:"toggleSubsplit",value:function(){this.model.set("expand_subsplits",!this.model.get("expand_subsplits"))}},{key:"updateCyoc",value:function(){var e=this.charities.get(this.user.get("charity_id")),t="Choose Your Own Charity"===this.model.get("name");if(e?this.model.set({enabled:0!=this.model.parent.get("amount_pennies"),name:e.get("human_name"),featured:e.get("featured"),charity_chosen:!e.get("featured")}):(this.model.set({charity_chosen:!1,featured:!1,name:"Choose Your Own Charity",enabled:!1}),this.model.setNewSplit(0)),e&&t){var n=this.model.getSiblings().length+1;this.model.setNewSplit(1/n)}this.modalView&&this.modalView.closeModal()}},{key:"onRender",value:function(){this.sliderInputView||(this.sliderInputView=new T({model:this.model})),this.sliderInputView.setElement(this.$(".order-form-amount-input-wrapper:first")),this.sliderInputView.render(),this.sliderUIView||(this.sliderUIView=new k({model:this.model})),this.sliderUIView.setElement(this.$(".order-form-split-payee-slider:first")),this.sliderUIView.render()}}]),t}(a);S.prototype.events={"click .js-show-charity-selector":"toggleCharitySelector","click .js-subsplit-toggle":"toggleSubsplit"},S.prototype.template=v;var j=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){this.givingFund=e.givingFund,this.charityConstants=e.charityConstants,this.user=e.user,this.charities=e.charities,this.model.on("change:expand_subsplits",this.toggleSubsplits.bind(this))}},{key:"toggleSubsplits",value:function(){this.model.get("expand_subsplits")?(this.$childSplits.slideDown(200),this.$splitDisclosureTriangle.addClass("target-is-expanded")):(this.$childSplits.slideUp(200),this.$splitDisclosureTriangle.removeClass("target-is-expanded"))}},{key:"onRender",value:function(){var e=this;this.splitView||(this.splitView=new S({model:this.model,charityConstants:this.charityConstants,user:this.user,charities:this.charities})),this.splitView.setElement(this.$(".order-form-split:first")),this.splitView.render(),this.splitErrorView||(this.splitErrorView=new C({model:this.model})),this.splitErrorView.setElement(this.$(".order-form-split-error:first")),this.splitErrorView.render(),this.childrenSliders||(this.childrenSliders=[],this.model.children.each(function(n){var i=new t({model:n,givingFund:e.givingFund,charityConstants:e.charityConstants,user:e.user,charities:e.charities});e.childrenSliders.push(i)}));var i=this.$(".subsplit-wrapper:first");if(n.each(this.childrenSliders,function(e){i.append(e.render().$el)}),this.model.get("subsplit")&&this.model.isCharityClass()){var s=new w(this.givingFund,!0);this.$el.append(s.render().$el)}this.$childSplits=this.$(".order-form-subsplit"),this.$splitDisclosureTriangle=this.$(".order-form-split-payee-label .disclosure-triangle"),this.toggleSubsplits()}}]),t}(a);j.prototype.template=p;var x=function(t){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,t),_createClass(n,[{key:"initialize",value:function(e){this.charityConstants=e.charityConstants,this.charities=e.charities,this.user=e.user,this.givingFund=e.givingFund,this.listenTo(this.model,"change:expand_subsplits",this.renderSplitState.bind(this))}},{key:"revertToDefaultSplit",value:function(e){e.preventDefault(),e.stopPropagation(),this.model.children.each(function(e){e.resetToDefaultSiblingSplit()})}},{key:"toggleSplits",value:function(){this.model.set("expand_subsplits",!this.model.get("expand_subsplits"))}},{key:"renderSplitState",value:function(){this.model.get("expand_subsplits")?(this.$customValues.slideDown(200),this.$resetButton.fadeIn(),this.$splitDisclosureTriangle.addClass("target-is-expanded")):(this.$customValues.slideUp(200),this.$resetButton.fadeOut(),this.$splitDisclosureTriangle.removeClass("target-is-expanded"))}},{key:"onRender",value:function(){var t=this;if(this.model.children.each(function(e){var n=new j({model:e,givingFund:t.givingFund,charityConstants:t.charityConstants,user:t.user,charities:t.charities});t.$(".splits-holder").append(n.render().$el)}),this.model.children.length||e(".js-slider-replacement-text").show(),!this.model.hasCharitySplit()){var n=new w(this.givingFund,!1);this.$el.append(n.render().$el)}this.$splitDisclosureTriangle=this.$(".order-form-split-header .disclosure-triangle"),this.$customValues=this.$(".custom-values"),this.$resetButton=this.$(".js-split-reset-button"),this.toggleSplits()}}]),n}(a);return x.prototype.className="order-form-split-step",x.prototype.events={"click .js-split-reset-button":"revertToDefaultSplit","click .js-split-toggle":"toggleSplits"},x.prototype.template=m,x}),define("lib/hbTemplate!orderform/templates/checkout_tiers_template.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'  <h1 class="order-form-image-fan-box-header">\n    <div class="header"><%- top_header_text %></div>\n<% if (formatted_cc_price) { %>\n    <div class="subheader">(about <%- formatted_cc_price %>)</div>\n<% } %>\n  </h1>\n  <i class="hb hb-check-circle\n            js-order-form-image-fan-check-box\n            order-form-image-fan-check-box"></i>\n  <div class="js-order-form-image-fan-wrapper\n              order-form-image-fan-wrapper"></div>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("orderform/CheckoutTiers",["require","jquery","backbone","common/DOMLessView","hbtemplate!./templates/checkout_tiers_template.html"],function(e){"use strict";var t=e("jquery"),n=e("backbone"),i=e("common/DOMLessView"),s=e("hbtemplate!./templates/checkout_tiers_template.html"),a=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"getPriceInDollars",value:function(){return this.get("price")||1}}]),t}(n.Model);a.prototype.defaults={formatted_cc_price:null};var o=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),t}(n.Collection);o.prototype.model=a;var r=function(e){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,e),_createClass(n,[{key:"initialize",value:function(e){var t=e.amountModel;this.amountModel=t,this.listenTo(this.amountModel,"change:amount_pennies",this.updateThresholdMet.bind(this))}},{key:"updateThresholdMet",value:function(){this.isThresholdMet()?this.fadeIn():this.fadeOut()}},{key:"isThresholdMet",value:function(){return 100*this.model.getPriceInDollars()<=this.amountModel.get("amount_pennies")}},{key:"onRender",value:function(){this.updateThresholdMet()}},{key:"fadeIn",value:function(){this.$el.prev().removeClass("s-below-threshold"),this.$el.removeClass("s-below-threshold"),this.$(".js-order-form-image-fan-check-box").removeClass("s-below-threshold")}},{key:"fadeOut",value:function(){this.$el.prev().addClass("s-below-threshold"),this.$el.addClass("s-below-threshold"),this.$(".js-order-form-image-fan-check-box").addClass("s-below-threshold")}},{key:"updateAmountPennies",value:function(e){e.preventDefault(),this.model.get("is_initial_tier")?(t(".js-custom-amount-button").click(),t(".js-custom-amount-input").val(""),t(".js-custom-amount-input").focus()):this.amountModel.set("amount_pennies",100*(this.model.get("price")||1))}}]),n}(i);r.prototype.className="order-form-image-fan-box",r.prototype.events={click:"updateAmountPennies"},r.prototype.template=s;var l=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){var t=e.checkoutTiers;this.collection=new o(t)}},{key:"render",value:function(){var e=this;this.collection.length<2||this.collection.each(function(t,n){if(n>0){var i='<span class="order-form-image-fan-plus-icon">+</span>';e.$el.append(i)}var s=new r({model:t,amountModel:e.model});return e.$el.append(s.$el),s.render(),e})}}]),t}(n.View);return l}),define("lib/hbTemplate!orderform/templates/previous_purchase_template.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<% if (_.size(purchase_history)) { %>\n  <div class="previous-purchase-list">\n  <% if (_.size(purchase_history) == 1) { %>\n    <% var value = _.head(purchase_history) %>\n    Please note, you purchased this product <%- value.minutes %> minutes ago. <a href="/receipt?s=thanks&uid=<%- value.uid %>&uidverify=<%- value.uidverify%>">Click here</a> to see its progress before trying again.\n  <% } else { %>\n    Please note, you have recently started the following purchases of this product:\n    <ul>\n    <% _.each(purchase_history, function(value) { %>\n      <li><%- value.minutes %> minutes ago. <a href="/receipt?s=thanks&uid=<%- value.uid %>&uidverify=<%- value.uidverify%>">Click here</a> to see its progress before trying again.</li>\n    <% }); %>\n    </ul>\n  <% } %>\n  </div>\n<% } %>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("orderform/PreviousPurchases",["lib/lodash","util/main","common/DOMLessView","hbtemplate!./templates/previous_purchase_template.html"],function(e,t,n,i){"use strict";var s=function(t){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,t),_createClass(n,[{key:"initialize",value:function(){var t=new Date,n=this.model.get("purchase_history");e.each(n,function(e){var n=new Date(e.time);e.minutes=Math.floor((t-n)/6e4)}),this.model.set("purchase_history",e.filter(n,function(e){return e.minutes<120}))}}]),n}(n);return s.prototype.template=i,s}),define("lib/hbTemplate!orderform/templates/payment_options_template.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="order-form-purchase-in-progress-spinner">\n  <img src="xSTATIC_URLx/static/hashed/26faf55c6e36ba3b1a57f9001942059fe05050f2.gif" />\n  Processing...\n</div>\n\n<div class="order-form-payment-options-container">\n  <% _.each(processors, function(processor) { %>\n  <div class="order-form-payment-button-wrapper">\n    <button type="button"\n            class="<%= processor.escape(\'className\') %> js-payment-button order-form-processor-button"\n          <% if (processor.get(\'alipayImage\')) { %>\n            style="background-image: url(xSTATIC_URLx/static/hashed/6e104181dc93b5f386d1549d78bd421ca8ed1d92.png)"\n          <% } %>\n            data-processor="<%- processor.id %>">\n    <% if (processor.get(\'icon\')) { %>\n      <i class="hb hb-<%= processor.escape(\'icon\') %>"></i>\n    <% } %>\n    <% if (processor.get(\'text\')) { %>\n      <%= processor.escape(\'text\') %>\n      <% if (processor.get(\'paypalImage\')) { %>\n        <img alt="<%- processor.id %>" src="xSTATIC_URLx/static/hashed/482b7908ee21571518d636bbefc08f0340c55d1e.svg" />\n      <% } %>\n    <% } %>\n    </button>\n    <% if (processor.get(\'credentialText\')) { %>\n      <div class="order-form-stored-payment-text"><%= processor.escape(\'credentialText\') %></div>\n    <% } %>\n  </div>\n  <% }) %>\n  <% if (moreOptions) { %>\n  <div class="order-form-payment-button-wrapper">\n    <button type="button"\n            class="order-form-simple-payment-button js-order-form-show-more-button order-form-processor-button">\n      <i class="hb hb-menu"></i> More Payment Options\n    </button>\n  </div>\n  <% } %>\n</div>\n'.replace(/xSTATIC_URLx/g,t);
}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("orderform/PaymentOptionsView",["lib/jquery/full","lib/lodash","util/main","backbone","constants/processorConstants","common/DOMLessView","common/modal/views/ModalView","hbtemplate!./templates/payment_options_template.html"],function(e,t,n,i,s,a,o,r){"use strict";var l={};l[s.PAYPAL]={order:11,text:"Pay with",paypalImage:!0,className:"order-form-paypal-payment-button"},l[s.STRIPE]={order:12,icon:"stripe",text:"Pay with card",className:"order-form-stripe-payment-button"},l[s.AMAZONHP]={order:13,icon:"amazon",text:"Pay with Amazon",className:"order-form-amazon-payment-button"},l[s.IDEAL]={order:14,className:"order-form-image-payment-button",processor:s.STRIPE,idealImage:!0},l[s.SOFORT]={order:15,className:"order-form-image-payment-button",processor:s.STRIPE,sofortImage:!0},l[s.ALIPAY]={order:16,alipayImage:!0,processor:s.STRIPE,className:"order-form-image-payment-button"},l[s.COINBASE]={order:17,icon:"bitcoin",text:"Pay with Bitcoin",className:"order-form-simple-payment-button"},l[s.SIMULATOR]={order:18,text:"Simulator",className:"order-form-payment-simulator-button"},l[s.FREE]={order:19,className:"order-form-simple-payment-button",text:"Get it for free!"};var c=function(e){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,e),_createClass(n,[{key:"generateProcessors",value:function(e,n,i){"US"===i&&this.US_ORDER_OVERRIDE.forEach(function(e,t){l[e].order=t}),t.includes(this.ALIPAY_REGIONS,i)&&this.ALIPAY_ORDER_OVERRIDE.forEach(function(e,t){l[e].order=t});var a=e.map(function(e){if(l[e])return t.assignIn(l[e],{id:e})});if(n&&e.indexOf(n.processor)>-1){var o=n.processor===s.PAYPAL,r={order:-1,id:s.STORED_CREDENTIAL,text:"Pay instantly with"+(o?"":" card"),className:"order-form-stored-payment-button",paypalImage:o,credentialText:n.text};a.push(r)}this.add(t.compact(a))}},{key:"getDefaults",value:function(e){if(!this.defaults){var t=this.HIDE;e||(t+=this.NON_DEFAULT),this.defaults=this.reject(function(e){return t.indexOf(e.id)>-1})}return this.defaults}}]),n}(i.Collection);c.prototype.comparator="order",c.prototype.NON_DEFAULT=[s.AMAZONHP,s.ALIPAY],c.prototype.HIDE=[s.FREE,s.SOFORT,s.IDEAL],c.prototype.US_ORDER_OVERRIDE=[s.STRIPE,s.PAYPAL,s.AMAZONHP],c.prototype.ALIPAY_ORDER_OVERRIDE=[s.ALIPAY,s.PAYPAL,s.STRIPE],c.prototype.ALIPAY_REGIONS=["CN","HK","JP","MO","TW"];var u=function(t){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return _inherits(a,t),_createClass(a,[{key:"initialize",value:function(e){this.windowSize=e.windowSize,this.hasFreeContent=e.hasFreeContent,this.modalView=e.modalView,this.setDefaultPaymentCredential(e.paymentCredentials),this.customView=(n.getQueryParam("cv")||"").toLowerCase();var t=n.getQueryParam("show_all_payments"),i=n.isDefaultVersion(),s=n.isDebugUnsafe();this.showPopular=!e.dontShowPopular,this.shouldShowAll=t||i||s,this.listenTo(this.windowSize,"change:small",this.render.bind(this)),this.listenTo(this.model,"change:amount_pennies",this.render.bind(this)),this.listenTo(this.model,"change:in_progress",this.updateLoadingView.bind(this))}},{key:"generateProcessorCollection",value:function(e,t){this.collection=new c,this.collection.generateProcessors(e,this.defaultPaymentCredential,t)}},{key:"setDefaultPaymentCredential",value:function(e){if(e&&e.length>0){var t=e[0];if("stripe"===t.credentials_type||"paypal"===t.credentials_type){this.defaultPaymentCredential=t,this.defaultPaymentCredentialUid=this.defaultPaymentCredential.credentials_uid;var n=this.defaultPaymentCredential.credentials_name;/^\d{4}$/.test(n)?this.defaultPaymentCredential.text="Ending in: "+n:n.length>21?this.defaultPaymentCredential.text="Account: "+n.slice(0,18)+"...":this.defaultPaymentCredential.text="Account: "+n}}}},{key:"showMoreOptions",value:function(){this.customView=!1,this.showPopular=!1,this.windowSize.get("small")?this.openModal():this.render()}},{key:"getProcessors",value:function(){var e=[];return e=this.isSetToFree()&&this.collection.get(s.FREE)?[this.collection.get(s.FREE)]:this.customView&&this.collection.get(this.customView)?[this.collection.get(this.customView)]:this.windowSize.get("small")&&this.collection.first()?[this.collection.first()]:this.collection.getDefaults(this.shouldShowAll),this.showPopular&&(e=e.slice(0,3)),e}},{key:"isSetToFree",value:function(){return this.hasFreeContent&&this.model.get("amount_pennies")<1}},{key:"isMoreOptions",value:function(e){var t=this.collection.getDefaults(this.shouldShowAll);return t.length>e.length}},{key:"openModal",value:function(){var e=new o,t=new a({className:"payment-modal-view",hasFreeContent:this.hasFreeContent,windowSize:new i.Model,dontShowPopular:!0,model:this.model,collection:this.collection,modalView:e});e.render(),e.attachSubview(t)}},{key:"onClickSubmit",value:function(t){this.submit(e(t.currentTarget).data("processor"))}},{key:"submit",value:function(e){var t=this.collection.get(e);this.model.set("selected_processor",{processor:t.escape("processor")||t.id,paymentType:t.get("processor")?t.id:void 0}),this.model.trigger("change:submit_form"),this.modalView&&this.modalView.closeModal()}},{key:"hideOrderButtons",value:function(){var e=this;this.ui.paymentOptions.fadeOut(300,function(){e.ui.loadingSpinner.show(),e.ui.loadingSpinner.animate({top:"5px",opacity:"1"},400)})}},{key:"showOrderButtons",value:function(){this.ui.loadingSpinner.hide(),this.ui.paymentOptions.show()}},{key:"updateLoadingView",value:function(){this.model.get("in_progress")?this.hideOrderButtons():this.showOrderButtons()}},{key:"serializeData",value:function(){var e=this.getProcessors(),t=!this.isSetToFree()&&this.isMoreOptions(e);return{processors:e,moreOptions:t}}}]),a}(a);return u.prototype.template=r,u.prototype.events={"click .js-order-form-show-more-button":"showMoreOptions","click .js-payment-button":"onClickSubmit"},u.prototype.ui={loadingSpinner:".order-form-purchase-in-progress-spinner",paymentOptions:".order-form-payment-options-container"},{PaymentOptionsView:u,PaymentProcessors:c}}),define("lib/hbTemplate!orderform/templates/gift_template.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'  <input id="giftcheckbox" type="checkbox" name="gift" class="giftcheckbox" <% if (isGiftSelected) { %>checked<% } %> >\n  <label for="giftcheckbox" class="checkmark-box js-gift-box" ><i class="hb hb-checkmark"></i></label>\n  <i class="hb hb-gift"></i>\n<% if (!isGiftSelected) { %>\n  <div class="js-gift-box inline-clickable">This purchase is a gift.</div>\n\n\n<% } else { %>\n  <% if (isGiftLink) { %>\n  <div class="js-gift-box inline-clickable">A gift link will be sent to your email.</div>\n  <div class="gift-link-container">\n    Want to send directly to a friend? <button type="button" class="js-gift-link color-neutral-link">Fill in their email.</button>\n  </div>\n  <% } else { %>\n  <input\n    id="gift_email"\n    class="order-form-email-input"\n    type="text"\n    name="gift_email"\n    placeholder="Enter your gift recipient\'s address"\n  />\n  <div class="order-form-email-error-container"></div>\n  <div>\n    <input id="gift_anonymous" type="checkbox" name="gift_anonymous" class="giftcheckbox" <% if (isGiftAnonymous) { %>checked<% } %> />\n    <label for="gift_anonymous" class="checkmark-box js-gift-anonymous" ><i class="hb hb-checkmark"></i></label>\n    <div class="js-gift-anonymous inline-clickable">Make this gift anonymous</div>\n  </div>\n  <div>\n    Don\'t want to send your gift now? <button type="button" class="js-gift-link color-neutral-link">Get a giftable link.</button>\n    <span\n      class="order-form-gift-tooltip tooltip-left"\n      data-tooltip="We\'ll send you a unique link to give to anyone you please!">\n        <i class="hb hb-support"></i>\n    </span>\n  </div>\n  <% } %>\n<% } %>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("orderform/Gift",["common/DOMLessView","hbtemplate!./templates/gift_template.html"],function(e,t){"use strict";var n=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){this.isGiftSelected=!1,this.isGiftLink=!1,this.isGiftAnonymous=!1}},{key:"clickGiftLink",value:function(e){this.isGiftLink=!this.isGiftLink,this.render()}},{key:"selectGift",value:function(){this.isGiftSelected=!this.isGiftSelected,this.render()}},{key:"getOrderFormParameters",value:function(){var e={gift:this.isGiftSelected?"on":null};return this.isGiftSelected&&(this.isGiftLink||(e.gift_email=this.$("#gift_email").val(),this.isGiftAnonymous&&(e.gift_anonymous="on"))),e}},{key:"clickAnonymous",value:function(){this.isGiftAnonymous=!this.isGiftAnonymous,this.render()}},{key:"serializeData",value:function(){return{isGiftSelected:this.isGiftSelected,isGiftLink:this.isGiftLink,isGiftAnonymous:this.isGiftAnonymous}}}]),t}(e);return n.prototype.events={"click .js-gift-box":"selectGift","click .js-gift-link":"clickGiftLink","click .js-gift-anonymous":"clickAnonymous"},n.prototype.template=t,n}),define("lib/hbTemplate!orderform/templates/subscription_warning.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<aside class="order-form-error-msg order-form-error-blue">\n  <div class="order-form-error-text-container">\n    <p class="order-form-error-text">\n      Warning: You will not receive the <%- humanName %>!\n      <a href="/monthly" target=_blank>Subscribe to Humble Monthly</a>\n      prior to purchase to receive this!\n<% if (!loggedIn) { %>\n      Already a subscriber?\n      <a href="#" class="order-form-account-login-button js-account-login">Log in</a>\n<% } %>\n    </p>\n  </div>\n</aside>'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("orderform/SubscriptionWarningView",["common/DOMLessView","hbtemplate!./templates/subscription_warning.html"],function(e,t){"use strict";var n=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){var t=e.humanName,n=e.loggedIn;this.humanName=t,this.loggedIn=n}},{key:"serializeData",value:function(){var e=this.humanName,t=this.loggedIn;return{humanName:e,loggedIn:t}}}]),t}(e);return n.prototype.template=t,n}),define("constants/skipCodes",["require"],function(e){return{SKIP_CODE_SECONDS:300}}),define("lib/hbTemplate!account/templates/AccountStart.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="full-logo">\n  <img src="xSTATIC_URLx/static/hashed/2601f8ca3aefe063e1e1c0fbdb6ef0ecc2c7f9f2.svg" alt="Humble Bundle">\n</div>\n<button class="button large account-cta green js-account-login">Log in</button>\n<br>\n<br>\n<button class="button large account-cta green js-account-signup">Sign up</button>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("account/AccountStartView",["require","common/DOMLessView","hbtemplate!./templates/AccountStart.html"],function(e){"use strict";var t=e("common/DOMLessView"),n=e("hbtemplate!./templates/AccountStart.html"),i=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"onRender",value:function(){$(".account-modal-outer").addClass("account-reveal-background-image")}},{key:"onBeforeDestroy",value:function(){$(".account-modal-outer").removeClass("account-reveal-background-image")}}]),t}(t);return i.prototype.className="account-view",i.prototype.template=n,i}),define("util/csrfUtils",["constants/csrfConstants"],function(e){function t(){var t=document.cookie,n=t.lastIndexOf(e.CSRF_COOKIE_KEY);n=n+e.CSRF_COOKIE_KEY.length+1;var t=t.slice(n),i="";if(t.length){var s=t.indexOf(";");i=s>-1?t.slice(0,s):t}return i}return{getCsrf:t,formKey:e.CSRF_FORM_KEY,headerKey:e.CSRF_HEADER_KEY}});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("account/collections/Validators",["require","backbone"],function(e){"use strict";var t=e("backbone"),n=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"validate",value:function(e){var t=this.get("validation")(e.get(this.id));return this.set("valid",t),t&&this.set("show_error",!1),t}}]),t}(t.Model);n.prototype.defaults={validation:function(){return!0},valid:!0,show_error:!1};var i=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"validate",value:function(e,t){t=t||[];var n=!0;return this.each(function(i){var s=i.validate(e);!s&&t.indexOf(i.id)>-1&&i.set("show_error",!0),s||(n=!1)}),n}}]),t}(t.Collection);return i.prototype.model=n,i}),define("lib/hbTemplate!account/templates/SubmitButton.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<button type="submit" name="button"\n       class="button large account-cta<% if (valid && !loading) { %> green<% } %>"\n       <% if (!valid || loading) { %> disabled<% } %>>\n       <% if (!loading) { %>\n         <%= cta %>\n      <% } else { %>\n        \n        <div class="sk-circle">\n          <div class="sk-circle1 sk-child"></div>\n          <div class="sk-circle2 sk-child"></div>\n          <div class="sk-circle3 sk-child"></div>\n          <div class="sk-circle4 sk-child"></div>\n          <div class="sk-circle5 sk-child"></div>\n          <div class="sk-circle6 sk-child"></div>\n          <div class="sk-circle7 sk-child"></div>\n          <div class="sk-circle8 sk-child"></div>\n          <div class="sk-circle9 sk-child"></div>\n          <div class="sk-circle10 sk-child"></div>\n          <div class="sk-circle11 sk-child"></div>\n          <div class="sk-circle12 sk-child"></div>\n        </div>\n      <% } %></button>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/ErrorBox.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="js-close-message close-message">\n  <i class="hb hb-times"></i>\n</div>\n<div class="error-message"><%= message %></div>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("account/BaseAccountView",["require","lib/jquery/full","lib/lodash","backbone","constants/skipCodes","common/DOMLessView","util/csrfUtils","account/collections/Validators","hbtemplate!./templates/SubmitButton.html","hbtemplate!./templates/ErrorBox.html"],function(e){"use strict";var t=e("lib/jquery/full"),n=e("lib/lodash"),i=e("backbone"),s=e("constants/skipCodes"),a=e("common/DOMLessView"),o=e("util/csrfUtils"),r=e("account/collections/Validators"),l=e("hbtemplate!./templates/SubmitButton.html"),c=e("hbtemplate!./templates/ErrorBox.html"),u=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){this.listenTo(this.model,"change:valid",this.render.bind(this)),this.listenTo(this.model,"change:loading",this.render.bind(this))}}]),t}(a);u.prototype.template=l;var d=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){var t=e.errorMessage;this.errorMessage=t,this.listenTo(this.model,"change:show_error",this.toggle.bind(this))}},{key:"toggle",value:function(){this.model.get("show_error")?this.$el.show():this.$el.hide()}},{key:"showErrorMessage",value:function(){this.errorMessage.set({message:this.model.get("submit_message")||this.model.get("message"),show_message:!0}),this.model.unset("submit_message")}}]),t}(i.View);d.prototype.events={click:"showErrorMessage"};var h=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){this.listenTo(this.model,"change:show_message",this.render.bind(this)),this.listenTo(this.model,"change:message",this.render.bind(this))}},{key:"closeErrorMessage",value:function(){this.model.set("show_message",!1)}},{key:"slideView",value:function(){var e=this;this.model.get("show_message")?(this.$el.addClass("slide-up"),this.model.set("timeout",setTimeout(function(){e.model.set("show_message",!1),e.model.unset("timeout")},5e3))):(this.model.get("timeout")&&(clearTimeout(this.model.get("timeout")),this.model.unset("timeout")),this.$el.removeClass("slide-up"))}},{key:"onRender",value:function(){this.slideView()}}]),t}(a);h.prototype.events={"click .js-close-message":"closeErrorMessage"},h.prototype.template=c;var m=function(e){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return _inherits(a,e),_createClass(a,[{key:"initialize",value:function(e){var t=e.attributes;this.createModel(t||{}),this.createValidators(this.validations),this.listenTo(this.model,"change:previous_view",this.render.bind(this))}},{key:"addValidator",value:function(e){this.removeValidator(e.id);var t=new d({model:e,errorMessage:this.errorMessage,el:this.$("#error-"+e.id)});this.inputErrors[e.id]=t}},{key:"createModel",value:function(e){var t={};if(e.gotoHref&&"#"!=e.gotoHref)t={goto:e.gotoHref,qs:e.queryString};else{t.goto=window.location.pathname;var s=window.location.search;s&&(t.qs=s.substr(1))}this.model=new i.Model(n.extend({valid:!1,loading:!1,previous_view:!1,cta:this.cta},t,this.getDefaultFields(e)))}},{key:"createValidators",value:function(e){this.validators=new r(e),this.errorMessage=new i.Model({message:"",show_message:!1}),this.inputErrors={}}},{key:"executeCaptcha",value:function(e,t){if(this.model.get("captcha-skip-code"))return void e();if(this.captcha)this.captcha.reset();else{var n=this.cid+"-captcha";this.$(t).html('<div id="'+n+'"></div>'),this.captcha=CreateCaptcha(n,e,{size:"invisible"})}this.captcha.execute()}},{key:"getCaptchaData",value:function(e){var t={};return this.model.get("captcha-skip-code")?(n.extend(t,{"captcha-skip-code":this.model.get("captcha-skip-code")}),this.model.unset("captcha-skip-code")):this.captcha&&n.extend(t,this.captcha.getResponseParameters(e,!0)),t}},{key:"getDefaultFields",value:function(){return{}}},{key:"getSubmitData",value:function(){return{}}},{key:"onBeforeDestroy",value:function(){n.values(this.inputErrors).forEach(function(e){return e.remove()})}},{key:"onError",value:function(e){var t=this,i=e.responseJSON,s="Submit failed. Please try again.";i=i||{},i.skip_code&&this.setModelSkipCode(i.skip_code),i.errors&&n.forOwn(i.errors,function(e,n){var i=null;e.length&&(i=e[0]),t.validators.get(n)?t.validators.get(n).set({submit_message:i,show_error:!0}):s=i}),this.model.set("loading",!1),this.errorMessage.set({message:s,show_message:!0})}},{key:"onRender",value:function(){var e=this,t=new u({el:this.$(".account-submit"),model:this.model});t.render();var n=new h({el:this.$(".error-box"),model:this.errorMessage});n.render(),this.validators.each(function(t){return e.addValidator(t)})}},{key:"onSubmit",value:function(e){if(e&&e.preventDefault(),this.validate())return this.errorMessage.set({message:"",show_message:!1}),this.model.set("loading",!0),this.captchaRequired?void this.executeCaptcha(this.submitRequest.bind(this),".account-captcha"):void this.submitRequest()}},{key:"onSuccess",value:function(e){this.model.set("loading",!1)}},{key:"removeValidator",value:function(e){this.inputErrors[e]&&(this.inputErrors[e].remove(),delete this.inputErrors[e])}},{key:"setModelSkipCode",value:function(e){var t=this;e=e||this.model.get("extra_skip_codes"),e&&e.length&&(this.model.set("captcha-skip-code",e.pop()),this.model.set("extra_skip_codes",e),setTimeout(function(){t.model.unset("captcha-skip-code"),t.model.unset("extra_skip_codes")},1e3*(s.SKIP_CODE_SECONDS-60)))}},{key:"submitRequest",value:function(e){var i=this.getSubmitData();n.extend(i,this.getCaptchaData(e)),t.ajax({data:i,type:"POST",url:this.url,dataType:"json",headers:_defineProperty({},o.headerKey,o.getCsrf()),error:this.onError.bind(this),success:this.onSuccess.bind(this)})}},{key:"updateModel",value:function(e){var n=t(e.target);this.model.set(n.attr("name"),n.val()),this.validate()}},{key:"updateCheckbox",value:function(e){var n=t(e.target);this.model.set(n.attr("name"),n.is(":checked")),this.validate()}},{key:"updateMessaging",value:function(e){var n=t(e.target);this.validate([n.attr("name")])}},{key:"validate",value:function(e){var t=this.validators.validate(this.model,e);return this.model.set("valid",t),t}}]),a}(a);return m.prototype.className="account-view",m.prototype.events={input:"updateModel","change input:checkbox":"updateCheckbox","blur input":"updateMessaging",submit:"onSubmit"},m.prototype.tagName="form",m.prototype.template=!1,m.prototype.validations=[],m}),define("lib/hbTemplate!account/templates/AccountSignup.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<% if (previous_view) { %>\n<div class="account-back-arrow js-previous">\n  <i class="hb hb-chevron-left"></i>\n</div>\n<% } %>\n<div class="account-captcha"></div>\n<div class="checkbox">\n  <input type="checkbox" name="subscribe" value="true" <% if (subscribe) { %>checked<% } %>>\n  <label for="">Notify me about Humble Bundle promotions. (You may unsubscribe from the newsletter at any time)</label>\n</div>\n<div class="account-information account-fine-print">\n  I <% if (countryCode == \'US\') { %>am 13 years of age or older and <% } %>understand and agree to this website\'s <a href="/terms">Terms</a> and <a href="/privacy">Privacy Policy</a>.\n</div>\n<div class="account-input-group">\n  <div class="suggestion-popup"></div>\n  <label for="" class="account-label">Email</label>\n  <input type="email" name="email" value="<%= email %>" class="account-input">\n  <div id="error-email" class="error-triangle"><i class="hb hb-alert"></i></div>\n</div>\n<div class="account-input-group">\n  <label for="" class="account-label">Password</label>\n  <input type="password" name="password" value="<%= password %>" class="account-input">\n  <div id="error-password" class="error-triangle"><i class="hb hb-alert"></i></div>\n</div>\n<div class="account-information account-support">\n  <a href="https://support.humblebundle.com/hc/en-us/requests/new" target="_blank">Contact Support</a>\n</div>\n<div class="account-submit"></div>\n<div class="error-box"></div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/InputSuggestion.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'Did you mean <span class="js-email-suggestion email-suggestion"><%= address %>@<strong><%= domain %></strong></span>?\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("account/SignUpView",["require","lib/jquery/full","lib/lodash","backbone","util/main","lib/email-validation","common/DOMLessView","account/BaseAccountView","hbtemplate!./templates/AccountSignup.html","hbtemplate!./templates/InputSuggestion.html"],function(e){"use strict";var t=e("lib/jquery/full"),n=e("lib/lodash"),i=e("backbone"),s=e("util/main"),a=e("lib/email-validation"),o=e("common/DOMLessView"),r=e("account/BaseAccountView"),l=e("hbtemplate!./templates/AccountSignup.html"),c=e("hbtemplate!./templates/InputSuggestion.html"),u=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){var t=e.$input,n=e.formModel;this.$input=t,this.formModel=n,this.listenTo(this.formModel,"change:email",this.fadeOut.bind(this))}},{key:"fadeOut",value:function(){var e=this;this.$el.parent().fadeOut(function(){return e.remove()})}},{key:"setSuggestion",value:function(){this.$input.val(this.model.get("full")),this.formModel.set("email",this.model.get("full"))}}]),t}(o);u.prototype.events={"click .js-email-suggestion":"setSuggestion"},u.prototype.template=c;var d=function(e){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,e),_createClass(n,[{key:"getDefaultFields",value:function(e){var t=window.models&&window.models.request.country_code,n=!("CA"===t||e.is_eu_country);return{countryCode:t,subscribe:n,email:null,password:null}}},{key:"recommendDomain",value:function(e){var n=this,s=t(e.target);s.mailcheck({domains:a.MAILCHECK_DOMAINS,suggested:function(e,t){var s=new i.Model(t),a=new u({model:s,$input:e,formModel:n.model}).render();n.$(".suggestion-popup").html(a.$el),n.$(".suggestion-popup").fadeIn()}})}},{key:"getSubmitData",value:function(){var e=this.model.attributes,t=e.subscribe,n=e.email,i=e.password,s=e.goto,a=e.qs;return{subscribe:t,email:n,password:i,goto:s,qs:a}}},{key:"onSuccess",value:function(e){e=e||{},s.redirectInDomain(e.goto||"/")}}]),n}(r);return d.prototype.captchaRequired=!0,d.prototype.cta="Sign up",d.prototype.events=n.extend({"change input[type=email]":"recommendDomain"},r.prototype.events),d.prototype.template=l,d.prototype.url="/signup",d.prototype.validations=[{id:"email",validation:a.isValidEmail,message:"Invalid Email"},{id:"password",validation:function(e){return e&&e.length>3},message:"Password must be at least 4 characters"}],d});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("account/SendSmsView",["require","lib/lodash","util/csrfUtils","account/BaseAccountView"],function(e){"use strict";var t=e("lib/lodash"),n=e("util/csrfUtils"),i=e("account/BaseAccountView"),s=function(e){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return _inherits(i,e),_createClass(i,[{key:"initialize",value:function(e){var t=e.errorMessage;this.errorMessage=t}},{key:"onSendSmsClick",value:function(e){e.preventDefault(),this.model.get("loading")||(this.$text=$(e.target),this.$text.html("Sending...."),this.model.set("loading",!0),this.executeCaptcha(this.sendSms.bind(this),".sms-captcha"))}},{key:"sendSms",value:function(e){var i=this,s=arguments,a=_defineProperty({},n.headerKey,n.getCsrf()),o=t.cloneDeep(this.model.attributes);t.extend(o,this.getCaptchaData(e)),$.ajax({headers:a,data:o,url:"/user/authy/send-sms",type:"POST",dataType:"json"}).success(function(e){var t="SMS sent! Please enter your code.";i.errorMessage.set({message:t,show_message:!0}),i.setModelSkipCode(e.skip_code)}).error(function(){i.onError(s)}).always(function(){i.$text.html("Resend SMS"),i.model.set("loading",!1)})}}]),i}(i);return s.prototype.events={"click .js-send-sms":"onSendSmsClick"},s}),define("lib/hbTemplate!account/templates/TwoFactor.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="account-captcha"></div>\n<div class="account-input-group">\n  <div class="suggestion-popup"></div>\n  <label for="" class="account-label"><%= twofactor_type === \'authy\' ? \'Authy Code\' : \'Google Authenticator\' %></label>\n  <input type="text" name="code" value="<%= code %>" class="account-input">\n  <div id="error-code" class="error-triangle"><i class="hb hb-alert"></i></div>\n</div>\n<% if (twofactor_type === \'authy\') { %>\n  <div class="account-information account-support account-support-split sms-view">\n    <span class="js-send-sms">Send SMS</span>\n    <div class="sms-captcha"></div>\n    <a href="https://support.humblebundle.com/hc/en-us/articles/202421374" target="_blank">Help</a>\n  </div>\n<% } else { %>\n  <div class="account-information account-support">\n    <a href="https://support.humblebundle.com/hc/en-us/articles/202421374" target="_blank">Help</a>\n  </div>\n<% } %>\n<div class="account-submit"></div>\n<div class="error-box"></div>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("account/TwoFactorView",["require","util/main","account/BaseAccountView","account/SendSmsView","hbtemplate!./templates/TwoFactor.html"],function(e){"use strict";var t=e("util/main"),n=e("account/BaseAccountView"),i=e("account/SendSmsView"),s=e("hbtemplate!./templates/TwoFactor.html"),a=function(e){function s(){return _classCallCheck(this,s),_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return _inherits(s,e),_createClass(s,[{key:"initialize",value:function(e){var t=e.attributes;this.model=t.model,this.model.set({valid:!1,loading:!1,cta:this.cta}),this.createValidators(this.validations)}},{key:"getSubmitData",value:function(){var e=this.model.attributes,t=e.username,n=e.password,i=e.code,s=e.qs,a=e.goto;return{username:t,password:n,code:i,qs:s,goto:a}}},{key:"onRender",value:function(){"authy"===this.model.get("twofactor_type")&&new i({model:this.model,el:this.$(".sms-view"),errorMessage:this.errorMessage}),n.prototype.onRender.apply(this)}},{key:"onSuccess",
value:function(e){e=e||{},t.redirectInDomain(e.goto||"/")}}]),s}(n);return a.prototype.captchaRequired=!0,a.prototype.cta="Authenticate",a.prototype.template=s,a.prototype.url="/processlogin",a.prototype.validations=[{id:"code",validation:function(e){return!!e},message:"Code Required"}],a}),define("lib/hbTemplate!account/templates/Login.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<% if (previous_view) { %>\n<div class="account-back-arrow js-previous">\n  <i class="hb hb-chevron-left"></i>\n</div>\n<% } %>\n<% if (free_copy) { %>\n<div class="account-information">\n  You must be logged into a Humble Bundle account to redeem your free copy of <%= free_copy %>\n</div>\n<% } %>\n<div class="account-captcha"></div>\n<div class="account-input-group">\n  <div class="suggestion-popup"></div>\n  <label for="" class="account-label">Email</label>\n  <input type="email" name="username" value="<%= username %>" class="account-input">\n  <div id="error-username" class="error-triangle"><i class="hb hb-alert"></i></div>\n</div>\n<div class="account-input-group">\n  <label for="" class="account-label">Password</label>\n  <input type="password" name="password" value="<%= password %>" class="account-input">\n  <div id="error-password" class="error-triangle"><i class="hb hb-alert"></i></div>\n</div>\n<div class="account-information account-support">\n  <span class="js-password-reset">Forgot Password?</span>\n</div>\n<div class="account-submit"></div>\n<div class="error-box"></div>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("account/LoginView",["require","backbone","util/main","account/BaseAccountView","account/TwoFactorView","hbtemplate!./templates/Login.html"],function(e){"use strict";var t=e("backbone"),n=e("util/main"),i=e("account/BaseAccountView"),s=e("account/TwoFactorView"),a=e("hbtemplate!./templates/Login.html"),o=function(e){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return _inherits(a,e),_createClass(a,[{key:"getDefaultFields",value:function(e){var t=e.free_copy;return{username:null,password:null,free_copy:t}}},{key:"getSubmitData",value:function(){var e=this.model.attributes,t=e.username,n=e.password,i=e.goto,s=e.qs;return{username:t,password:n,goto:i,qs:s}}},{key:"onError",value:function(e){var n=e.responseJSON;if(n&&n.two_factor_required){this.setModelSkipCode(n.skip_code);var a={username:this.model.get("username"),password:this.model.get("password"),goto:this.model.get("goto"),qs:this.model.get("qs"),code:null,active_view:"twofactor",twofactor_type:n.twofactor_type,extra_skip_codes:this.model.get("extra_skip_codes"),"captcha-skip-code":this.model.get("captcha-skip-code"),use_modal_model:!0};if(this.modal)this.modal.set(a);else if(this.$parentEl){var o=new s({attributes:{model:new t.Model(a)}});this.$parentEl.html(o.render().el),this.remove()}}else i.prototype.onError.apply(this,arguments),n&&n.errors&&n.errors.username&&this.errorMessage.set({message:n.errors.username[0],show_message:!0})}},{key:"onRender",value:function(){this.$el.attr("novalidate",!0),i.prototype.onRender.apply(this)}},{key:"onSuccess",value:function(e){e=e||{},n.redirectInDomain(e.goto||"/")}}]),a}(i);return o.prototype.captchaRequired=!0,o.prototype.cta="Log in",o.prototype.template=a,o.prototype.url="/processlogin",o.prototype.validations=[{id:"username",validation:function(e){return!!e},message:"Email Required"},{id:"password",validation:function(e){return!!e},message:"Password Required"}],o}),define("lib/hbTemplate!account/templates/HumbleGuard.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="account-captcha"></div>\n<div class="account-information">\n  <h1>Verify account</h1>\n  It looks like you are accessing your Humble Bundle account from an unfamiliar browser.\n  For your protection, we need to verify that this computer is yours.\n  We\'ve sent a code to the email address attached to this account.\n</div>\n<div class="account-input-group">\n  <label for="" class="account-label">Code</label>\n  <input type="text" name="code" value="<%= code %>" class="account-input">\n  <div id="error-code" class="error-triangle"><i class="hb hb-alert"></i></div>\n</div>\n<div class="account-information account-support account-support-split js-email-view">\n  <div class="js-resend-code"><span>Resend Code</span></div>\n  <div class="email-captcha"></div>\n  <div><a href="https://support.humblebundle.com/hc/en-us/requests/new" target="_blank">Contact Support</a></div>\n</div>\n<div class="account-submit"></div>\n<div class="error-box"></div>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("account/HumbleGuardView",["require","lib/jquery/full","lib/lodash","util/csrfUtils","util/main","account/BaseAccountView","hbtemplate!./templates/HumbleGuard.html"],function(e){"use strict";var t=e("lib/jquery/full"),n=(e("lib/lodash"),e("util/csrfUtils")),i=e("util/main"),s=e("account/BaseAccountView"),a=e("hbtemplate!./templates/HumbleGuard.html"),o=function(e){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return _inherits(i,e),_createClass(i,[{key:"initialize",value:function(e){var t=e.errorMessage;this.errorMessage=t}},{key:"onSendEmailClick",value:function(e){e.preventDefault(),this.model.get("loading")||(this.$text=t(e.target),this.$text.html("Resending...."),this.model.set("loading",!0),this.executeCaptcha(this.sendEmail.bind(this),".email-captcha"))}},{key:"sendEmail",value:function(e){var i=this,s=_defineProperty({},n.headerKey,n.getCsrf());t.ajax({type:"POST",url:"/user/humbleguard?resend=1",headers:s}).success(function(e){var t="Code Resent";i.errorMessage.set({message:t,show_message:!0}),i.setModelSkipCode(e.skip_code)}).error(function(){var e="Slow Down! Please wait 24 hours before trying again.";i.errorMessage.set({message:e,show_message:!0})}).always(function(){i.$text.html("Resend Code"),i.model.set("loading",!1)})}}]),i}(s);o.prototype.events={"click .js-resend-code":"onSendEmailClick"};var r=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"getDefaultFields",value:function(e){return{code:null}}},{key:"getSubmitData",value:function(){var e=this.model.attributes,t=e.code,n=e.goto,i=e.qs;return{code:t,goto:n,qs:i}}},{key:"onRender",value:function(){new o({model:this.model,el:this.$(".js-email-view"),errorMessage:this.errorMessage}),s.prototype.onRender.apply(this)}},{key:"onSuccess",value:function(e){this.successCallback?(this.successCallback(),this.modal.set("close",!0)):i.redirectInDomain(e.goto||"/")}},{key:"onBeforeDestroy",value:function(){this.destroyCallback&&this.destroyCallback(),s.prototype.onBeforeDestroy.call(this)}}]),t}(s);return r.prototype.captchaRequired=!0,r.prototype.cta="Verify",r.prototype.url="/user/humbleguard",r.prototype.validations=[{id:"code",validation:function(e){return!!e},message:"Please enter your code"}],r.prototype.template=a,r}),define("lib/hbTemplate!account/templates/PasswordConfirmation.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="account-captcha"></div>\n<div class="account-information">\n  <h1>Confirm Password</h1>\n  For security reasons, please enter your current password.\n</div>\n<div class="account-input-group">\n  <label for="" class="account-label">Password</label>\n  <input type="password" name="password" value="<%= password %>" class="account-input">\n  <div id="error-password" class="error-triangle"><i class="hb hb-alert"></i></div>\n</div>\n<% if (two_factor_required) { %>\n  <div class="account-input-group">\n    <div class="suggestion-popup"></div>\n    <label for="" class="account-label"><%= twofactor_type === \'authy\' ? \'Authy Code\' : \'Google Authenticator\' %></label>\n    <input type="text" name="code" value="<%= code %>" class="account-input">\n    <div id="error-code" class="error-triangle"><i class="hb hb-alert"></i></div>\n  </div>\n  <% if (twofactor_type === \'authy\') { %>\n    <div class="account-information account-support account-support-split sms-view">\n      <span class="js-send-sms">Send SMS</span>\n      <div class="sms-captcha"></div>\n      <a href="https://support.humblebundle.com/hc/en-us/articles/202421374" target="_blank">Help</a>\n    </div>\n  <% } else { %>\n    <div class="account-information account-support">\n      <a href="https://support.humblebundle.com/hc/en-us/articles/202421374" target="_blank">Help</a>\n    </div>\n  <% } %>\n<% } else { %>\n  <div class="account-information account-support">\n    <div><a href="https://support.humblebundle.com/hc/en-us/requests/new" target="_blank">Contact Support</a></div>\n  </div>\n<% } %>\n<div class="account-submit"></div>\n<div class="error-box"></div>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("account/PasswordConfirmationView",["require","lib/jquery/full","util/csrfUtils","util/main","account/BaseAccountView","account/SendSmsView","hbtemplate!./templates/PasswordConfirmation.html"],function(e){"use strict";var t=(e("lib/jquery/full"),e("util/csrfUtils"),e("util/main"),e("account/BaseAccountView")),n=e("account/SendSmsView"),i=e("hbtemplate!./templates/PasswordConfirmation.html"),s=function(e){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return _inherits(i,e),_createClass(i,[{key:"getDefaultFields",value:function(e){var t=e.two_factor_required,n=e.twofactor_type;return{two_factor_required:t,twofactor_type:n,password:null,code:null}}},{key:"getSubmitData",value:function(){var e=this.model.attributes,t=e.password,n=e.code;return{password:t,code:n}}},{key:"onRender",value:function(){"authy"===this.model.get("twofactor_type")&&new n({model:this.model,el:this.$(".sms-view"),errorMessage:this.errorMessage}),t.prototype.onRender.apply(this)}},{key:"onSuccess",value:function(){this.successCallback&&this.successCallback(),this.modal.set("close",!0)}}]),i}(t);return s.prototype.captchaRequired=!0,s.prototype.cta="Confirm",s.prototype.url="/user/confirm-password",s.prototype.validations=[{id:"password",validation:function(e){return!!e},message:"Please enter your password"}],s.prototype.template=i,s}),define("lib/hbTemplate!account/templates/PasswordReset.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<% if (previous_view) { %>\n<div class="account-back-arrow js-previous">\n  <i class="hb hb-chevron-left"></i>\n</div>\n<% } %>\n<div class="account-captcha"></div>\n<div class="account-information">\n  We\'ll send a password reset link to your account\'s email address.\n</div>\n<div class="account-input-group">\n  <label for="" class="account-label">Email</label>\n  <input type="email" name="email" value="<%= email %>" class="account-input">\n  <div id="error-email" class="error-triangle"><i class="hb hb-alert"></i></div>\n</div>\n<div class="account-information account-support">\n  <a href="https://support.humblebundle.com/hc/en-us/requests/new" target="_blank">Contact Support</a>\n</div>\n<div class="account-submit"></div>\n<div class="error-box"></div>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("account/PasswordResetView",["require","lib/email-validation","account/BaseAccountView","hbtemplate!./templates/PasswordReset.html"],function(e){"use strict";var t=e("lib/email-validation"),n=e("account/BaseAccountView"),i=e("hbtemplate!./templates/PasswordReset.html"),s=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"getDefaultFields",value:function(){return{email:null}}},{key:"getSubmitData",value:function(){var e=this.model.attributes.email;return{email:e}}},{key:"onSuccess",value:function(e){this.modal&&this.modal.set({active_view:"reset-confirmation",email:this.model.get("email"),use_modal_model:!0})}}]),t}(n);return s.prototype.captchaRequired=!0,s.prototype.cta="Reset Password",s.prototype.url="/user/forgot",s.prototype.validations=[{id:"email",validation:t.isValidEmail,message:"Invalid Email"}],s.prototype.template=i,s}),define("lib/hbTemplate!account/templates/LoginConfirmation.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="account-success">\n  <h1>Welcome Back!</h1>\n</div>\n<button type="button" name="button" class="button large account-cta green js-close-modal">Done</button>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/SignUpConfirmation.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="account-success">\n  <h1>Thank you!</h1>\n  <p>\n    Your account has been successfully created! A confirmation email was sent to\n    <strong><%= email %></strong>\n  </p>\n  <p>\n    You can edit your account settings by visiting your <a href="/user/settings">user settings page</a>.\n  </p>\n</div>\n<div class="account-information account-support">\n  <a href="https://support.humblebundle.com/hc/en-us/requests/new" target="_blank">Contact Support</a>\n</div>\n<button type="button" name="button" class="button large account-cta green js-close-modal">Done</button>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/ResetConfirmation.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="account-success">\n  <h1>Password Reset</h1>\n  <p>\n    Your password has been successfully reset! A confirmation email was sent to\n    <strong><%= email %></strong>\n  </p>\n  <p>\n    This email may take a few minutes to arrive in your inbox.\n  </p>\n</div>\n<div class="account-information account-support">\n  <a href="https://support.humblebundle.com/hc/en-us/requests/new" target="_blank">Contact Support</a>\n</div>\n<button type="button" name="button" class="button large account-cta green js-close-modal">Done</button>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("account/EmailConfirmationView",["require","common/DOMLessView","hbtemplate!./templates/LoginConfirmation.html","hbtemplate!./templates/SignUpConfirmation.html","hbtemplate!./templates/ResetConfirmation.html"],function(e){"use strict";var t=e("common/DOMLessView"),n=e("hbtemplate!./templates/LoginConfirmation.html"),i=e("hbtemplate!./templates/SignUpConfirmation.html"),s=e("hbtemplate!./templates/ResetConfirmation.html"),a=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){var t=e.attributes;this.model=t.model}}]),t}(t);a.prototype.className="account-view account-confirmation";var o=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),t}(a);o.prototype.template=n;var r=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),t}(a);r.prototype.template=i;var l=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),t}(a);return l.prototype.template=s,{LoginConfirmationView:o,ResetConfirmationView:l,SignUpConfirmationView:r}}),define("lib/hbTemplate!account/templates/Modal.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="account-modal-outer">\n  <div class="top-bar">\n    <div>\n      <img src="xSTATIC_URLx/static/hashed/6b381fb0a8470825c2ab43057420a078c3897c6d.svg" class="logo">\n    </div>\n    <div class="close-modal js-close-modal">\n      <i class="hb hb-times"/>\n    </div>\n  </div>\n  <div class="account-modal-inner"></div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("account/Modal",["require","lib/jquery/full","lib/lodash","backbone","lib/backbone.modal","util/main","account/AccountStartView","account/SignUpView","account/LoginView","account/HumbleGuardView","account/PasswordConfirmationView","account/PasswordResetView","account/TwoFactorView","account/EmailConfirmationView","hbtemplate!./templates/Modal.html"],function(e){"use strict";var t=e("lib/jquery/full"),n=e("lib/lodash"),i=e("backbone"),s=(e("lib/backbone.modal"),e("util/main")),a=e("account/AccountStartView"),o=e("account/SignUpView"),r=e("account/LoginView"),l=e("account/HumbleGuardView"),c=e("account/PasswordConfirmationView"),u=e("account/PasswordResetView"),d=e("account/TwoFactorView"),h=e("account/EmailConfirmationView"),m=e("hbtemplate!./templates/Modal.html"),p=function(e){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,e),_createClass(n,[{key:"initialize",value:function(){this.model=new i.Model,this.previousViews=[],this.listenTo(this.model,"change:active_view",this.updateView.bind(this)),this.listenTo(this.model,"change:close",this.closeView.bind(this))}},{key:"beforeSubmit",value:function(e){return this.currentView.onSubmit(e),!1}},{key:"closeView",value:function(){this.model.get("close")&&this.destroy()}},{key:"setActive",value:function(){this.currentView.modal=this.model}},{key:"triggerView",value:function(e){i.Modal.prototype.triggerView.call(this,e),this.previousView&&(this.doNotPushPrevious||this.previousViews.push(this.previousView.constructor),this.previousView.remove()),this.currentView.model&&this.currentView.model.set("previous_view",!!this.previousViews.length),this.doNotPushPrevious=!1}},{key:"updateView",value:function(){var e={name:this.model.get("active_view")};this.model.get("use_modal_model")&&(this.attributes.model=this.model),this.openAt(e)}},{key:"beforeCancel",value:function(){this.model.get("goto")&&s.redirectInDomain(this.model.get("goto"))}},{key:"navigateBack",value:function(){this.previousViews.length&&(this.doNotPushPrevious=!0,this.openAt({view:this.previousViews.pop()}))}},{key:"onRender",value:function(){this.attributes&&this.attributes.isMobile&&t("html, body").addClass("fixed-height")}},{key:"onShow",value:function(){var e=this.$("input[type=text], input[type=email], input[type=password]");e.length&&e[0].focus(),"AccountStartView"===this.currentView.constructor.name&&this.$(".account-modal-outer").addClass("account-reveal-background-image")}},{key:"onDestroy",value:function(){this.attributes&&this.attributes.isMobile&&t("html, body").removeClass("fixed-height")}}]),n}(i.Modal);return p.prototype.cancelEl=".js-close-modal",p.prototype.events={"click .js-previous":"navigateBack"},p.prototype.prefix="account-bbm",p.prototype.template=n.template(m),p.prototype.viewContainer=".account-modal-inner",p.prototype.views={"account-start":{view:a,name:"account-start"},"click .js-account-signup":{view:o,name:"signup",onActive:"setActive"},"click .js-account-login":{view:r,name:"login",onActive:"setActive"},guard:{view:l,name:"guard",onActive:"setActive"},"click .js-password-reset":{view:u,name:"reset",onActive:"setActive"},"password-confirmation":{view:c,name:"password-confirmation",onActive:"setActive"},"login-confirmation":{view:h.LoginConfirmationView,name:"login-confirmation"},"signup-confirmation":{view:h.SignUpConfirmationView,name:"signup-confirmation"},"reset-confirmation":{view:h.ResetConfirmationView,name:"reset-confirmation"},twofactor:{view:d,name:"twofactor",onActive:"setActive"}},function(e){var n=e.name,i=e.attributes,s=e.successCallback,a=e.destroyCallback;i=i||{};var o=new p({attributes:i});o.render({name:n}),o.currentView.successCallback=s,o.currentView.destroyCallback=a,t("#site-modal").html(o.$el)}}),define("lib/hbTemplate!account/templates/loading_spinner.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<% if (loading) { %><img class="js-spinner" height=25 src="xSTATIC_URLx/static/hashed/26faf55c6e36ba3b1a57f9001942059fe05050f2.gif"><% } else { %><span class="main-base-arrow js-loader"></span><% } %>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_message.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<div class='generic-popup content'>\n  <h1 class='noimg'><%= title %></h1>\n\n  <div class='message-holder'><%= message %></div>\n    <div class='no-center'>\n      <div class='button-holder'>\n        <a class='button-link cancel js-cancel' href='#' data-goto='<%- gotoHref %>'><span class='green-button'>OK</span></a>\n      </div>\n      <div class='clearfix'></div>\n    </div>\n</div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_confirmation.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<div class='generic-popup content'>\n  <h1 class='noimg'><%= title %></h1>\n\n  <div class='message-holder'><%= message %></div>\n  <div class='no-center'>\n    <div class='button-holder'>\n      <a class='button-link cancel js-cancel' href='#'>\n        <span class='button small red'><%= cancelText || 'Cancel' %></span>\n      </a>\n      <a class='button-link submit js-submit' href='#'>\n        <span class='button small green'><%= confirmText || 'Confirm' %></span>\n      </a>\n    </div>\n    <div class='clearfix'></div>\n  </div>\n</div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_login.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="generic-popup content">\n  <h1 class="js-heading js-loading-header">Log In</h1>\n<% if (request_reason == \'secure-area\') { %>\n  <h2 class="subtitle warning">For security reasons, please enter your credentials.</h2>\n<% } %>\n  <p class="message-holder js-message-holder"></p>\n  <form id="account-login-form" method="post" action="<%= base_url_secure %>/processlogin" target="hidden-login-iframe" data-input-prefix="account-login-">\n    <p class="input-holder">\n      <label id="account-login-username-label" class="account-infield" for="account-login-username<%= suffix %>">Email</label>\n      <input name="username" type="email" id="account-login-username<%= suffix %>" class="account-input js-focus">\n    </p>\n    <p class="input-holder">\n      <label id="account-login-password-label" class="account-infield" for="account-login-password<%= suffix %>">Password</label>\n      <input name="password" type="password" value="" id="account-login-password<%= suffix %>" class="account-input">\n    </p>\n    <div class="two-factor"></div>\n    <div class="input-holder">\n      <div id="account-captcha"></div>\n    </div>\n    <div class="no-center">\n      <div class="link-holder">\n        <a class="js-forgot-pw" href="#">Forgot your password?</a><br/>\n        <a class="js-show-2fa show-2fa" href="">Two-step verification</a>\n      </div>\n      <div class="button-holder">\n<% if (suffix == \'-modal\') { %>\n        <a class="button-link cancel js-cancel"><span class="gray-button">Cancel</span></a>\n<% } %>\n        <button class="green-button js-submit" type="submit" <% if (loading) { %>disabled<% } %>><span>Log In</span></button>\n      </div>\n    </div>\n    <div class="button-holder-msg"></div>\n  </form>\n  <div class=\'account-switch\'>\n    <a class=\'js-create-account account-creation slide-down\'>Need to <span class=\'create-inner\'>create an account</span>?</a>\n  </div>\n  <iframe name=\'hidden-login-iframe\' id=\'hidden-login-iframe\' style=\'display: none\'></iframe>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_relogin.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="generic-popup content">\n  <h1>Confirm Password</h1>\n  <h2 class="subtitle warning">For security reasons, please enter your current password.</h2>\n  <form id="account-login-form" method="post" action="<%= base_url_secure %>/user/confirm-password" data-input-prefix="account-login-">\n    <p class="input-holder">\n      <label id="account-login-password-label" class="account-infield" for="account-login-password<%= suffix %>">Password</label>\n      <input name="password" type="password" value="" id="account-login-password<%= suffix %>" class="account-input">\n    </p>\n    <div class="two-factor"></div>\n    <div class="input-holder">\n      <div id="account-captcha"></div>\n    </div>\n    <div class="no-center">\n      <div class="button-holder">\n        <a class="button-link cancel js-cancel" href="#"><span class="gray-button">Cancel</span></a>\n        <button class="green-button submit js-submit" type="submit" <% if (loading) { %>disabled<% } %>><span>Confirm</span></button>\n      </div>\n    </div>\n    <div class="button-holder-msg"></div>\n  </form>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_signup.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="generic-popup content">\n  <h1 class="js-loading-header">Create Account</h1>\n  <h2 class="subtitle">Create an account to organize your bundles.</h2>\n  <form action="<%= base_url_secure %>/signup" data-input-prefix="account-signup-" method="POST">\n    <p class="input-holder">\n      <label class="account-infield" for="account-signup-email<%= suffix %>">Email</label>\n      <input name="email" type="email" id="account-signup-email<%= suffix %>" class="account-input js-focus">\n    </p>\n    <p class="input-holder">\n      <label class="account-infield" for="account-signup-password<%= suffix %>" id="account-signup-password-label">Password</label>\n      <input name="password" type="password" value="" id="account-signup-password<%= suffix %>" class="account-input">\n    </p>\n    <p class="disclaimer">\n      By clicking &quot;Sign Up&quot; and creating a humblebundle.com account, I acknowledge that I am 13 years of age or older and that I understand and agree to this website&#39;s <a href=\'/terms\' target=\'_blank\'>Terms and Conditions</a> and <a href=\'/privacy\' target=\'_blank\'>Privacy Policy</a>.\n    </p>\n    <p class="input-holder">\n    <input id="account-signup-subscribe" name="subscribe" type="checkbox" value="true" <% if (subscribe) { %>checked<% } %>>\n    <label for="account-signup-subscribe">Notify me about Humble Bundle promotions.</label>\n    </p>\n\n    <div class="input-holder">\n      <div id="account-captcha"></div>\n    </div>\n\n    <div class="no-center">\n      <div class="button-holder">\n        <a class="button-link cancel js-cancel"><span class="gray-button">Cancel</span></a>\n        <button class="green-button submit js-submit" type="submit" <% if (loading) { %>disabled<% } %>><span>Sign Up</span></button>\n      </div>\n      <div class="clearfix"></div>\n    </div>\n    <div class="button-holder-msg"></div>\n  </form>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_pw_reset.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="generic-popup content">\n  <h1 class="js-loading-header">Password Reset</h1>\n  <form action="<%= base_url_secure %>/user/forgot" data-input-prefix="account-pw-reset-">\n    <p class="input-holder">\n      <label class="account-infield" for="account-pw-reset-email<%= suffix %>">Email</label>\n      <input name="email" type="text" id="account-pw-reset-email<%= suffix %>" class="account-input js-focus">\n    </p>\n\n    <div class="input-holder">\n      <div id="account-captcha"></div>\n    </div>\n\n    <div class="no-center">\n      <div class="button-holder">\n        <a class="button-link cancel js-cancel" href="#"><span class="gray-button">Cancel</span></a>\n        <button class="green-button submit js-submit" type="submit" <% if (loading) { %>disabled<% } %>><span>Submit</span></button>\n      </div>\n      <div class="clearfix"></div>\n    </div>\n    <div class="button-holder-msg"></div>\n  </form>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_humble_guard.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="generic-popup content">\n  <h1 class="js-loading-header"><i class="hb hb-lock"></i>Verify This Browser</h1>\n  <h2 class="subtitle warning">It looks like you are accessing your Humble Bundle account from an unfamiliar browser.\n    For your protection, we need to verify that this computer is yours. We\'ve sent you an email\n  to the address attached to this account. <br /><br />\n  Enter the code from the email to proceed:</h2>\n  <form id="account-humble-guard-form" method="post" action="<%= base_url_secure %>/user/humbleguard" data-input-prefix="account-humble-guard-">\n    <p class="input-holder">\n      <label id="account-humble-guard-code-label" class="account-infield" for="account-humble-guard-code<%= suffix %>"></label>\n      <input name="code" type="text" value="" id="account-humble-guard-code<%= suffix %>" class="account-input always-caps">\n\n    </p>\n    <p class="resend-email">No code? <a class="js-resend" href="#">Resend email</a></p>\n    <div class="input-holder">\n      <div id="account-captcha"></div>\n    </div>\n    <div class="split-left">\n      \n      <a href="https://support.humblebundle.com/hc/en-us/articles/202434394-Humble-Account-Browser-Verification" target="_blank"><i class="hb hb-question-circle"></i></a>\n      <a href="https://support.humblebundle.com/hc/en-us/articles/202434394-Humble-Account-Browser-Verification" target="_blank">Need help?</a>\n    </div><div class="split-right">\n      <div class="no-center">\n        <div class="button-holder">\n          <a class="button-link cancel js-cancel" href="#"><span class="gray-button">Cancel</span></a>\n          <button class="green-button js-submit" type="submit" <% if (loading) { %>disabled<% } %>><span>Verify</span></button>\n        </div>\n      </div>\n    </div>\n    <div class="button-holder-msg"></div>\n  </form>\n</div>\n'.replace(/xSTATIC_URLx/g,t);
}()}),define("lib/hbTemplate!account/templates/account_authy.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="generic-popup content">\n  <h1>Confirm Two-Step Verification</h1>\n  <form id="account-login-form" method="post" action="<%= base_url_secure %>/user/confirm-authy" data-input-prefix="account-login-">\n    <div class="two-factor"></div>\n    <div class="input-holder">\n      <div id="account-captcha"></div>\n    </div>\n    <div class="no-center">\n      <div class="button-holder">\n        <a class="button-link cancel js-cancel" href="#"><span class="gray-button">Cancel</span></a>\n        <button class="green-button submit js-submit" type="submit"><span>Confirm</span></button>\n      </div>\n    </div>\n    <div class="button-holder-msg"></div>\n  </form>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_google.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="generic-popup content">\n  <h1>Confirm Two-Step Verification</h1>\n  <p>Scan the QR code</p>\n  <div class="js-qrcode qrcode"></div>\n  <p>or input this code into your authenticator app: <%- display_secret %></p>\n  <form id="google-auth-form" method="post" action="/user/confirm-google" data-input-prefix="google-auth-">\n    <input type="hidden" value="<%- secret %>" name="secret" />\n    <input type="hidden" value="<%- secret_tag %>" name="secret_tag">\n    <div class="input-holder">\n    <label>\n      Enter the six digit code displayed by your app:<input type="text" name="token" id="google-auth-token<%- suffix %>">\n    </label>\n    </div>\n    <div class="no-center">\n      <div class="button-holder">\n        <a class="button-link cancel js-cancel" href="#"><span class="gray-button">Cancel</span></a>\n        <button class="green-button submit js-submit" type="submit" <% if (loading) { %>disabled<% } %>><span>Confirm</span></button>\n      </div>\n    </div>\n  </form>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_steam_link_free_product.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="generic-popup content">\n  <h1>Steam Link Required</h1>\n  <p class="message-holder">\n    Before you can redeem your free copy of <%- product_human_name %>, you must link your Steam account to your Humble Bundle account.\n  </p>\n  <div class="no-center">\n    <div class="button-holder">\n      <a class="button-link cancel js-cancel" href="#"><span class="gray-button">Cancel</span></a>\n      <a class="button-link" href="/steam/openid/link?redirect=<%= product_redirect %>"><span class="green-button">Link Steam Account</span></a>\n    </div>\n  </div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/gift_claim_modal_message.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<p>Are you sure you want to claim <strong><%- gift_claim_item %></strong> to the following account:</p>\n<p><strong><%- account_email %></strong></p>\n<span class="warning-text">This action cannot be reversed!<br> Please double check the account before claiming.</span>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!account/templates/account_two_factor.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<label id="two-factor-token-label" class="account-infield in-field" for="authy-input">Two Factor token</label>\n<input name="authy-token" type="text" value="" id="authy-input" class="account-input inline-input">\n<input name="submit-data" type="hidden" value="">&nbsp;\n<a class="button-link submit gray-button" href="https://support.humblebundle.com/hc/en-us/articles/202421374" target=_blank id="get-instructions">Instructions</a>\n<br>\n<div id="two-factor-error-holder" class="two-factor-error-holder"></div>\n<% if (twofactor_type != \'google\') { %>\n<a class="small-link js-send-sms" href="" id="send-sms">Send SMS<% if (sent) { %> again<% } %></a>\n<% } %>\n<div id="two-factor-captcha-holder"></div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("account/templates/all",["util/templating","hbtemplate!./loading_spinner.html","hbtemplate!./account_message.html","hbtemplate!./account_confirmation.html","hbtemplate!./account_login.html","hbtemplate!./account_relogin.html","hbtemplate!./account_signup.html","hbtemplate!./account_pw_reset.html","hbtemplate!./account_humble_guard.html","hbtemplate!./account_authy.html","hbtemplate!./account_google.html","hbtemplate!./account_steam_link_free_product.html","hbtemplate!./gift_claim_modal_message.html","hbtemplate!./account_two_factor.html"],function(e,t,n,i,s,a,o,r,l,c,u,d,h,m){function p(t){return function(n){return e.renderTemplate(t,n)}}return{loading_spinner:p(t),account_message:p(n),account_confirmation:p(i),account_login:p(s),account_relogin:p(a),account_signup:p(o),account_pw_reset:p(r),account_humble_guard:p(l),account_authy:p(c),account_google:p(u),account_steam_link_free_product:p(d),gift_claim_modal_message:p(h),account_two_factor:p(m)}}),define("util/validators",[],function(){"use strict";function e(e){if(!e&&isNaN(e)||""===e)return"Required field"}return{requiredField:e}}),define("account/accountModals",["lib/jquery/full","lib/lodash","backbone","lib/backbone.modal","lib/email-validation","constants/skipCodes","common/DOMLessView","account/Modal","account/templates/all","util/main","util/csrfUtils","util/validators","hbtemplate!./templates/loading_spinner.html"],function(e,t,n,i,s,a,o,r,l,c,u,d,h){"use strict";var m=function(t,i,s){var a=new n.Model({title:t,message:i,gotoHref:s||""}),o=new _({model:a});e("#site-modal").html(o.render().el)},p=function(t,i,s,a,o,r,l){var u=new n.Model({title:t,message:i,confirmText:s,cancelText:a,gotoHref:l||""}),d=new y({model:u});d.onDestroy=null,"function"==typeof o?d.submit=o:d.submit=function(){var e=u.get("gotoHref");e&&c.redirectInDomain(e)},"function"==typeof r&&(d.cancel=r),e("#site-modal").html(d.render().el)},f=function(n){n=n||{},e(function(){e(document).on("click",".account-login",function(i){i.preventDefault();var s=e(this).attr("href"),a=t.extend({},n);s&&(a.gotoHref=s),r({name:"login",attributes:a})}),e(".generic-popup").delegate(".error-holder .error-item","click",function(t){t.preventDefault(),e(e(this).attr("href")).focus()})})},b=n.Modal.extend({prefix:"generic-bbm",suffix:"-modal",submitEl:".js-submit",cancelEl:".js-cancel",initialize:function(e){this.options=t.cloneDeep(e)||{},this.options.attributes?t.extend(this.options.attributes,{suffix:this.suffix}):t.extend(this.options,{attributes:{suffix:this.suffix}})},onDestroy:function(){var e=this.$(".js-cancel").data("goto");e&&c.redirectInDomain(e)},serializeData:function(){var e=t.extend({},this.options&&this.options.attributes);return t.extend(e,n.Modal.prototype.serializeData.call(this))}}),v=o.extend({className:"inline-view",template:h,initialize:function(){this.listenTo(this.model,"change:loading",this.render)}}),g=b.extend({events:{input:"updateModel","change input:checkbox":"updateCheckbox"},handleAjax:!0,initialize:function(e){b.prototype.initialize.call(this,e),e=e||{},this.setupModel(e.attributes),this.listenTo(this.model,"change:messages",this.updateFormMessages),this.listenTo(this.model,"change:loading",this.toggleSubmitButton.bind(this))},setupModel:function(e){if(this.model||(this.model=new n.Model(e||{})),this.model.set(u.formKey,u.getCsrf()),this.model.set("loading",!1),this.options.gotoHref&&"#"!=this.options.gotoHref)this.model.set({goto:this.options.gotoHref,qs:this.options.queryString});else{this.model.get("goto")!=window.location.pathname&&this.model.set("goto",window.location.pathname);var t=window.location.search;t&&(t=t.substr(1),this.model.set("qs",t))}},toggleSubmitButton:function(){this.$(".js-submit").prop("disabled",this.model.get("loading"))},updateModel:function(t){var n=e(t.target);this.model.set(n.attr("name"),n.val())},updateCheckbox:function(t){var n=e(t.target);this.model.set(n.attr("name"),n.is(":checked"))},setModelSkipCode:function(e){e=e||this.model.get("extra_skip_codes"),e&&e.length&&(this.model.set("captcha-skip-code",e.pop()),this.model.set("extra_skip_codes",e),setTimeout(function(){this.model.unset("captcha-skip-code"),this.model.unest("extra_skip_codes")},1e3*(a.SKIP_CODE_SECONDS-60)))},updateFormMessages:function(){this._hide_validation_errors();var e=this.model.get("messages");e.success&&delete e.success,this.generateErrorList(e)},onRender:function(){t.extend(this,{$toSlideDown:this.$(".slide-down"),$form:this.$("form")}),this.options.required&&this.$(this.cancelEl).hide(),this.$toSlideDown.css("display","none")},showTwoFactorClickHandler:function(e){e&&e.preventDefault(),this.showTwoFactor()},showTwoFactor:function(e){this.twoFactorView||(this.twoFactorView=new j({model:this.model,validators:this.twoFactorValidators,twofactor_type:e})),this.$(".two-factor").html(this.twoFactorView.render().$el),c.applyInfieldLabels(this.$(".account-infield"))},beforeCancel:function(){return!this.options.required},onShow:function(){this.$(".js-loading-header").prepend(new v({model:this.model}).render().$el);var t=/(iPod|iPhone|iPad)/.test(navigator.userAgent);t&&this.$("input").focus(function(t){e(t.target).closest(".generic-bbm-wrapper").css("max-height",document.documentElement.clientHeight)}),c.applyInfieldLabels(this.$(".account-infield")),this.$toSlideDown.slideDown("fast"),this.$(".js-focus").focus(),window.pause_timers&&window.pause_timers()},onDestroy:function(){window.resume_timers&&window.resume_timers(),b.prototype.onDestroy.apply(this,arguments)},beforeSubmit:function(){return this.model.set("loading",!0),!this.captchaRequired||(this.executeCaptcha(),!1)},submit:function(t){var n=this,i=this.$("form"),s=i.attr("action");this.captcha&&this.model.set(this.captcha.getResponseParameters(t,!0)),n._hide_validation_errors(),e.ajax({type:"POST",url:s,data:this.model.attributes,dataType:"json",statusCode:{400:function(t,s,a){var o=e.parseJSON(t.responseText);if(o.captcha_required&&(n.captchaRequired=!0),i.closest(".generic-popup").length)n._show_validation_errors(o.errors);else if(o.errors){var r="";for(var l in o.errors)r=o.errors[l][0];if(!r)return;o.two_factor_required&&(n.setModelSkipCode(o.skip_code),n.showTwoFactor(o.twofactor_type)),n._show_response_message("Error",r,o.goto),n.destroy()}},401:function(t,i,s){var a=e.parseJSON(t.responseText);a.captcha_required&&(n.captchaRequired=!0),a.two_factor_required&&(n.setModelSkipCode(a.skip_code),n.showTwoFactor(a.twofactor_type)),n._show_validation_errors(a.errors)},403:function(t,i,s){var a,o="An error occurred. Please try again later.";if(t.responseText){var r=e.parseJSON(t.responseText);a=r.goto;for(var l in r.errors)o=r.errors[l][0];r.two_factor_required&&(n.setModelSkipCode(r.skip_code),n.showTwoFactor(r.twofactor_type))}n._show_response_message("Error",o,a),n.destroy()}},error:function(e,t,i){n.model.set("loading",!1)},success:function(e,t,i){if(n.onSubmitSuccess)return n.onSubmitSuccess(e,t,i),void n.model.set("loading",!1);if(e.message)n._hide_validation_errors(),n._show_response_message(e.message.title,e.message.body,e.goto),n.model.set("loading",!1),n.destroy();else if(e.force_refresh)window.location.reload();else{var s=window.location.pathname+window.location.search;c.redirectInDomain(e.goto),e.goto.split("#")[0]!==s&&0!==e.goto.indexOf("#")||window.location.reload()}}}),this.model.unset("captcha-skip-code")},executeCaptcha:function(){return this.model.get("captcha-skip-code")?void this.submit():(this.captcha?this.captcha.reset():this.captcha=CreateCaptcha("account-captcha",this.submit.bind(this),{size:"invisible"}),void this.captcha.execute())},_resend_humble_guard_code:function(t){t.preventDefault();var n=e(".resend-email"),i={};i[u.headerKey]=u.getCsrf(),n.html("Resending...."),e.ajax({type:"POST",url:"/user/humbleguard?resend=1",headers:i}).success(function(){n.html("Email resent")}).error(function(){n.html("Too many emails sent. Please wait 24 hours and then try again")})},_show_validation_errors:function(e){this.generateErrorList(e)},_hide_validation_errors:function(){e(".arrow-error, .button-holder-msg").hide()},_show_response_message:function(e,t,n){m(e,t,n)},getFieldId:function(e,t){return"authy-input"==t?"#"+t:"captcha"==t?".button-holder":"#"+(e.data("inputPrefix")||e.attr("id")||"id_")+t+this.suffix},setFormMessage:function(t,n,i){var s=this.getFieldId(t,n),a=s+"-msg",o=e(s),r=e(a);r.length>0?r.html(i+'<div class="arrow-error-right"></div>'):(o.closest(".input-holder").append('<div class="arrow-holder"><div class="arrow-error" id="'+a.slice(1)+'">'+i+'<div class="arrow-error-right"></div></div></div>'),r=e("#"+a.slice(1)));var l=o.position().top;return r.css({top:l+"px"}),r.fadeIn(),r},setFormMessages:function(e){this.$(".arrow-error").fadeOut("fast");var t=this.$("form");for(var n in e)this.setFormMessage(t,n,e[n][0])},generateErrorList:function(e){return e?void this.setFormMessages(e):null}}),_=b.extend({template:l.account_message}),y=b.extend({template:l.account_confirmation}),w=g.extend({template:l.account_login,captchaRequired:!0,events:t.extend({},g.prototype.events,{"click .js-show-2fa":"showTwoFactorClickHandler","click .js-forgot-pw":"forgotPassword","click .js-create-account":"createAccount"}),initialize:function(e){g.prototype.initialize.call(this,e),this.twoFactorValidators=[{field:"username",validation:d.requiredField},{field:"password",validation:d.requiredField}]},forgotPassword:function(e){e.preventDefault(),r({name:"reset",attributes:this.options}),"-pane"!=this.suffix&&this.destroy()},createAccount:function(e){e.preventDefault();var n=t.extend({},this.options);this.model.get("goto")&&(n.gotoHref=this.model.get("goto")),this.model.get("qs")&&(n.queryString=this.model.get("qs")),r({name:"signup",attributes:n}),"-pane"!=this.suffix&&this.destroy()}}),k=g.extend({template:l.account_signup,captchaRequired:!0,initialize:function(e){g.prototype.initialize.call(this,e);var t=!(window.models&&"CA"===window.models.request.country_code||this.options.attributes.is_eu_country);this.model.set("subscribe",t)},onShow:function(){var n="#account-signup-email"+this.suffix;s.bindEmailField(e(n),t.bind(function(t,i){var s=t.closest("form"),a=t.attr("name");return i?this.setFormMessage(s,a,i):(e(n+"-msg").fadeOut("fast"),e(n+"-msg"))},this)),g.prototype.onShow.call(this)}}),C=g.extend({template:l.account_pw_reset,captchaRequired:!0}),T=g.extend({template:l.account_humble_guard,events:{input:"updateModel","click .js-resend":"_resend_humble_guard_code"},onShow:function(){this.$("input").focus()},onSubmitSuccess:function(e){this.options.onSuccess?this.options.onSuccess(this):c.redirectInDomain(e.goto)},onDestroy:function(){return this.options.onDestroy&&this.options.onDestroy(this),!1}}),S=b.extend({template:l.account_steam_link_free_product}),j=n.View.extend({className:"input-holder",events:{"click .js-send-sms":"onSendSmsClick"},tagName:"p",template:l.account_two_factor,initialize:function(e){this.validators=e.validators||[],this.sent=!1,this.twofactor_type=e.twofactor_type},render:function(){return this.$el.html(this.template({sent:this.sent,twofactor_type:this.twofactor_type})),c.applyInfieldLabels(this.$(".account-infield")),this},executeCaptcha:function(){return this.model.get("captcha-skip-code")?void this.sendSms():(this.captcha?this.captcha.reset():this.captcha=CreateCaptcha("two-factor-captcha-holder",this.sendSms.bind(this),{size:"invisible"}),void this.captcha.execute())},validate:function(){this.model.unset("messages");var e={};return this.validators.forEach(function(t){var n=t.validation(this.model.get(t.field));n&&(e[t.field]||(e[t.field]=[]),e[t.field].push(n))}.bind(this)),!Object.keys(e).length||(this.model.set("messages",e),!1)},setModelSkipCode:function(e){e=e||this.model.get("extra_skip_codes"),e&&e.length&&(this.model.set("captcha-skip-code",e.pop()),this.model.set("extra_skip_codes",e),setTimeout(function(){this.model.unset("captcha-skip-code"),this.model.unest("extra_skip_codes")},1e3*(a.SKIP_CODE_SECONDS-60)))},onSendSmsClick:function(e){this.model.set("loading",!0),e.preventDefault(),this.validate()&&this.executeCaptcha()},sendSms:function(t){this.captcha&&this.model.set(this.captcha.getResponseParameters(t,!0)),e.ajax({type:"POST",url:"/user/authy/send-sms",data:this.model.attributes,dataType:"json",success:function(e){this.sent||(this.sent=!0,this.render());var t={success:!0,"authy-input":["SMS sent! Please enter your code."]};this.model.set("loading",!1),this.model.set("messages",t),this.setModelSkipCode(e.skip_code)}.bind(this),error:function(t,n,i){var s={"authy-input":["Oops! Something went wrong. Please refresh the page and try again."]};try{var a=e.parseJSON(t.responseText);a.errors&&(s=a.errors)}catch(e){console.error(e.message)}this.model.set("messages",s),this.model.set("loading",!1)}.bind(this)}),this.model.unset("captcha-skip-code")}}),x=n.View.extend({events:{submit:"submit",input:"updateModel"},initialize:function(e){e.modelData[u.formKey]=u.getCsrf(),this.model=new n.Model(e.modelData),e.$twoFactorWrapper&&(this.twoFactorView=new j({model:this.model}),this.$twoFactorWrapper=e.$twoFactorWrapper,this.$twoFactorWrapper.html(this.twoFactorView.render().$el)),this.listenTo(this.model,"change:messages",this.updateFormMessages)},updateFormMessages:function(){var e=this.model.get("messages"),n=this.twoFactorView.$("#two-factor-error-holder"),i="";e["authy-input"]&&!t.isEmpty(e["authy-input"])&&(i=e["authy-input"][0]),e.success?n.addClass("two-factor-success"):n.removeClass("two-factor-success"),n.text(i)},updateModel:function(t){var n=e(t.target);this.model.set(n.attr("name"),n.val())},submit:function(t){t.preventDefault(),e.ajax({type:"POST",url:"/user/verify",data:this.model.attributes,dataType:"json",error:function(t,n,i){var s=e.parseJSON(t.responseText),a="";if(s.errors){for(var o in s.errors)a=s.errors[o][0];a&&m("Error",a,s.goto)}},success:function(e,t,n){e.message&&(m(e.message.title,e.message.body,e.goto),this.remove())}.bind(this)})}}),O={"#account-message":_,"#account-login":w,"#account-pw-reset":C,"#account-signup":k,"#account-humble-guard":T};return{bindAccountModalHandling:f,displayDialog:m,displayConfirmation:p,modals:O,BaseModal:b,BaseAccountModal:g,AccountMessageModal:_,AccountLoginModal:w,AccountSignUpModal:k,AccountPasswordResetModal:C,AccountHumbleGuardModal:T,AccountSteamLinkFreeProductModal:S,TwoFactorView:j,PasswordResetView:x,openAccountModal:r}}),define("lib/hbTemplate!bundleWarnings/templates/orderform_warning.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="grey-warning-box order-form-warning">\n  <%= warning %>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!bundleWarnings/templates/page_top_warning.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="orange-warning-box bundle-warn-top">\n  <%= warning %>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!bundleWarnings/templates/payment_warning.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="payment-blocker">\n  <div class="bundle-warn-payment">\n    <%= warning %>\n    <button class="bundle-warn-dismiss js-payment-warning"><%= buttonText %></button>\n  </div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("bundleWarnings/main",["lib/jquery/full","backbone","common/DOMLessView","hbtemplate!./templates/orderform_warning.html","hbtemplate!./templates/page_top_warning.html","hbtemplate!./templates/payment_warning.html"],function(e,t,n,i,s,a){"use strict";var o=function(e){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,e),_createClass(n,[{key:"initialize",value:function(e){var n=e.warning;this.model=new t.Model({warning:n})}}]),n}(n);o.prototype.template=i;var r=function(e){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,e),_createClass(n,[{key:"initialize",value:function(e){var n=e.warning,i=e.buttonText;this.model=new t.Model({warning:n,buttonText:i})}},{key:"dismissPaymentWarning",value:function(){this.$el.fadeOut(400)}}]),n}(n);r.prototype.events={"click .js-payment-warning":"dismissPaymentWarning"},r.prototype.template=a;var l=function(e){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,e),_createClass(n,[{key:"initialize",value:function(e){var n=e.warning;this.model=new t.Model({warning:n})}}]),n}(n);return l.prototype.template=s,{OrderFormWarningView:o,PaymentWarningView:r,PageTopWarningView:l}}),define("lib/hbTemplate!orderform/templates/order_form_template.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<form id="order-form" class="order-form u-constrain-width" autocomplete="off">\n<% if (product.get(\'disclaimer_text\') && !isOrderAdder) { %>\n  <div class="order-form-disclaimer-text">\n    <%= product.get(\'disclaimer_text\') %>\n  </div>\n<% } %>\n\n  <div class="order-form-header">\n    <p><i class="hb hb-lock"></i>\n      <% if (isOrderAdder) { %>\n        Add to your\n        <strong><%- product.get(\'human_name\') %></strong>\n        order\n      <% } else { %>\n        Purchase\n        <strong><%- product.get(\'product_title\') %></strong>\n      <% } %>\n    </p>\n    <div class="previous-purchases"></div>\n    <div class="order-form-warnings"></div>\n  </div>\n\n  <div class="order-form-amount-selection-step">\n    <div class="order-form-adder-amount-radios"></div>\n    <div class="order-form-radio-amount-selector"></div>\n\n<% if (isOrderAdder) { %>\n    <p class="order-form-adder-text">\n      New Total: $<%- personalTotal.toFixed(2) %> + <span class="new-order-amount"></span> = <strong><span class="new-total"></span></strong>\n    </p>\n<% } %>\n\n\n    <div class="order-form-image-fan-container u-order-form-redesign"></div>\n\n    <div class="order-form-amount-error-container">\n      <div class="js-order-form-amount-error-container"></div>\n      <div class="js-order-form-subscription-error-container"></div>\n    </div>\n\n    <div class="order-form-leaderboard-step"></div>\n  </div>\n\n<div id="order-form-split-step" class="order-form-split-step"></div>\n\n<% if (!isOrderAdder) { %>\n    <div class="order-form-email-step">\n      <div class="order-form-email-container">\n    <% if (user.get(\'is_logged_in\')) { %>\n        <input\n          id="temail"\n          type="hidden"\n          name="email"\n          value="<%- user.get(\'email\') %>"\n        />\n        You\'re getting this bundle for <strong><%- user.get(\'email\') %></strong>.\n        Not you?\n        <a class="order-form-account-logout-button color-neutral-link" href="" onclick="document.getElementById(\'navbar-logout-form\').submit(); return false;">Log out</a>\n    <% } else { %>\n        <input\n          id="temail"\n          class="order-form-email-input"\n          type="text"\n          name="email"\n          placeholder="Enter your email address here"\n          autocomplete="on"\n        />\n        <div style="display:inline-block;">\n          <a href="" class="order-form-account-login-button js-account-login">\n            <i class="hb hb-user"></i> Log in (optional)\n          </a>\n        </div>\n        <div class="order-form-email-error-container"></div>\n      <% if (!user.get(\'is_logged_in\')) { %>\n        <div class="order-form-subscribe-checkbox">\n            <input id="subscribe_checkbox" type="checkbox" name="subscribe" class="js-order-form-newsletter-signup-checkbox order-form-newsletter-signup-checkbox" <% if (newsletterCheckboxInitialStatus) { %>checked<% } %>>\n            <label for="subscribe_checkbox" class="checkmark-box"><i class="hb hb-checkmark"></i></label>\n            <label for="subscribe_checkbox" class="order-form-newsletter-label">Notify me about upcoming promotions.</label>\n        </div>\n        <p class="order-form-newsletter-notice">By signing up, you agree to the\n          <a href="/terms" target="_blank">Terms of Service</a> and <a href="/privacy" target="_blank">Privacy Policy</a>.\n          You may unsubscribe from the newsletter at any time.</p>\n      <% } %>\n    <% } %>\n      </div>\n      <div class="order-form-gift-container">\n      </div>\n    </div>\n<% } %>\n\n<% if (streamlabsEnabled) { %>\n  <div class="order-form-streamlabs-step">\n    <input id="twitch_handle" type="text" name="twitch_handle" class="order-form-streamlabs-input">\n    <label for="twitch_handle"> Twitch Username (optional - for use with Streamlabs alerts on Twitch)</label>\n    <div class="order-form-thankname-error-container"></div>\n  </div>\n\n<% } %>\n\n  <div class="order-form-payment-step"></div>\n  <div class="order-form-recaptcha-step">\n    <div id="order-form-recaptcha"></div>\n  </div>\n</form>\n\n<% if (!isOrderAdder) { %>\n\n<div class="u-constrain-width">\n  <input type="checkbox" class="order-form-text-expand" id="disclaimer-expand" />\n  <p class="order-form-payments-message">\n    All major credit cards accepted. <%= additionalDisclaimerText %>Payment processing fees will be deducted proportionally from the payment amounts you indicate on your slider(s). Fees typically average 5 to 6% across all transactions, but may vary depending on a number of factors, including your location, purchase price, and payment method. We deduct consumption taxes, where applicable, in the same manner.\n\n    <% if (product.get(\'giving_fund\') == \'ppgf\') { %>\n      Payments to charitable organizations are made via the PayPal Giving Fund. For details on how this works, click <a href="https://support.humblebundle.com/hc/en-us/articles/205183597" class="color-neutral-link" target="_blank">here</a>.\n    <% } else if (product.get(\'giving_fund\') === \'ppgf-tides\') { %>\n      Payments to certain U.S. and UK registered charitable organizations are made via PayPal Giving Fund, as further explained <a href="https://support.humblebundle.com/hc/en-us/articles/205183597" class="color-neutral-link" target="_blank">here</a>. Payments to other charitable beneficiaries are made via the Tides Foundation, as further detailed <a href="https://support.humblebundle.com/hc/en-us/articles/205501708" class="color-neutral-link" target="_blank">here</a>.\n    <% } else if (product.get(\'giving_fund\') === \'ppgf-direct\') { %>\n      Payments to certain U.S. and UK registered charitable organizations are made via PayPal Giving Fund, as further explained <a href="https://support.humblebundle.com/hc/en-us/articles/205183597" class="color-neutral-link" target="_blank">here</a>. Payments to other charitable beneficiaries are made directly to the charitable organization.\n    <% } else if (product.get(\'giving_fund\') === \'tides\') { %>\n      Payments to charitable organizations are made via the Tides Foundation and subject to Tides\' standard administrative fees of up to 3% of the funds plus certain fixed fees, as further detailed <a href="https://support.humblebundle.com/hc/en-us/articles/205501708" class="color-neutral-link" target="_blank">here</a>.\n    <% } %>\n    <% if (product.get(\'split_disclaimer\')) { %>\n    <span class="js-order-admin-edit" data-entity-kind="product" data-machine-name="<%- product.get(\'machine_name\') %>" data-anchor-name="#row_strings" data-link-position="append"><%- product.get(\'split_disclaimer\') %></span>\n    <% } %>\n  </p>\n  <div class="order-form-text-expand-wrapper"><label for="disclaimer-expand" class="order-form-text-expand-trigger"></label></div>\n</div>\n<% } %>\n\n<div id=\'AmazonPayButtonHolder\' style=\'display:none\'></div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!orderform/templates/eula_modal.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="generic-bbm-wrapper" style="display: block;">\n  <div class="generic-bbm-modal generic-bbm-modal--open eula-modal" style="opacity: 1;">\n    <div class="generic-popup content">\n      <h1 class="noimg">End User License Agreement</h1>\n      <div class="height-constraint">\n        <div class="message-holder"><%= eula %></div>\n        <div class="no-center">\n          <div class="clearfix"></div>\n        </div>\n      </div>\n      <div class="button-holder">\n        <a class="button-link cancel js-cancel" href="#"><span class="gray-button">Cancel</span></a>\n        <a class="button-link confirm js-confirm" href="#"><span class="green-button">Accept</span></a>\n      </div>\n    </div>\n  </div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!adminLinks/templates/quick_links.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<ul class="admin-quicklinks js-admin-quicklinks">\n  <i class=\'hb hb-bundle\'></i>\n  <% if (editProductURL) { %>\n    <li class="menu-item">\n      <a class="quicklink" target="_blank" href="<%- editProductURL %>">View Product Admin</a>\n    </li>\n  <% } %>\n  <% if (editDisplayItemURL) { %>\n  <li class="menu-item">\n    <a class="quicklink" target="_blank" href="<%- editDisplayItemURL %>">View DisplayItem Admin</a>\n  </li>\n  <% } %>\n  <% if (editStorePageLayoutURL) { %>\n  <li class="menu-item">\n    <a class="quicklink" target="_blank" href="<%- editStorePageLayoutURL %>">View StorePageLayout Admin</a>\n  </li>\n  <% } %>\n  <li class="menu-item">\n    <label><input type="checkbox" checked class="js-toggle-tiny-links">Show Edit Links</label>\n  </li>\n</ul>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!adminLinks/templates/tiny_link.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<a href="<%- url %>" target="_blank" class="admin-tiny-link js-admin-tiny-link <% if (!enabled) { %> disabled<% } %>" title="<%- title %>">\n  <i class="hb hb-pencil-square"></i>\n</a>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("adminLinks/main",["jquery","backbone","lib/lodash","hbtemplate!./templates/quick_links.html","hbtemplate!./templates/tiny_link.html"],function(e,t,n,i,s){"use strict";var a={product:"/admin/Product/edit/",display_item:"/admin/DisplayItem/edit/",coupon:"/admin/CouponDefinition/edit/",subproduct:"/admin/SubProduct/edit/",tpkd:"/admin/ThirdPartyKeyDefinition/edit/",banner:"/admin/Banner/edit/",partner:"/admin/Partner/edit/",store_page_layout:"/admin/StorePageLayout/edit/"},o={quickLinks:n.template(i),tinyLink:n.template(s)},r=function(t){var i=e(".js-admin-quicklinks"),s=n.extend({editProductURL:"",editDisplayItemURL:"",editStorePageLayoutURL:""},t);i.length&&i.remove(),t.productMachineName&&(s.editProductURL=a.product+t.productMachineName),t.displayItemMachineName&&(s.editDisplayItemURL=a.display_item+t.displayItemMachineName),
t.storePageLayoutMachineName&&(s.editStorePageLayoutURL=a.store_page_layout+t.storePageLayoutMachineName),e("body").prepend(o.quickLinks(s))},l=function(t,i){var s=!i,r=e(".js-toggle-tiny-links").is(":checked");if(i=i||e(".js-admin-edit"),n.each(i,function(n){var i=e(n);if(!i.find(".js-admin-tiny-link").length){var s=i.data("entity-kind"),l=i.data("anchor-name")||"",c=i.data("machine-name")||"",u=i.data("link-position")||"";if(void 0!==s){switch(s){case"product":c=c||t.productMachineName;break;case"display_item":c=c||t.displayItemMachineName;break;case"store_page_layout":c=c||t.storePageLayoutMachineName}if(c){var d=o.tinyLink({url:a[s]+c+l,title:"Edit "+s.charAt(0).toUpperCase()+s.slice(1)+" "+c,enabled:r});switch(u){case"after":i.after(d);break;case"append":i.append(d);break;case"prepend":i.prepend(d);break;case"before":default:i.before(d)}}}}}),!s){var l=e(".js-page-banner-link");if(l.length){var c=l.data("banner"),u=o.tinyLink({url:a.banner+c,title:"Edit Banner "+c,enabled:r});l.parent().find(".js-admin-tiny-link").remove(),l.before(u)}}e(".js-toggle-tiny-links").on("change",function(t){t.target.checked?e(".admin-tiny-link").removeClass("disabled"):e(".admin-tiny-link").addClass("disabled")})};return{renderMenu:r,renderTinyLinks:l}});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("orderform/OrderForm",["lib/jquery/full","lib/lodash","util/main","backbone","common/DOMLessView","constants/processorConstants","orderform/AmountButtons","orderform/AmountError","orderform/AmountModel","orderform/Leaderboard","orderform/Splits","orderform/CheckoutTiers","orderform/PreviousPurchases","orderform/PaymentOptionsView","orderform/Gift","orderform/SubscriptionWarningView","account/accountModals","account/Modal","bundleWarnings/main","lib/email-validation","hbtemplate!./templates/order_form_template.html","hbtemplate!./templates/error_message_template.html","hbtemplate!./templates/eula_modal.html","adminLinks/main"],function(e,t,n,i,s,a,o,r,l,c,u,d,h,m,p,f,b,v,g,_,y,w,k,C){"use strict";var T=function(s){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return _inherits(a,s),_createClass(a,[{key:"initialize",value:function(n){var i=this;this.options=n,this.product=n.product,this.humbleOrder=n.humbleOrder,this.request=n.request,this.user=n.user,this.charities=n.charities,this.softLockMessages=n.softLockMessages||{},this.isEUCountry=n.isEUCountry,this.allowedPaymentProcessors=n.allowedPaymentProcessors,this.defaultDollarPrice=this.product.get("default_dollar_price"),this.checkoutTiers=n.checkoutTiers||[],this.isOrderAdder=this.humbleOrder.isDefined(),this.isOrderAdder?(this.avgstring=this.humbleOrder.get("avg"),this.avg=parseFloat(this.avgstring),this.avguuid=this.humbleOrder.get("avguuid"),this.avghash=this.humbleOrder.get("avghash")):(this.avgstring=this.product.get("order_form_vars").avg,this.avg=parseFloat(this.avgstring),this.avguuid=this.product.get("order_form_vars").avguuid,this.avghash=this.product.get("order_form_vars").avghash),this.personalTotal=parseFloat(this.humbleOrder.get("cleanfamilytotal")),this.gamekeyToAddTo=this.humbleOrder.get("gamekey"),this.eula_accepted=!1,this.LOCALSTORAGE_KEY="hborderform",t.bindAll(this,"saveToLocalstorage","validateEmailField","submitOrderForm","hideEmailMessages","showEmailMessage","liveEmailCheckCallback","updateAmount"),this.ui={},this.pricingTiers=this.product.get("bundle_display_vars").pricing_tiers,this.upgradeTiers=[];var s=this.humbleOrder.get("forced_content_events"),a=this.product.get("tiers")||[];this.upgradeTiers=a.filter(function(e){var n=e.identifier,a=e.min_price;return a>i.personalTotal&&!t.includes(s,n)});var r=this.getDefaultAmountPennies(this.pricingTiers,100*this.defaultDollarPrice);this.upgradeTiers&&this.upgradeTiers.length&&(r=100*this.upgradeTiers[0][0]),this.model=new l({amount_pennies:r,subsplit:this.product.get("splits")});var c=this.getLocalStorageInfo();c&&c.modelTree&&(this.model.loadFromLocalStorage(c.modelTree),this.model.set("purchase_history",c.purchaseHistory)),this.model.on("change:amount_pennies",this.updateAmount),this.listenTo(this.model,"change:submit_form",this.submitOrderForm),e(window).bind("beforeunload",this.saveToLocalstorage),this.newsletterCheckboxInitialStatus=!("CA"==this.request.country_code||this.isEUCountry&&0==this.model.getCurrentDollarAmount()),this.countryCode=this.request.country_code,window.AmazonPaymentReady=function(){OffAmazonPayments.Button("AmazonPayButtonHolder","A2608GUH2GJY52",{type:"hostedPayment",hostedParametersProvider:function(e){e(i.amazonParams)},onError:function(e){}})},this.windowSize=new o.WindowSize}},{key:"onRender",value:function(){if(this.paymentOptionsView=new m.PaymentOptionsView({el:e(".order-form-payment-step"),hasFreeContent:this.product.get("has_free_content"),windowSize:this.windowSize,model:this.model,paymentCredentials:this.user.get("payment_credentials")}),this.paymentOptionsView.generateProcessorCollection(this.allowedPaymentProcessors,this.countryCode),this.paymentOptionsView.render(),this.giftView=new p({el:e(".order-form-gift-container")}),this.giftView.render(),!this.isOrderAdder){var t=this.getLocalStorageInfo();this.emailInput=this.$("#temail"),t&&!this.user.get("is_logged_in")&&this.emailInput.val(t.email)}_.bindEmailField(this.$("#temail"),this.liveEmailCheckCallback);var n=void 0;if(n=this.isOrderAdder?new o.AmountRadios({el:e(".order-form-adder-amount-radios"),model:this.model,templateVariables:{defaultDollarPrice:this.defaultDollarPrice,initialValue:this.model.getHumanAmount(),personalTotal:this.personalTotal,isOrderAdder:this.isOrderAdder,upgradeTiers:this.upgradeTiers,selections:this.selections}}):new o.RadioAmountSelector({el:e(".order-form-radio-amount-selector"),model:this.model,pricingTiers:this.pricingTiers,windowSize:this.windowSize}),n.render(),this.softLockMessages.order_form_warning&&new g.OrderFormWarningView({el:this.$(".order-form-header .order-form-warnings"),warning:this.softLockMessages.order_form_warning}).render(),this.softLockMessages.payment_warning){var i=new g.PaymentWarningView({warning:this.softLockMessages.payment_warning,buttonText:this.softLockMessages.payment_warning_button_text});this.$(".order-form-payment-step").append(i.render().el)}if(0===this.upgradeTiers.length){this.model.set({productMachineName:this.product.get("machine_name"),splitDisclaimer:this.product.get("split_disclaimer"),sliderReplacementText:this.product.get("slider_replacement_text")});var s=new u({givingFund:this.product.get("giving_fund"),charityConstants:this.options.charityConstants,user:this.user,charities:this.charities,el:this.$("#order-form-split-step"),model:this.model});s.render()}if(this.user.get("has_admin_access")&&C.renderTinyLinks({linkPlacement:"after"},this.$(".js-order-admin-edit")),this.checkoutTiers.length&&new d({el:this.$(".order-form-image-fan-container"),checkoutTiers:this.checkoutTiers,model:this.model}).render(),new c({el:this.$(".order-form-leaderboard-step"),model:this.model,minLeaderboard:this.product.get("order_form_vars").min_leaderboard}).render(),this.model.set("expand_subsplits",this.product.get("expand_default_split")),!this.isOrderAdder){var a=new h({model:this.model,el:this.$(".order-form-header .previous-purchases")});a.render()}new r({el:this.$(".js-order-form-amount-error-container"),model:this.model,product:this.product,personalTotal:this.personalTotal,avg:this.avg,isOrderAdder:this.isOrderAdder}).render(),this.updateAmount(),this.$(".order-form-account-logout-button").click(this.saveToLocalstorage),this.$(".order-form-account-login-button").click(this.saveToLocalstorage),this.validateSubscriptionStatus(),this.isEUCountry&&e(".js-order-form-newsletter-signup-checkbox").prop("checked",this.model.getCurrentDollarAmount()>0)}},{key:"serializeData",value:function(){return{newsletterCheckboxInitialStatus:this.newsletterCheckboxInitialStatus,user:this.user,product:this.product,order:this.humbleOrder,isOrderAdder:this.isOrderAdder,upgradeTiers:this.upgradeTiers,expandSubsplits:this.expandSubsplits,personalTotal:this.personalTotal,streamlabsEnabled:this.options.streamlabsEnabled,additionalDisclaimerText:this.constructAdditionalDisclaimerText()}}},{key:"saveToLocalstorage",value:function(){var e=n.getLocalStorage(),t={productMachineName:this.product.get("machine_name"),splitsHash:this.splitsHash,modelTree:this.model.serializeTree()};this.isOrderAdder||(t.email=this.emailInput.val());var i=JSON.stringify(t);e.setItem(this.LOCALSTORAGE_KEY,i)}},{key:"getLocalStorageInfo",value:function(){var e=n.getLocalStorage(),t=e.getItem(this.LOCALSTORAGE_KEY);if(t){var i=JSON.parse(t);if(i.productMachineName===this.product.get("machine_name")&&(this.splitsHash=j(this.product.get("splits")).toString(),i.splitsHash===this.splitsHash)){var s="purchase-history-"+this.productMachineName;return i.purchaseHistory=JSON.parse(e.getItem(s))||{},i}}}},{key:"getDefaultAmountPennies",value:function(e,t){var n=o.getRadioButtonAmounts(e),i=t;if(n.indexOf(t/100)==-1)for(var s=n.length-1;s>=0;s--){var a=Math.round(100*n[s]);if(a<t){i=a;break}}return i}},{key:"handleFreePurchaseWithAuthRequired",value:function(){var n=void 0,i={};if(!this.user.get("is_logged_in")){var s=t.extend({},window.modal_attributes);return s.free_copy=this.product.get("human_name"),new v({name:"login",attributes:s}),!1}if(this.user.get("has_steam_link")||(n=b.AccountSteamLinkFreeProductModal,i.product_human_name=this.product.get("human_name"),i.product_redirect=this.product.get("pretty_path")),n){var a=t.assignIn({},window.modal_attributes,i),o=new n({attributes:a});return e("#site-modal").html(o.render().$el),!1}return!0}},{key:"submitOrderForm",value:function(){this.validateForm()}},{key:"onValidation",value:function(t){var n=this;if(0===this.model.get("amount_pennies")&&this.product.get("auth_required_for_purchase_if_free")&&!this.handleFreePurchaseWithAuthRequired())return void this.model.set("in_progress",!1);if(this.product.get("eula")&&!this.eula_accepted)return this.showEula(),void this.model.set("in_progress",!1);var i=this.model.get("selected_processor"),s=i.processor,a=i.paymentType,o=this.buildOrder(s,a,t);if("stored_credential"==s&&!this.request.humble_guard_enabled)return v({name:"guard",attributes:window.modal_attributes}),void this.model.set("in_progress",!1);if(_gaTrackEvent(void 0,"Order form","Pay with "+s+" clicked"),this.model.set("in_progress",!0),"stripe"===s&&void 0===a){var r=StripeCheckout.configure({key:this.product.get("order_form_vars").stripe_pubkey,locale:"auto"});r.open({address:!0,validate:!0,amount:this.model.get("amount_pennies"),currency:"usd",email:this.emailInput&&this.emailInput.val(),name:"Humble Bundle",description:this.product.get("human_name"),panelLabel:"Checkout",allowPhoneVerification:!1,closed:function(){o.get("stripe_token")||n.model.set("in_progress",!1)},token:function(t){var i=t.id,s=t.card;o.set("stripe_token",i),s&&o.set("stripe_cc_data",e.param(s)),n.formSubmit(o)}})}else this.formSubmit(o)}},{key:"mapPaymentProcessors",value:function(e){var t={amazonhp:"Amazon Payments",coinbase:"Bitcoin",paypal:"PayPal"};return e.map(function(e){return t[e]}).filter(function(e){return void 0!==e})}},{key:"constructAdditionalDisclaimerText",value:function(){var e=this.product.get("disallowed_payment_processors")||[],i=[],s="";return t.includes(e,"paypal")||i.push("paypal"),t.includes(e,"amazonhp")||i.push("amazonhp"),i=this.mapPaymentProcessors(i),i.length&&(s=["Payments via bank account are also supported by",n.listToEnglishStr(i,"and")].join(" ")+". "),s}},{key:"buildOrder",value:function(e,t,n){var s=new i.Model(this.model.flattenPercentageTree());s.set({amount:this.model.get("amount_pennies")/100,avg:this.avgstring,avguuid:this.avguuid,avghash:this.avghash,email:this.$("#temail").val(),payment_type:t,processor:e,product:this.product.get("machine_name"),abtests:JSON.stringify(this.options.abtests),charity_id:this.user.get("charity_id")}),s.set(this.giftView.getOrderFormParameters()),this.captcha&&s.set(this.captcha.getResponseParameters(n,!0));var a=this.$("input[name=subscribe]").prop("checked");a&&s.set("subscribe","on");var o=this.$("input[name=third_party_subscribe]").prop("checked");o&&s.set("third_party_subscribe","on"),this.humbleOrder.get("gamekey")&&s.set("gamekey",this.humbleOrder.get("gamekey"));var r=this.model.get("topallow");r&&s.set({topallow:r,topname:this.model.get("topname")||"Anonymous"});var l=this.$(".stripe-cc_data").val();return l&&s.set("stripe_cc_data",l),"stored_credential"==e&&s.set("payment_credential_uid",this.paymentOptionsView.defaultPaymentCredentialUid),s.set("partner_thankname",this.$("#twitch_handle").val()),s}},{key:"formSubmit",value:function(t){e.ajax({type:"POST",url:"/humbler/submit",data:t.attributes,dataType:"json",success:function(e){e.amazon_params?this.handleAmazonResponse(e.amazon_params):e.redirect_url&&(window.location.href=e.redirect_url)}.bind(this)})}},{key:"validateEmailField",value:function(){var e=this.emailInput.val();return n.isValidEmail(e)}},{key:"showEula",value:function(){var n=this,i=e(t.template(k)({eula:this.product.get("eula")}));e("#site-modal").html(i);var s=e(".grayout");s.fadeIn(),i.fadeIn(),i.find(".js-cancel").click(function(e){e.preventDefault(),e.stopPropagation(),s.fadeOut(),i.fadeOut()}),i.find(".js-confirm").click(function(e){e.preventDefault(),e.stopPropagation(),s.fadeOut(),i.fadeOut(),n.eula_accepted=!0,n.submitOrderForm()})}},{key:"updateAmount",value:function(){if(this.isOrderAdder){var t=this.model.getCurrentDollarAmount();e(".new-order-amount").html(n.moneyfmt(t,"USD")),e(".new-total").html(n.moneyfmt(this.personalTotal+parseFloat(t),"USD"))}}},{key:"showThanknameMessage",value:function(n){if(n){var i=this.$(".order-form-thankname-error-container"),s=t.template(w)({errorText:n,identifierClass:"order-form-msg-is-error",warningClass:""}),a=e(s).appendTo(i);a.fadeIn()}}},{key:"showEmailMessage",value:function(n,i,s){if(i){var a=n.siblings(".order-form-email-error-container"),o=t.template(w)({errorText:s?"Please enter a valid email address":i,identifierClass:s?"order-form-msg-is-error":"order-form-msg-is-warning",warningClass:""}),r=e(o).appendTo(a);return r.fadeIn(),r}}},{key:"hideEmailMessages",value:function(e){var t=e.siblings(".order-form-email-error-container");t.empty(),this.$markInputAsValid(e)}},{key:"liveEmailCheckCallback",value:function(e,t,n){return this.hideEmailMessages(e),t?(n?this.$markInputAsInvalidWithError(e):this.$markInputAsInvalidWithWarning(e),this.showEmailMessage(e,t,n)):null}},{key:"$markInputAsInvalidWithError",value:function(e){e.addClass("order-form-input-is-invalid-with-error")}},{key:"$markInputAsInvalidWithWarning",value:function(e){e.addClass("order-form-input-is-invalid-with-warning")}},{key:"$markInputAsValid",value:function(e){e.removeClass("order-form-input-is-invalid-with-error order-form-input-is-invalid-with-warning")}},{key:"preventDefault",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"validateForm",value:function(){if(!this.isOrderAdder){var e=this.validateEmailField();if(!e)return this.showEmailMessage(this.emailInput,"Please enter a valid email.",!0),!1;this.hideEmailMessages(this.emailInput)}return!!this.validateGiftEmail(this)&&(!!this.model.isValid(this.product.get("has_free_content"))&&(!!this.validatePartnerThankname()&&void this.executeCaptcha()))}},{key:"validateGiftEmail",value:function(){var e=this.$("#gift_email");if(e.length){var t=e.val();return n.isValidEmail(t)?(this.hideEmailMessages(e),!0):(this.$markInputAsInvalidWithError(e),this.showEmailMessage(e,"Please enter a valid email.",!0),!1)}return!0}},{key:"validatePartnerThankname",value:function(){var e=!0,t=this.$("#twitch_handle").val();return t?(t.length>300&&(this.showThanknameMessage("Exceeds 300 character limit"),e=!1),t.indexOf("\n")>-1&&(this.showThanknameMessage('"\n" is not allowed'),e=!1),e&&this.$(".order-form-thankname-error-container").empty(),e):(this.$(".order-form-thankname-error-container").empty(),e)}},{key:"validateSubscriptionStatus",value:function(){if(this.product.get("requires_subscription")&&!this.user.get("monthly_has_perks")){var e=new f({loggedIn:this.user.get("is_logged_in"),humanName:this.product.get("requires_subscription")});e.render().$el.appendTo(this.$(".js-order-form-subscription-error-container"))}}},{key:"executeCaptcha",value:function(){this.captcha?this.captcha.reset():this.captcha=CreateCaptcha("order-form-recaptcha",this.onValidation.bind(this),{size:"invisible"}),this.model.set("in_progress",!0),this.captcha.execute()}},{key:"openAccountLoginModal",value:function(e){e.preventDefault(),v({name:"login",attributes:window.modal_attributes})}},{key:"handleAmazonResponse",value:function(e){this.amazonParams=e,this.$("#AmazonPayButtonHolder img").click()}}]),a}(s);T.prototype.defaults={split_dict:null,text_input:null},T.prototype.events={"submit #order-form":"preventDefault","change #temail":"validateEmailField","click .js-account-login":"openAccountLoginModal"},T.prototype.template=y;var S=function e(t,n){if(Array.isArray(t)){var i=t.map(function(t){return e(t,n)});return"["+i.join(",")+"]"}if("object"===("undefined"==typeof t?"undefined":_typeof(t))){var s=Object.keys(t).sort(n);return s=s.map(function(n){return JSON.stringify(n)+": "+e(t[n])}),"{"+s.join(",")+"}"}return JSON.stringify(t)},j=function(e){var t=S(e),n=0;if(!t.length)return n;for(var i=0;i<t.length;i++){var s=t.charCodeAt(i);n=(n<<5)-n+s,n&=n}return n};return e(function(){var t=["a[href=#contribute]","a[href=#mailing-list]"];e(t.join(", ")).off("click").click(function(){if(location.pathname.replace(/^\//,"")===(void 0).pathname.replace(/^\//,"")&&location.hostname===(void 0).hostname){var t=e((void 0).hash);if(t=t.length?t:e("[name="+(void 0).hash.slice(1)+"]"),t.length)return e("html,body").animate({scrollTop:t.offset().top},1e3),!1}})}),T}),define("orderform/main",["require","jquery","commonModels/Product","commonModels/HumbleOrder","./OrderForm"],function(e){var t=(e("jquery"),e("commonModels/Product")),n=e("commonModels/HumbleOrder"),i=e("./OrderForm");return function(e){var s=new t(e.models.product_json),a=new n(e.models.keyentity_json),o=new i({product:s,humbleOrder:a,request:e.models.request,streamlabsEnabled:e.streamlabsEnabled,user:e.user,charities:e.charities,checkoutTiers:e.models.checkout_tiers,el:e.$el,charityConstants:e.charityConstants,allowedPaymentProcessors:e.allowedPaymentProcessors,softLockMessages:e.softLockMessages,isEUCountry:e.isEUCountry});return o.render(),o}}),define("bundle/statistics/statistics",["require","jquery","lib/big","pubnub","util/main"],function(e){"use strict";var t=e("jquery"),n=e("lib/big"),i=e("pubnub"),s=e("util/main"),a=t(".js-statistics-total-payments"),o=t(".js-statistics-num-purchases"),r=function(e,t){e=s.moneyfmt(e,"USD"),t=s.numberWithCommas(t),a.text(e),o.text(t)},l=function(){t(".st-leaderboard-name").each(function(){s.twitter_linkify(t(this))})},c=function(e){var t=e.productMachineName,s=0;l(),i.subscribe({channel:"humble"+t,callback:function(e){if(e.stats&&!(s>e.timestamp)){s=e.timestamp;var t=parseInt(e.stats.numberofcontributions.total),i=new n(e.stats.rawtotal);r(i,t)}}})};return{init:c}}),define("bundle/statistics/main",["require","./statistics","jquery"],function(e){"use strict";var t=e("./statistics"),n=e("jquery"),i=function(){for(var e=n(".st-content"),t=[],i=0;i<e.length;i++){var s=e.eq(i);s.data("index",i),t.push({isAnimating:!1,isClosed:!0,$caret:s.find(".st-header-caret"),$body:s.find(".st-body")})}e.on("click",function(){var e=n(this),i=e.data("index"),s=t[i];s.isClosed?(s.$caret.removeClass("hb-caret-right"),s.$caret.addClass("hb-caret-down"),s.$body.show()):(s.$caret.removeClass("hb-caret-down"),s.$caret.addClass("hb-caret-right"),s.$body.hide()),s.isClosed=!s.isClosed})},s=function(e,n){n&&i(),t.init(e)};return{init:s}}),define("lib/hbTemplate!bundle/bonus_items/desktop_bonus_items.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="desktop-bonus-container js-nav-row">\n  <div class="dd-header">\n    <h2 class="dd-header-headline">Bonuses</h2>\n  </div>\n  <div class="bonus-items-container desktop u-constrain-width"></div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!bundle/bonus_items/_desktop_bonus_item.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="bonus-item-header">\n<%- short_heading %>\n</div>\n<div class="bonus-item-image">\n  <span class="<%- type %>-image">\n    <div class="image-center-helper"></div>\n<% if (preview_image || front_page_art) { %>\n<% if (preview_image) { %>\n    <img data-src="<%- preview_image %>"\n        data-retina-src="<%- preview_image_retina %>"\n        alt="<%- human_name %>">\n<% } else { %>\n    <img data-src="<%- front_page_art %>"\n        data-retina-src="<%- front_page_art_retina %>"\n        alt="<%- human_name %>">\n<% } %>\n<% if (type === \'soundtrack\') { %>\n    <div class="js-hover-state-holder"></div>\n<% } %>\n<% } else { %>\n    <img data-src="https://img.youtube.com/vi/<%- youtube_link %>/default.jpg"\n         data-retina-src="https://img.youtube.com/vi/<%- youtube_link %>/mqdefault.jpg"\n         alt="<%- human_name %>">\n<% } %>\n  </span>\n</div>\n<div class="bonus-item-content">\n  <div class="bonus-item-body">\n<% if (render_admin_links) { %>\n    <span class="js-admin-edit" data-entity-kind="display_item" data-machine-name="<%- display_item_machine_name %>"></span>\n<% } %>\n<%- human_name %>\n  </div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!bundle/bonus_items/mobile_bonus_items.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="mbi-header">\n  <span class="dd-header-headline">Bonuses</span>\n  <i class="mbi-caret hb hb-caret-right"></i>\n</div>\n<div class="mbi-drawer">\n  <div class="bonus-items-container u-constrain-width"></div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!bundle/bonus_items/_mobile_bonus_item.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="bonus-item-image">\n  <span class="<%- type %>-image">\n<% if (preview_image || front_page_art) { %>\n<% if (preview_image) { %>\n    <img data-src="<%- preview_image %>"\n        data-retina-src="<%- preview_image_retina %>"\n        alt="<%- human_name %>">\n<% } else { %>\n    <img data-src="<%- front_page_art %>"\n        data-retina-src="<%- front_page_art_retina %>"\n        alt="<%- human_name %>">\n<% } %>\n<% } else { %>\n    <img data-src="https://img.youtube.com/vi/<%- youtube_link %>/default.jpg"\n         data-retina-src="https://img.youtube.com/vi/<%- youtube_link %>/mqdefault.jpg"\n         alt="<%- human_name %>">\n<% } %>\n  </span>\n</div>\n<div class="bonus-item-content">\n  <div class="bonus-item-header">\n<%- short_heading %>\n  </div>\n  <div class="bonus-item-body">\n<% if (type === \'soundtrack\') { %>\n    Soundtrack\n<% } else { %>\n<%- human_name %>\n<% } %>\n  </div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!bundle/bonus_items/js_hover_state.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<span class="hover-black-overlay"></span>\n<% if (icon_class) { %>\n<div class="hover-icon-holder">\n  <i class="hb <%- icon_class %> hover-icon u-center"></i>\n</div>\n<% } %>\n'.replace(/xSTATIC_URLx/g,t)}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("bundle/bonus_items/bonus_items",["require","backbone","jquery","lib/lodash","common/DOMLessView","hbtemplate!./desktop_bonus_items.tpl.html","hbtemplate!./_desktop_bonus_item.tpl.html","hbtemplate!./mobile_bonus_items.tpl.html","hbtemplate!./_mobile_bonus_item.tpl.html","hbtemplate!./js_hover_state.tpl.html"],function(e){"use strict";function t(e,t,n){e.addClass("hoverable");var i=a.template(d),s=i({icon_class:n});t.after(s)}function n(e,t,n){if(e&&e.length){var a=new i.Collection(e);a.each(function(e){return e.set("render_admin_links",n)});var o=void 0;o=t?new f({collection:a,el:s(".js-mbi-bonus-container")}):new m({collection:a,el:s(".js-desktop-bonus-container")}),o.render()}}var i=e("backbone"),s=e("jquery"),a=e("lib/lodash"),o=e("common/DOMLessView"),r=e("hbtemplate!./desktop_bonus_items.tpl.html"),l=e("hbtemplate!./_desktop_bonus_item.tpl.html"),c=e("hbtemplate!./mobile_bonus_items.tpl.html"),u=e("hbtemplate!./_mobile_bonus_item.tpl.html"),d=e("hbtemplate!./js_hover_state.tpl.html"),h=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"onRender",value:function(){this.$el.addClass(this.model.get("type")+"-item"),(this.model.get("preview_image")||this.model.get("youtube_link"))&&this.$el.attr("data-slideout",this.model.get("display_item_machine_name"))}}]),t}(o);h.prototype.template=l,h.prototype.className="desktop bonus-item u-lazy-load";var m=function(e){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,e),_createClass(n,[{key:"onRender",value:function(){var e=this,n=this.$(".bonus-items-container");n.empty(),this.collection.each(function(t){n.append(new e.childView({model:t}).render().$el)});var i=this.$(".soundtrack-item"),s=this.$(".js-hover-state-holder");t(i,s,"hb-headphones"),this.$el.addClass("main-content-row")}}]),n}(o);m.prototype.template=r,m.prototype.childView=h;var p=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),t}(h);p.prototype.template=u,p.prototype.className="bonus-item u-lazy-load";var f=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){this.expanded=!1}},{key:"onRender",value:function(){m.prototype.onRender.call(this),this.toggleDrawer()}},{key:"toggleDrawer",value:function(){this.expanded=!this.expanded,this.expanded?(this.$(".mbi-caret").removeClass("hb-caret-right"),this.$(".mbi-caret").addClass("hb-caret-down"),this.$(".mbi-drawer").show()):(this.$(".mbi-caret").removeClass("hb-caret-down"),this.$(".mbi-caret").addClass("hb-caret-right"),this.$(".mbi-drawer").hide())}}]),t}(m);return f.prototype.events={"click .mbi-header":"toggleDrawer"},f.prototype.template=c,f.prototype.childView=p,{init:n}});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("bundle/choose_your_own_charity/charity_row",["require","backbone","charity/bundle"],function(e){"use strict";function t(e){var t=e.displayItemData,n=e.constants,i=e.user,s=new a(t),r=new o({user:i,constants:n,collection:s});r.attachEvents()}var n=e("backbone"),i=e("charity/bundle"),s=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),t}(n.Model);s.prototype.idAttribute="machine_name";var a=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),t}(n.Collection);a.prototype.model=s;var o=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){var t=e.constants,n=e.user;this.constants=t,this.user=n}},{key:"attachEvents",value:function(){var e=this;$("[data-display-modal]").each(function(){var t=$(this),n=t.data("display-modal"),s=e.collection.get(n);if(s){s.set({logo_url:s.get("resolved_paths").preview_image||s.get("ppgf_info").logo_url,description:s.get("description_text")||s.get("ppgf_info").description,charity_id:void 0,ppgf_disclaimer:!s.get("description_text")});var a=void 0;s.get("developers")&&s.get("developers")[0]&&(a=s.get("developers")[0].developer_url),s.set("url",a),t.on("click",function(){new i.CharityDetailsView({el:$(".grayout-inner"),constants:e.constants,user:e.user,model:s})})}})}}]),t}(n.View);return t});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();define("bundle/free/captcha",["require","jquery","backbone"],function(e){"use strict";var t=(e("jquery"),e("backbone")),n=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"onSubmit",value:function(e){e.preventDefault(),this.captcha=CreateCaptcha("free-purchase-popup-captcha",this.submit.bind(this),{size:"invisible"}),this.captcha.execute()}},{key:"submit",value:function(e){this.$el.submit()}}]),t}(t.View);return n.prototype.events={"click .js-free-purchase-submit":"onSubmit"},n}),define("common/registerGoogleTrackingEvents",["require","jquery"],function(e){"use strict";var t=e("jquery");return function(e){t("[data-ga-track]").click(function(n){var i=t(n.currentTarget).data("ga-track"),s=void 0,a=void 0;i&&(i=i.split("-"),s=i[0],i.length>1&&(a=i[1])),_gaTrackEvent(s,a,e)})}}),define("constants/platformAndDelivery",["require"],function(e){return{web_delivery_methods:{asmjs:"asmjs",unitywasm:"unitywasm"},delivery_method_definition_dict:{origin:{human_name:"Origin",preamble:"Redeem for",icon:"hb-origin"},asmjs:{preamble:"Play in",icon:"hb-bundle"},blizzard:{importance:5,human_name:"Blizzard Battle.net",preamble:"Redeem for",icon:"hb-blizzard"},xboxone:{human_name:"Xbox One",preamble:"Play on",icon:"hb-xboxone"},wiiu:{human_name:"WiiU",preamble:"Redeem on",icon:"hb-WiiU"},download:{importance:2,human_name:"DRM-free download",preamble:"Download for",icon:"hb-drmfree"},ps3:{human_name:"PS3",preamble:"Play on",icon:"hb-psthree"},ps4:{human_name:"PS4",preamble:"Play on",icon:"hb-psfour"},"video-download":{human_name:"Movie",preamble:"Download",icon:"hb-movie"},web:{preamble:"Play in",icon:"hb-globe"},gog:{importance:3,human_name:"GOG",preamble:"Redeem for",icon:"hb-gog"},download_drm:{human_name:"DRM download",preamble:"Redeem for",icon:"hb-key"},"audio-download":{human_name:"Audio download",preamble:"Download",icon:"hb-audio"},"3DS":{human_name:"3DS",preamble:"Redeem on",icon:"hb-threeds"},iOS:{human_name:"iOS",preamble:"Redeem for",icon:"hb-osx"},"other-key":{human_name:"Key",preamble:"Redeem for",icon:"hb-key"
},rifftrax:{preamble:"Available via",icon:"hb-rifftrax"},android:{human_name:"Android",preamble:"Download for",icon:"hb-android"},psvita:{human_name:"PSVita",preamble:"Play on",icon:"hb-psvita"},vhx:{human_name:"VHX",preamble:"Download/stream on",icon:"hb-movie"},"physical-copy":{human_name:"Physical Copy",icon:"hb-library"},uplay:{importance:4,human_name:"Uplay",preamble:"Redeem for",icon:"hb-uplay"},steam:{importance:1,human_name:"Steam",preamble:"Redeem for",icon:"hb-steam"}},platform_definition_dict:{firefox:{human_name:"Firefox",icon:"hb-firefox"},flac:{human_name:"FLAC",icon:"hb-file"},xboxone:{human_name:"Xbox One",icon:"hb-xboxone"},mp3:{human_name:"MP3",icon:"hb-file-mp3"},wiiu:{human_name:"Nintendo Wii U",icon:"hb-WiiU"},linux:{importance:3,human_name:"Linux",icon:"hb-linux"},ps3:{human_name:"Playstation 3",icon:"hb-psthree"},ps4:{human_name:"Playstation 4",icon:"hb-psfour"},chrome:{human_name:"Chrome",icon:"hb-chrome"},wav:{human_name:"WAV",icon:"hb-file-audio-o"},android:{human_name:"Android",icon:"hb-android"},"3DS":{human_name:"Nintendo 3DS",icon:"hb-threeds"},iOS:{human_name:"iOS",icon:"hb-osx"},mac:{importance:2,human_name:"Mac",icon:"hb-osx"},rifftrax:{human_name:"Rifftrax",icon:"hb-rifftrax"},hd:{human_name:"HD",icon:"hb-movie"},psvita:{human_name:"Playstation Vita",icon:"hb-psvita"},vive:{human_name:"HTC Vive",icon:"hb-vive"},windows:{importance:1,human_name:"Windows",icon:"hb-windows"},"physical-copy":{human_name:"Physical Copy",icon:"hb-library"},"oculus-rift":{human_name:"Oculus Rift",icon:"hb-oculus"},sd:{human_name:"SD",icon:"hb-movie"},browser:{human_name:"modern browsers like Chrome or Firefox",icon:"hb-singleplatform"}}}}),define("lib/hbTemplate!remindMe/templates/RemindMeIconView.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<a href="#" class="js-remind-button save-button">\n  <span class="hb hb-bell-o not-saved-icon js-bell"></span>\n  <span class="hb hb-bell saved-icon js-bell" title="Remind Me"></span>\n  <i class="js-spinner inline-spinner dark-spinner hidden"></i>\n</a>\n<span class="error-box js-error-box"></span>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("remindMe/views",["require","util/csrfUtils","common/DOMLessView","account/Modal","hbtemplate!../remindMe/templates/RemindMeIconView.html"],function(e){"use strict";var t=e("util/csrfUtils"),n=e("common/DOMLessView"),i=e("account/Modal"),s=e("hbtemplate!../remindMe/templates/RemindMeIconView.html"),a="Error! Couldn't set your preference.",o="Ending too soon for a reminder. Get it now!",r="OK! We'll remind you when this is almost over.",l="Reminder has been removed.",c=function(){window._gaTrackEvent&&_gaTrackEvent.apply(null,arguments)},u=n.extend({className:"remind-me-icon-view save-for-later",template:s,ui:{remindButton:".js-remind-button",bellIcons:".js-bell",spinner:".js-spinner",errorBox:".js-error-box"},events:{"click @ui.remindButton":"toggleRemind"},initialize:function(e){this.productMachineName=e.productMachineName,this.productHumanName=e.productHumanName,this.isLoggedIn=e.isLoggedIn,this.model||(this.model=new Backbone.Model({isReminded:e.isReminded})),this.model.on("change:isReminded",this.toggleRemindState,this),this.postBody=_defineProperty({product_machine_name:this.productMachineName},t.formKey,t.getCsrf())},onRender:function(){this.toggleRemindState()},toggleRemind:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.model.get("isReminded")?this.unremind():this.isLoggedIn?this.remind():i({name:"login",attributes:window.modal_attributes})},toggleRemindState:function(){this.model.get("isReminded")?this.showReminded():this.showUnreminded()},showReminded:function(){this.ui.remindButton.addClass("saved")},showUnreminded:function(){this.ui.remindButton.removeClass("saved")},showProcessing:function(){this.ui.bellIcons.addClass("hidden"),this.ui.spinner.removeClass("hidden")},hideProcessing:function(){this.ui.bellIcons.removeClass("hidden"),this.ui.spinner.addClass("hidden")},remind:function(){c("Remind Me","Reminder Set",this.productMachineName),this.showProcessing(),$.post("/bundle/remindme",$.extend({action:"add"},this.postBody)).success(function(e){e.success?this.onRemindSuccess():"toosoon"==e.msg?this.onCutOffReached():this.onGeneralError()}.bind(this)).error(function(){this.onGeneralError()}.bind(this)).done(function(){this.hideProcessing()}.bind(this))},onRemindSuccess:function(){this.model.set("isReminded",!0),this.showAndFade(r)},onUnremindSuccess:function(){this.model.set("isReminded",!1),this.showAndFade(l)},onCutOffReached:function(){this.ui.errorBox.text(o).show().delay(1e3).queue(function(){this.$el.fadeOut()}.bind(this))},onGeneralError:function(){this.showAndFade(a)},showAndFade:function(e){this.ui.errorBox.text(e).show().delay(1500).fadeOut()},unremind:function(){c("Remind Me","Reminder Removed",this.productMachineName),this.showProcessing(),$.post("/bundle/remindme",$.extend({action:"remove"},this.postBody)).success(function(e){e.success?this.onUnremindSuccess():this.onGeneralError()}.bind(this)).error(function(){this.onGeneralError()}.bind(this)).done(function(){this.hideProcessing()}.bind(this))}});return{RemindMeIconView:u}}),define("lib/hbTemplate!wishlist/templates/WishlistIconView.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<a href="#" class="js-wishlist-button save-button">\n  <span class="hb hb-star-o not-saved-icon js-star"></span>\n  <span class="hb hb-star saved-icon js-star"></span>\n  <i class="js-spinner inline-spinner dark-spinner hidden"></i>\n</a>\n<span class="error-box js-error-box"></span>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("wishlist/views",["require","util/csrfUtils","account/Modal","common/DOMLessView","hbtemplate!../wishlist/templates/WishlistIconView.html"],function(e){"use strict";var t=e("util/csrfUtils"),n=e("account/Modal"),i=e("common/DOMLessView"),s=e("hbtemplate!../wishlist/templates/WishlistIconView.html"),a="Error! Couldn't edit your wishlist.",o="We'll email you when this goes on sale.",r="Removed from wishlist.",l=function(){window._gaTrackEvent&&_gaTrackEvent.apply(null,arguments)},c=i.extend({className:"wishlist-icon-view save-for-later",template:s,ui:{wishlistButton:".js-wishlist-button",starIcons:".js-star",spinner:".js-spinner",errorBox:".js-error-box"},events:{"click @ui.wishlistButton":"toggleWishlist"},initialize:function(e){this.productMachineName=e.productMachineName,this.productHumanName=e.productHumanName,this.isLoggedIn=e.isLoggedIn,this.isWishlisted=e.isWishlisted,this.postBody=_defineProperty({},t.formKey,t.getCsrf())},serializeData:function(){return{isWishlisted:this.isWishlisted}},onRender:function(){this.toggleWishlistState()},toggleWishlist:function(e){e&&e.preventDefault(),this.isWishlisted?this.removeFromWishlist():this.isLoggedIn?this.addToWishlist():n({name:"login",attributes:window.modal_attributes})},toggleWishlistState:function(){this.isWishlisted?this.showWishlisted():this.showNotWishlisted()},showWishlisted:function(){this.ui.wishlistButton.addClass("saved")},showNotWishlisted:function(){this.ui.wishlistButton.removeClass("saved")},showProcessing:function(){this.ui.starIcons.addClass("hidden"),this.ui.spinner.removeClass("hidden")},hideProcessing:function(){this.ui.starIcons.removeClass("hidden"),this.ui.spinner.addClass("hidden")},addToWishlist:function(){l("Add to Wishlist Element","Product Added to Wishlist",this.productMachineName+"|"+location.pathname),this.showProcessing(),$.ajax({method:"POST",url:"/wishlist/add/"+this.productMachineName,data:this.postBody,dataType:"json"}).success(function(e){e.success?this.onAddedSuccess():e.error&&this.onSpecificError(e.error)}.bind(this)).error(function(){this.onGeneralError()}.bind(this)).done(function(){this.hideProcessing()}.bind(this))},onAddedSuccess:function(){this.isWishlisted=!0,this.toggleWishlistState(),this.showAndFade(o)},onRemovedSuccess:function(){this.isWishlisted=!1,this.toggleWishlistState(),this.showAndFade(r)},onSpecificError:function(e){this.showAndFade(e)},onGeneralError:function(){this.showAndFade(a)},showAndFade:function(e){this.ui.errorBox.text(e).show().delay(1500).fadeOut()},removeFromWishlist:function(){l("Remove from Wishlist Element","Product Removed from Wishlist",this.productMachineName+"|"+location.pathname),this.showProcessing(),$.ajax({method:"POST",url:"/wishlist/remove/"+this.productMachineName,data:this.postBody,dataType:"json"}).success(function(e){e.success?this.onRemovedSuccess():e.error&&this.onSpecificError(e.error)}.bind(this)).error(function(){this.onGeneralError()}.bind(this)).done(function(){this.hideProcessing()}.bind(this))}});return{WishlistIconView:c}}),define("common/productTiles/constants",["require"],function(e){return{TILE_SIZES:{FULL:"full",HERO:"hero",THREE_FOURTHS:"three-fourths",HALF:"half",QUARTER:"quarter",ONE_THIRD:"one-third"},STAMPS:{MIXED:"mixed",BOOKS:"books",GAMES:"games",COMICS:"comics",MONTHLY_STAMP:"monthly_stamp",AUDIOBOOK:"audiobook",MOBILE:"mobile",SOFTWARE:"software"},HERO_GRID:{SQUARE_LENGTH:150,GAME_WIDTH:308,GAME_HEIGHT:177,COVER_WIDTH:150,COVER_HEIGHT:218},PRODUCT_TYPES:{MONTHLY:"monthly",COUPON:"coupon",STORE:"store",BUNDLE:"bundle",CUSTOM:"custom"},CUSTOM_TILE_TYPES:{HTML:"html",BUNDLE_MONTHLY:"bundle/monthly"}}}),define("lib/hbTemplate!common/productTiles/templates/CustomHtmlTileView.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<style>\n<%= _l.unescape(tile_css) %>\n</style>\n<%= _l.unescape(tile_html) %>".replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!common/productTiles/templates/FullTileView.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="js-tile-view simple-tile-view <%- size %>"></div>\n<div class="tile-info <%- type %>">\n  <div class="primary info-section">\n    <a class="name" href="<%- product_url %>"><%- tile_name %></a>\n    <div class="remind-me js-remind-me"></div>\n  </div>\n  <a class="secondary info-section" href="<%- product_url %>">\n<% if (highlights) { %>\n    <div class="highlights">\n  <% _l.each(highlights, function(highlight) { %>\n      <span class="highlight"><%- highlight %></span>\n  <% }) %>\n    </div>\n<% } %>\n    <div class="js-countdown-view full-countdown-view"></div>\n  </a>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!common/productTiles/templates/ImageGridView.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="hero-background-side-fadeout"></div>\n<div class="hero-background-overlay"></div>\n<div class="hero-background">\n<% if (useGridBackground) { %>\n  <ul class="image-grid">\n  <% _l.each(gridImages, function(image) { %>\n    <li class="image-grid-item-container">\n      <img class="image-grid-item" src="<%- image %>"/>\n    </li>\n  <% }); %>\n  </ul>\n<% } else { // TODO ENG-13708 this logic should not be part of this template %>\n  <div class="hero-background-image" style="background-image: url(<%- high_res_tile_image %>)"></div>\n<% } %>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!common/productTiles/templates/HeroTileView.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="hero-background-container">\n</div>\n<% if (!isOnBundlePage) { %>\n<a href="<%- product_url %>" class="hero-invisible-link">\n<% } %>\n<% if (isOnBundlePage) { %>\n<div class="js-hero-charity hero-charity-container"></div>\n<% } %>\n<div class="hero-foreground-container">\n  <div class="hero-foreground">\n<% if (type == \'bundle\') { %>\n  <% if (tile_stamp && tile_logo) { %>\n    <div class="tile-stamp-and-logo">\n        <span class="stamp <%- tile_stamp %>"></span>\n        <div class="hero-bundle-logo" style="background-image: url(\'<%- tile_logo %>\')"></div>\n    </div>\n    <% } if (tile_name) { %>\n    <div class="tile-name bold-upper"><%- tile_name %></div>\n    <% } %>\n    <% // note: do not escape blurbs as monthly overrides contain html %>\n  <% if (marketing_blurb) { %>\n    <p class="marketing-blurb"><%= marketing_blurb %></p>\n  <% } %>\n  <% if (detailed_marketing_blurb) { %>\n    <p class="detailed-marketing-blurb"><%= detailed_marketing_blurb %></p>\n  <% } %>\n  <div class="hero-highlights">\n  <% _l.each(hero_highlights, function(highlight, index) { %>\n      <div class="highlight-container">\n      <% if (index !== 0) { %>\n        <div class="highlight-divider"><i class="hb hb-circle"></i></div>\n      <% } %>\n        <div class="highlight-popup-container">\n          <span class="highlight bold-upper"><%- highlight.heading %></span>\n      <% if (highlight.tooltip) { %>\n          <span class="highlight-popup"><%- highlight.tooltip %></span>\n      <% } %>\n        </div>\n      </div>\n  <% }) %>\n    <div class="highlight-divider"><i class="hb hb-circle"></i></div>\n    <span class="highlight bold-upper"><span class="js-bundles-sold"><%- bundlesSold %></span> Bundles Sold</span>\n  </div>\n  <div class="cta-button rectangular-button button-v2 green hero-cta">Get The Bundle</div>\n  <div class="time-left bold-upper">TIME LEFT</div>\n  <% if (isOnBundlePage) { %>\n  <div class="hero-countdown-container">\n    <div class="hero-remindme-container">\n      <div class="remind-me js-hero-remind-me"></div>\n      <div class="remind-me-text">REMIND</div>\n    </div>\n  <% } %>\n    <div class="js-countdown-view full-countdown-view"></div>\n  <% if (isOnBundlePage) { %>\n  </div>\n  <% } %>\n<% } %>\n  </div>\n</div>\n<% if (!isOnBundlePage) { %>\n</a>\n<% } %>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!common/productTiles/templates/FullStoreTileView.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="js-tile-view simple-tile-view"></div>\n<div class="tile-info <%- type %>">\n  <div class="primary info-section">\n    <a class="name" href="<%- product_url %>"><%- tile_name %></a>\n    <span class="wishlist js-wishlist"></span>\n  </div>\n  <div class="secondary info-section">\n    <div class="devices">\n      <ul class="combined-platforms-operating-systems-list no-style-list">\n<% _l.each(combinedPlatformAndOSList, function(combinedPlatformAndOSList) { %>\n        <li class="platform-os hb <%- combinedPlatformAndOSList.icon %>"\n          title="<%- combinedPlatformAndOSList.humanName %>"></li>\n<% }); %>\n<% if (extraDeviceCount) { %>\n        <li class="hb extraDeviceCount" title="<%- extraDeviceCount %>">+<%- extraDeviceCount %></li>\n<% } %>\n      </ul>\n      </ul>\n    </div>\n    <div class="price">\n<% if (discount > 0) { %>\n      <span class="button-v2 rectangular-button green discount-percentage">-<%- discount %>%</span>\n<% } %>\n      <a class="button-v2 clear-button rectangular-button green buy-button" href="<%- product_url %>"><%- currentPrice %></a>\n    </div>\n  </div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!common/productTiles/templates/SimpleCountdownView.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="js-simple-countdown-timer timer-wrapper button-v2 oval-button black">\n  <span class="js-days timer-field"></span>\n</div>\n<div class="js-countdown-timer timer-wrapper button-v2 oval-button red hidden">\n  <span class="js-days timer-field"></span><span class="timer-separator">:</span><span class="js-hours timer-field"></span><span class="timer-separator">:</span><span class="js-minutes timer-field"></span><span class="timer-separator">:</span><span class="js-seconds timer-field"></span>\n</div>\n<div class="js-hero-countdown-timer hidden">\n  <div class="hero-timer-item button-v2 rectangular-button">\n    <span class="js-days timer-field"></span>\n    <div class="timer-unit">days</div>\n  </div>\n  <div class="hero-timer-item button-v2 rectangular-button">\n    <span class="js-hours timer-field"></span>\n    <div class="timer-unit">hrs</div>\n  </div>\n  <div class="hero-timer-item button-v2 rectangular-button">\n    <span class="js-minutes timer-field"></span>\n    <div class="timer-unit">min</div>\n  </div>\n  <div class="hero-timer-item button-v2 rectangular-button">\n    <span class="js-seconds timer-field"></span>\n    <div class="timer-unit">sec</div>\n  </div>\n</div>'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!common/productTiles/templates/SimpleTileView.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<a href="<%- product_url %>" class="image-link">\n<% if (shouldLoadHighResImage) { %>\n\n\n  <img\n    class="js-tile-image tile-image js-lazyload"\n    data-srcset="\n      <%- tile_image %> 616w,\n      <%- high_res_tile_image %> 1200w,\n      <%- tile_image %> 1232w,\n      <%- high_res_tile_image %> 2400w\n    "\n    sizes="(min-width: 48em) 1200px, 616px"\n    data-src="<%- tile_image %>"\n  />\n<% } else { %>\n  <img class="js-tile-image tile-image js-lazyload" data-src="<%- tile_image %>" />\n<% } %>\n<% if (tile_stamp || tile_logo || showInfo) { %>\n  <div class="tile-overlay">\n    <div class="tile-stamp-and-logo">\n  <% if (tile_stamp) { %>\n      <span class="stamp <%- tile_stamp %>"></span>\n  <% } %>\n  <% if (tile_logo) { %>\n    <span class="logo" style="background-image: url(\'<%- tile_logo %>\')"></span>\n  <% } %>\n    </div>\n  <% if (showInfo) { %>\n      <div class="js-tile-info tile-info">\n        <div class="js-countdown-view full-countdown-view" />\n        <span class="name"><%- tile_name %></span>\n      </div>\n  <% } %>\n  </div>\n<% } %>\n</a>\n<% if (!_l.isEmpty(moreDetails)) { %>\n<a href="<%- product_url %>" class="more-details">\n  <div class="content">\n    <h2 class="title"><%= moreDetails.title %></h2>\n    <% // note: do not escape blurbs as monthly overrides contain html %>\n    <p class="marketing-blurb"><%= moreDetails.marketingBlurb %></p>\n    <p class="detailed-marketing-blurb"><%= moreDetails.detailedMarketingBlurb %></p>\n    <p class="highlights">\n  <% _l.each(moreDetails.contentHighlights, function(highlight) { %>\n      <span class="highlight"><%= highlight %></span>\n  <% }); %>\n    </p>\n  </div>\n</a>\n<% } %>\n\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!common/productTiles/templates/HeroCharityView.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<% if (charities) { %>\n  <div class="hero-charity-box">\n  <% if (numHiddenCharities > 0) { %>\n  <div class="hero-hidden-charities-container hero-charity-blurb">\n    <div class="hero-hidden-charities">\n        &#43;<%- numHiddenCharities %>\n    </div>\n  </div>\n  <% } %>\n  <div class="hero-charity-content">\n    <% _l.each(charities, function(charity) { %>\n      <div class="hero-charity-item">\n        <div class="hero-charity-logo"><img src="<%- charity.logoUrl %>" alt=""></div>\n      </div>\n    <% }) %>\n  </div>\n  <div class="hero-charity-blurb hero-supporting">Supporting</div>\n</div>\n<% } %>'.replace(/xSTATIC_URLx/g,t)}()});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};define("common/productTiles/views",["require","lib/lodash","lib/moment","util/main","pubnub","constants/platformAndDelivery","common/DOMLessView","remindMe/views","wishlist/views","common/productTiles/constants","hbtemplate!../productTiles/templates/CustomHtmlTileView.html","hbtemplate!../productTiles/templates/FullTileView.html","hbtemplate!../productTiles/templates/ImageGridView.html","hbtemplate!../productTiles/templates/HeroTileView.html","hbtemplate!../productTiles/templates/FullStoreTileView.html","hbtemplate!../productTiles/templates/SimpleCountdownView.html","hbtemplate!../productTiles/templates/SimpleTileView.html","hbtemplate!../productTiles/templates/HeroCharityView.html"],function(e){"use strict";var t=e("lib/lodash"),n=e("lib/moment"),i=e("util/main"),s=e("pubnub"),a=e("constants/platformAndDelivery"),o=e("common/DOMLessView"),r=e("remindMe/views"),l=e("wishlist/views"),c=e("common/productTiles/constants"),u=e("hbtemplate!../productTiles/templates/CustomHtmlTileView.html"),d=e("hbtemplate!../productTiles/templates/FullTileView.html"),h=e("hbtemplate!../productTiles/templates/ImageGridView.html"),m=e("hbtemplate!../productTiles/templates/HeroTileView.html"),p=e("hbtemplate!../productTiles/templates/FullStoreTileView.html"),f=e("hbtemplate!../productTiles/templates/SimpleCountdownView.html"),b=e("hbtemplate!../productTiles/templates/SimpleTileView.html"),v=e("hbtemplate!../productTiles/templates/HeroCharityView.html"),g=[c.TILE_SIZES.THREE_FOURTHS,c.TILE_SIZES.FULL,c.TILE_SIZES.HERO],_=[c.TILE_SIZES.QUARTER,c.TILE_SIZES.ONE_THIRD],y=5,w=function(e,t){if((t.stats||t.stats.numberofcontributions)&&!(e.lastUpdatedPubnubTimestamp>t.timestamp)){e.lastUpdatedPubnubTimestamp=t.timestamp;var n=parseInt(t.stats.numberofcontributions.total);e.model.set("bundles_sold",n),"object"===_typeof(e.ui.numBundlesSold)&&e.ui.numBundlesSold.text(i.numberWithCommas(n))}},k=function(e){s.subscribe({channel:"humble"+e.model.get("machine_name"),callback:function(t){return w(e,t)}})},C=o.extend({className:function(){return["simple-tile-view",this.size,this.model.get("type")].join(" ")},ui:{tileImage:".js-tile-image",numBundlesSold:".js-bundles-sold"},template:b,showInfo:!1,hmbParams:null,initialize:function(e){o.prototype.initialize.apply(this,arguments),this.size=e.size,this.showContentHighlights=void 0==e.showContentHighlights||e.contentHighlights,this.showContentHighlights&&this.model.get("type")===c.PRODUCT_TYPES.BUNDLE&&k(this)},setHMBParams:function(e){this.hmbParams=e},serializeData:function(){var e=o.prototype.serializeData.apply(this,arguments);return t.extend(e,{moreDetails:this.getMoreDetails(),shouldLoadHighResImage:t.includes(g,this.size),showInfo:this.showInfo}),this.hmbParams&&(e.product_url=e.product_url+"?"+this.hmbParams),e},getMoreDetails:function(){var e=this.model.get("type"),n=this.model.get("is_custom");if(n)return{marketingBlurb:this.model.get("marketing_blurb"),detailedMarketingBlurb:this.model.get("detailed_marketing_blurb"),title:this.model.get("product_title"),contentHighlights:this.showContentHighlights?this.model.get("highlights"):[]};if(t.includes([c.PRODUCT_TYPES.COUPON,c.PRODUCT_TYPES.STORE],e))return{};var s={marketingBlurb:this.model.get("marketing_blurb")};s.detailedMarketingBlurb=this.model.get("detailed_marketing_blurb");var a=i.numberWithCommas(this.model.get("bundles_sold")),o=this.model.get("hover_title"),r=this.model.get("hover_highlights")||[];if(e===c.PRODUCT_TYPES.BUNDLE){var l=""+a;t.includes(this.className(),"navbar-tile")&&(l="~"+l),r.push('<span class="js-bundles-sold">'+l+"</span> Sold")}return $.extend(!0,s,{title:o,contentHighlights:this.showContentHighlights?r:[]}),s},onRender:function(){this.$el.attr("class",this.className())}}),T=C.extend({className:function e(){var e=C.prototype.className.apply(this,arguments),t=[e,"navbar-tile"];return this.model.get("is_active")&&t.push("is-active"),t.join(" ")},ui:t.extend({},C.prototype.ui,{countdownTimer:".js-countdown-view"}),showInfo:!0,initialize:function(e){C.prototype.initialize.apply(this,arguments),this.countdownView=new x({model:e.model})},onRender:function(){C.prototype.onRender.apply(this,arguments),this.ui.countdownTimer.append(this.countdownView.render().el)}}),S=o.extend({className:function(){return["full-tile-view",this.size,this.model.get("type")].join(" ")},hmbParams:null,template:!1,ui:{tileView:".js-tile-view"},initialize:function(e){this.user=e.user,this.size=e.size,this.tile=new C({model:e.model,size:this.size})},setPositionDetails:function(e,t,n,i,s){var a={hmb_source:s,hmb_medium:"product_tile",hmb_campaign:"mosaic_section_"+e+"_layout_index_"+t+"_layout_type_"+n+"_tile_index_"+i};this.hmbParams=$.param(a),this.tile.setHMBParams(this.hmbParams)},serializeData:function(){var e=o.prototype.serializeData.apply(this,arguments);return t.includes(_,this.size)&&this.model.get("tile_short_name")&&(e.tile_name=this.model.get("tile_short_name")),this.hmbParams&&(e.product_url=e.product_url+"?"+this.hmbParams),e},onRender:function(){this.$el.attr("class",this.className()),this.tile.setElement(this.ui.tileView).render()}}),j=o.extend({className:"hero-charity-box-container",events:{"click .hero-hidden-charities-container":"expandBox","click .hero-charity-content":"scrollToCharity","click .hero-supporting":"scrollToCharity","mouseenter .hero-charity-content":"expandBox","mouseleave .hero-charity-content":"collapseBox"},ui:{charityEl:".js-hero-charity-view"},template:v,initialize:function(e){this.charities=e.charities,this.smoothScroller=e.smoothScroller,this.isOnBundlePage=e.isOnBundlePage},serializeData:function(){var e=o.prototype.serializeData.apply(this,arguments);return e.charities=this.charities,e.numHiddenCharities=this.charities.length-2,e.isOnBundlePage=this.isOnBundlePage,e},onRender:function(){1===this.charities.length&&this.$el.addClass("single-charity")},expandBox:function(){this.$el.addClass("expanded-charity-box")},collapseBox:function(){this.$el.removeClass("expanded-charity-box")},scrollToCharity:function(){this.smoothScroller&&this.smoothScroller.scrollToCharity()}}),x=o.extend({className:"timer",ui:{simpleCountdownTimer:".js-simple-countdown-timer",expandedCountdownTimer:".js-countdown-timer",heroCountdownTimer:".js-hero-countdown-timer",heroCountdownTimerItem:".hero-timer-item",daysView:".js-days",hoursView:".js-hours",minsView:".js-minutes",secView:".js-seconds"},template:f,initialize:function(e){this.hero=e.hero,this.seconds=0,this.days=0,this.hours=0,this.minutes=0,this.showFullTime=!1,this.endDate=n.utc(this.model.getEndDate())},formatNumberToString:function(e){return e>0?e>9?""+e:"0"+e:"00"},getCurrentDate:function(){return n()},getDays:function(){return this.endDate.diff(this.getCurrentDate(),"days")},getHours:function(){return this.endDate.diff(this.getCurrentDate(),"hours")%24},getMinutes:function(){return this.endDate.diff(this.getCurrentDate(),"minutes")%60},getSeconds:function(){return this.endDate.diff(this.getCurrentDate(),"seconds")%60},switchVisiblityofExpandedTimer:function(){this.ui.expandedCountdownTimer.removeClass("hidden"),this.ui.simpleCountdownTimer.addClass("hidden")},switchVisiblityofHeroTimer:function(){this.ui.heroCountdownTimer.removeClass("hidden"),this.ui.simpleCountdownTimer.addClass("hidden")},switchHeroTimerToRed:function(){this.ui.heroCountdownTimerItem.addClass("ending-soon")},updateFullTimer:function(){this.ui.secView.text(this.formatNumberToString(this.getSeconds())),this.ui.minsView.text(this.formatNumberToString(this.getMinutes())),this.ui.hoursView.text(this.formatNumberToString(this.getHours())),this.ui.daysView.text(this.formatNumberToString(this.getDays()))},updateSimpleTimer:function(){this.ui.daysView.text(this.getDays()+" Days Left")},updateCountdown:function(){this.hero&&(this.getDays()<2&&this.switchHeroTimerToRed(),this.switchVisiblityofHeroTimer()),this.showFullTime||this.hero||this.getDays()<2&&(this.showFullTime=!0,this.switchVisiblityofExpandedTimer()),this.showFullTime||this.hero?this.updateFullTimer():this.updateSimpleTimer()},onRender:function(){this.updateCountdown(),setInterval(this.updateCountdown.bind(this),500)}}),O=S.extend({template:d,ui:t.extend({},S.prototype.ui,{remindMe:".js-remind-me",countdownTimer:".js-countdown-view"}),serializeData:function(){var e=S.prototype.serializeData.apply(this,arguments);return e},initialize:function(){S.prototype.initialize.apply(this,arguments);var e=!0;if(this.model.get("type")===c.PRODUCT_TYPES.MONTHLY&&this.user.get("monthlyWillReceiveFutureMonths"))e=!1;else if(this.model.get("is_custom"))e=!1;else{var i=n(this.model.getEndDate()),s=i.subtract("days",2),a=n();e=a.isBefore(s)}if(e){var o=this.user.get("remindMeProducts");this.remindMeView=new r.RemindMeIconView({productMachineName:this.model.get("machine_name"),productHumanName:this.model.get("human_name"),isLoggedIn:this.user.isLoggedIn(),isReminded:t.includes(o,this.model.get("machine_name"))})}this.model.getEndDate()&&(this.countdownView=new x({model:this.model}))},onRender:function(){S.prototype.onRender.apply(this,arguments),this.remindMeView&&this.ui.remindMe.append(this.remindMeView.render().el),this.countdownView&&this.ui.countdownTimer.append(this.countdownView.render().el)}}),P=o.extend({template:h,ui:{imageGrid:".image-grid"},serializeData:function(){var e=o.prototype.serializeData.apply(this,arguments),t=this.model.get("image_grid_urls")||[];return e.gridImages=this.composeGrid(t),e},initialize:function(e){var t=this,n=e.useGridBackground;this.model.set("useGridBackground",n);var i=e.fadeInterval,s=e.fadeDuration||1e3;n&&i&&setTimeout(function(){t.ui.imageGrid.fadeOut(s).fadeIn(s),setInterval(function(){t.ui.imageGrid.fadeOut(s).fadeIn(s)},i)},i-s)},onRender:function(){this.ui.imageGrid.addClass(this.model.get("image_grid_item_width")===c.HERO_GRID.GAME_WIDTH?"game-grid":"portrait-grid");var e=!!window.chrome&&!!window.chrome.webstore,t="Win32"===window.navigator.platform;window.devicePixelRatio>=1.5&&e&&t&&this.$el.addClass("high-dpi-chrome-windows")},composeGrid:function(e){for(var n=2,i=2,s=this.model.get("image_grid_item_width"),a=this.model.get("image_grid_item_height"),o=s===c.HERO_GRID.GAME_WIDTH?3080:3e3,r=6*window.innerHeight,l=Math.ceil(o/s),u=Math.ceil(r/a),d=[],h=0;h<=u;h++){for(var m=[],p=(h%n*e.length/n+h/n*i)%e.length,f=l;f>0;){var b=e.length-p;if(b<0)return[];var v=Math.min(f,b);m=m.concat(e.slice(p,p+v)),f-=v,p=(p+v)%e.length}d.push(m)}return t.flattenDeep(d)}}),R=o.extend({className:function(){return["hero-tile-view","hero",this.model.get("type")].join(" ")},hmbParams:null,template:m,ui:{countdownTimer:".js-countdown-view",heroBackground:".hero-background-container",charityEl:".js-hero-charity",numBundlesSold:".js-bundles-sold",remindMe:".js-hero-remind-me",remindMeContainer:".hero-remindme-container"},events:{"click .hero-cta":"scrollToCheckout"},serializeData:function(){var e=o.prototype.serializeData.apply(this,arguments);return e.isOnBundlePage=this.isOnBundlePage,e.hero_highlights=this.model.get("hero_highlights"),e.bundlesSold=i.numberWithCommas(this.model.get("bundles_sold")),this.hmbParams&&(e.product_url=e.product_url+"?"+this.hmbParams),e},initialize:function(){k(this),this.backgroundView=new P({model:this.model,useGridBackground:"bundle"===this.model.get("type"),fadeInterval:75e3,fadeDuration:1e3}),this.countdownView=new x({model:this.model,hero:!0}),this.smoothScroller=this.options.smoothScroller,this.isOnBundlePage=this.options.isOnBundlePage,this.hasBanner=this.options.hasBanner,this.remindMeView=new r.RemindMeIconView(this.options.remindMeOptions),this.charityView=new j({charities:this.options.charities,isOnBundlePage:this.isOnBundlePage,smoothScroller:this.smoothScroller}),this.hasBanner=this.options.hasBanner},setPositionDetails:function(e,t,n,i,s){var a={hmb_source:s,hmb_medium:"product_tile",hmb_campaign:"mosaic_section_"+e+"_layout_index_"+t+"_layout_type_"+n+"_tile_index_"+i};this.hmbParams=$.param(a)},scrollToCheckout:function(){this.smoothScroller&&this.smoothScroller.scrollToCheckout()},shouldDisplayRemindMe:function(){var e=n.utc(this.model.getEndDate()),t=n();return e.diff(t,"days")>=2},onRender:function(){this.$el.attr("class",this.className()),this.hasBanner&&this.$el.addClass("with-banner"),
this.ui.countdownTimer.append(this.countdownView.render().el),this.shouldDisplayRemindMe()?(this.ui.remindMe.append(this.remindMeView.render().el),this.ui.countdownTimer.addClass("remindme-visible")):this.ui.remindMeContainer.addClass("hidden"),this.backgroundView.setElement(this.ui.heroBackground).render(),this.ui.charityEl.append(this.charityView.render().el)}}),A=S.extend({template:p,ui:t.extend({},S.prototype.ui,{wishlist:".js-wishlist"}),initialize:function(e){S.prototype.initialize.apply(this,arguments);var n=this.user.get("wishlist");this.wishlistView=new l.WishlistIconView({productMachineName:this.model.get("machine_name"),productHumanName:this.model.get("human_name"),isLoggedIn:this.user.isLoggedIn(),isWishlisted:t.includes(n,this.model.get("machine_name"))})},onRender:function(){S.prototype.onRender.apply(this,arguments),this.ui.wishlist.append(this.wishlistView.render().el)},serializeData:function(){var e=S.prototype.serializeData.apply(this,arguments),n=this.getPlatformInfo(),i=this.getOperatingSystems(),s=this.model.getDisplayCurrentPrice(),a=this.model.getHumanDiscount(),o=t.union(n,i),r=0;return o.length>y&&this.size==c.TILE_SIZES.QUARTER&&(r=o.length-y-1),$.extend(!0,e,{combinedPlatformAndOSList:o,extraDeviceCount:r,currentPrice:s,discount:a}),e},getPlatformInfo:function(){var e=void 0,n=t.map(this.model.get("platforms"),function(t){return e=a.delivery_method_definition_dict[t],e?{icon:e.icon,humanName:e.human_name,importance:e.importance||99}:{}});return t.sortBy(t.without(n,{}),function(e){return e.importance})},getOperatingSystems:function(){var e=void 0,n=t.map(this.model.get("operating_systems"),function(t){return e=a.platform_definition_dict[t],e?{icon:e.icon,humanName:e.human_name,importance:e.importance||99}:{}});return t.sortBy(t.without(n,{}),function(e){return e.importance})}}),E=o.extend({className:function(){return["custom-tile-html-view"].join(" ")},template:u,initialize:function(e){o.prototype.initialize.apply(this,arguments),this.size=e.size},onRender:function(){this.$el.attr("class",this.className())},setPositionDetails:function(){}});return{BaseFullTileView:S,FullTileView:O,HeroTileView:R,ImageGridView:P,FullStoreTileView:A,SimpleCountDownView:x,SimpleTileView:C,NavBarTileView:T,CustomHTMLTileView:E,setBundlesSoldCountFromPubnub:w}}),define("common/productTiles/models",["require","backbone","lib/big","util/main","jquery","common/productTiles/constants"],function(e){"use strict";var t=e("backbone"),n=e("lib/big"),i=e("util/main"),s=e("jquery"),a=e("common/productTiles/constants"),o=t.Model.extend({idAttribute:"machine_name",defaults:{is_custom:!1,end_date:void 0,tile_image:"",tile_logo:"",tile_stamp:"",tile_name:"",type:"",size:"quarter"},getEndDate:function(){return this.get("end_date")}}),r=o.extend({defaults:s.extend(!0,{},o.prototype.defaults,{bundles_sold:0,msrp:0,type:"bundle",image_grid_urls:[],image_grid_item_width:0,image_grid_item_height:0,marketing_blurb:"",detailed_marketing_blurb:""})}),l=o.extend({defaults:s.extend(!0,{},o.prototype.defaults,{detailed_marketing_blurb:"",marketing_blurb:"",type:"monthly"})}),c=o.extend({defaults:s.extend(!0,{},o.prototype.defaults,{current_price:0,full_price:0,operating_systems:[],platforms:[],type:"store"}),getPriceAsBig:function(e){return e?new n(e.amount):null},getFullPriceAsBig:function(){return this.getPriceAsBig(this.get("full_price"))},getCurrentPriceAsBig:function(){return this.getPriceAsBig(this.get("current_price"))},getCurrency:function(){var e=this.get("full_price");return e?e.currency:null},getDisplayPrice:function(e){return i.moneyfmt(e.amount,e.currency)},getDisplayFullPrice:function(){return this.getDisplayPrice(this.get("full_price"))},getDisplayCurrentPrice:function(){return this.getDisplayPrice(this.get("current_price"))},getHumanDiscount:function(){return this.hasDiscount()?new n(100).times(this.getPriceDifferenceAsBig().div(this.getFullPriceAsBig())).toFixed(0):0},getPriceDifferenceAsBig:function(){return this.hasPrice()?this.getFullPriceAsBig().minus(this.getCurrentPriceAsBig()):null},hasPrice:function(){return this.get("full_price")&&this.get("current_price")},hasDiscount:function(){this.getCurrentPriceAsBig();return this.hasPrice()&&!this.getCurrentPriceAsBig().eq(this.getFullPriceAsBig())}}),u=r.extend({defaults:s.extend(!0,{},r.prototype.defaults,{is_custom:!0})}),d=t.Collection.extend({model:function(e,t){var n=e.type;switch(n){case a.PRODUCT_TYPES.STORE:return new c(e,t);case a.PRODUCT_TYPES.BUNDLE:return new r(e,t);case a.PRODUCT_TYPES.MONTHLY:return new l(e,t);default:return new u(e,t)}}});return{BundleTile:r,MonthlyTile:l,StoreTile:c,TileCollection:d}}),define("bundle/smooth_scroller/smooth_scroller",["require","lib/zenscroll","jquery"],function(e){"use strict";var t=e("lib/zenscroll"),n=e("jquery"),i=t.createScroller(null,680,50),s=t.createScroller(null,680,150),a=function(){var e;return function(){e||(e=n(".js-checkout-scroll-target")),i.to(e[0])}}(),o=function(){var e;return function(){e||(e=n(".js-charity-scroll-target")),s.to(e[0])}}();return{scrollToCheckout:a,scrollToCharity:o}}),define("bundle/main",["require","jquery","bundle/models/User","charity/models","charity/bundle","bundle/image_loader/image_loader","bundle/content_counter/content_counter","orderform/main","bundle/statistics/main","bundle/bonus_items/bonus_items","bundle/choose_your_own_charity/charity_row","bundle/free/captcha","bundleWarnings/main","common/registerGoogleTrackingEvents","common/productTiles/views","common/productTiles/models","bundle/smooth_scroller/smooth_scroller"],function(e){"use strict";var t=e("jquery"),n=e("bundle/models/User"),i=e("charity/models"),s=e("charity/bundle"),a=e("bundle/image_loader/image_loader"),o=e("bundle/content_counter/content_counter"),r=e("orderform/main"),l=e("bundle/statistics/main"),c=e("bundle/bonus_items/bonus_items"),u=e("bundle/choose_your_own_charity/charity_row"),d=e("bundle/free/captcha"),h=e("bundleWarnings/main"),m=e("common/registerGoogleTrackingEvents"),p=e("common/productTiles/views"),f=e("common/productTiles/models"),b=e("bundle/smooth_scroller/smooth_scroller");return function(e,v){var g=new n(e.user),_=new i.CharityList(e.charity_constants.featured_charities),y=v.is_mobile_browser,w=e.remindMeOptions;g.set("has_admin_access",g.get("has_admin_access")&&!y);var k=null;if(e.choose_your_own_charity.productHasCYOC){var C=e.user.charity_id,T=C?C:e.choose_your_own_charity.featuredCharityId;if(T){var S=_.get(T);k={humanName:S.get("human_name"),logoUrl:S.get("logo_url")}}}var j=k?[k]:[];e.charity_row_modals.length&&e.charity_row_modals.forEach(function(e){var t=e.ppgf_info.logo_url||e.resolved_paths.front_page_art_imgix_retina,n={humanName:e.human_name,logoUrl:t};j.push(n)});var x=t(".hr-hero-tile");if(x.length){var O=new f.BundleTile(e.hero_tile),P=new p.HeroTileView({model:O,size:"hero",user:g,hasBanner:!1,isOnBundlePage:!0,charities:j,smoothScroller:b,remindMeOptions:w});x.html(P.render().el)}if(o(t(".js-content-counter"),e.purchases_per_content_event,e.product_machine_name),l.init({productMachineName:e.product_machine_name},y),e.choose_your_own_charity.productHasCYOC){var R=new s.CharityCTAView({el:".js-cyoc-holder",user:g,charities:_,featuredCharityId:e.choose_your_own_charity.featuredCharityId,constants:e.charity_constants,isModal:!0});R.render()}if(new d({el:t(".fi-form")}),c.init(e.bonus_data,y,g.get("has_admin_access")),u({displayItemData:e.charity_row_modals,constants:e.charity_constants,user:g}),r({$el:t(".js-order-form-container"),models:e.order_form,user:g,charities:_,streamlabsEnabled:e.streamlabs_enabled,charityConstants:e.charity_constants,allowedPaymentProcessors:e.allowed_payment_processors,softLockMessages:e.soft_region_lock,isEUCountry:e.isEUCountry}),a.loadImages(),e.soft_region_lock.page_top_warning){var A=new h.PageTopWarningView({el:t("#page-top-messages"),warning:e.soft_region_lock.page_top_warning});A.render()}m(e.product_machine_name)}}),define("lib/hbTemplate!bundle/sticky_navbar/navbar_content.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="dd-navbar-product-name">\n  <%- productHumanName %>\n</div>\n<div class="dd-navbar-purchase-button button green js-dd-navbar-purchase-button">\n  Pay What You Want!\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!sticky_navbar/sticky_navbar.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="sticky-navbar s-hidden js-sticky-navbar">\n  <div class="u-navbar-constrain-width">\n    <div class="dd-navbar-row js-dd-navbar-row">\n      <div class="remindme-countdown-container">\n        <div class="js-dd-navbar-remindme-button"></div>\n        <div class="js-dd-navbar-countdown-view"></div>\n      </div>\n      <div class="dd-navbar-button-list js-dd-navbar-button-list">\n<% _.each(sectionNames, function(sectionName, index) { %>\n        <div class="dd-navbar-button js-dd-navbar-button"\n             data-index="<%= index %>">\n          <span class="section-name"><%= sectionName %></span>\n        </div>\n<% }); %>\n      </div>\n    </div>\n    <div class="u-clear"></div>\n  </div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("sticky_navbar/sticky_navbar",["require","jquery","lib/lodash","hbtemplate!./sticky_navbar.tpl.html","backbone","lib/zenscroll","lib/ScrollMagic","common/DOMLessView"],function(e){"use strict";var t=e("jquery"),n=e("lib/lodash"),i=e("hbtemplate!./sticky_navbar.tpl.html"),s=e("backbone"),a=e("lib/zenscroll"),o=e("lib/ScrollMagic"),r=e("common/DOMLessView"),l=t(".js-navbar"),c=l.outerHeight(!0),u=s.Model.extend({defaults:{sections:[],showing:!1,navbarHeightPx:50},initialize:function(e){this.totalNavHeightPx=c+this.get("navbarHeightPx"),this.initializeScrollMagic()},initializeScrollMagic:function(e){var t=this;this.scrollMagicController=new o.Controller;var i=this,s={triggerHook:.35,offset:this.totalNavHeightPx/-2};if(this.get("hiddenArea")){var a=new o.Scene(n.defaults({triggerElement:this.get("hiddenArea")},s));a.on("enter",function(){i.set("showing",!1)}),a.on("leave",function(){i.set("showing",!0)}),this.addScrollMagicScene(a)}n.each(this.get("sections"),function(e,a){var r=new o.Scene(n.defaults({triggerElement:e},s));r.on("enter",function(){i.set("highlightedSectionIndex",a)}),0===a?r.on("leave",function(){i.unset("highlightedSectionIndex")}):r.on("leave",function(){i.set("highlightedSectionIndex",a-1)}),t.addScrollMagicScene(r)})},addScrollMagicScene:function(e){e.addTo(this.scrollMagicController)},scrollToSection:function(e){var n=t(this.get("sections")[e]),i=n.outerHeight(!0),s=window.innerHeight-this.totalNavHeightPx,o=n.offset().top-this.totalNavHeightPx,r=o;i<=s&&(r+=(s-i)/-2,r=Math.min(r+.15*window.innerHeight,o)),a.toY(r,500)}}),d=r.extend({template:i,events:{"click .js-dd-navbar-button":"onSectionClicked"},ui:{countdownEl:".js-dd-navbar-countdown-view",navbar:".js-sticky-navbar",navbarRow:".js-dd-navbar-row",navbarButtons:".js-dd-navbar-button",remindMeEl:".js-dd-navbar-remindme-button"},initialize:function(e){this.listenTo(this.model,"change:highlightedSectionIndex",this.onHighlightedSectionChange),this.listenTo(this.model,"change:showing",this.onShowingChange)},onSectionClicked:function(e){var n=t(e.currentTarget).data("index");this.model.scrollToSection(n)},onHighlightedSectionChange:function(e){this.ui.navbarButtons.removeClass("s-selected");var t=e.changed.highlightedSectionIndex;void 0===t?e.set("showing",!1):(e.set("showing",!0),this.ui.navbarButtons.eq(t).addClass("s-selected"))},onShowingChange:function(e){e.changed.showing?(this.ui.navbar.removeClass("s-hidden").addClass("s-fixed js-maintain-scrollbar-on-dropdown"),l&&l.addClass("hide-box-shadow")):(this.ui.navbar.removeClass("s-fixed js-maintain-scrollbar-on-dropdown").addClass("s-hidden"),l&&l.removeClass("hide-box-shadow"))}});return{Model:u,View:d}}),define("lib/hbTemplate!monthly/2018redesign/common/templates/countdown_timer.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return"<div class='countdown-timer-counter js-countdown-timer-counter' data-unit=\"days\">\n  <div class=\"countdown-timer-number js-countdown-timer-number\"><%= days > 9 ? days : '0' + days %></div>\n  <label>days</label>\n</div>\n<div class='countdown-timer-counter js-countdown-timer-counter' data-unit=\"hours\">\n  <div class=\"countdown-timer-number js-countdown-timer-number\"><%= hours > 9 ? hours : '0' + hours %></div>\n  <label>hours</label>\n</div>\n<div class='countdown-timer-counter js-countdown-timer-counter' data-unit=\"minutes\">\n  <div class=\"countdown-timer-number js-countdown-timer-number\"><%= minutes > 9 ? minutes : '0' + minutes %></div>\n  <label>min</label>\n</div>\n<div class='countdown-timer-counter js-countdown-timer-counter' data-unit=\"seconds\">\n  <div class=\"countdown-timer-number js-countdown-timer-number\"><%= seconds > 9 ? seconds : '0' + seconds %></div>\n  <label>sec</label>\n</div>\n".replace(/xSTATIC_URLx/g,t)}()}),define("countdownTimer/countdownTimerModel",["require","backbone","lib/moment"],function(e){"use strict";const t=e("backbone"),n=e("lib/moment");var i=t.Model.extend({initialize:function(e){this.set({endTime:n.utc(e.endTime),atTime:n.utc(e.atTime)}),this.updateInterval=setInterval(this.updateTimes.bind(this),500),this.updateTimes()},updateTimes:function(){var e=this.getTimesTillEnd();this.set({days:e.days,hours:e.hours,minutes:e.minutes,seconds:e.seconds}),0===e.days&&0===e.hours&&0===e.minutes&&0===e.seconds&&clearInterval(this.updateInterval)},getTimesTillEnd:function(){var e=new Date,t=this.get("endTime");return e>t?{days:0,hours:0,minutes:0,seconds:0}:{days:this.getNumDaysBetweenTimes(e,t),hours:this.getNumHoursBetweenTimes(e,t),minutes:this.getNumMinutesBetweenTimes(e,t),seconds:this.getNumSecondsBetweenTimes(e,t)}},getNumDaysBetweenTimes:function(e,t){return Math.floor((t-e)/864e5)},getNumHoursBetweenTimes:function(e,t){return Math.floor((t-e)/36e5%24)},getNumMinutesBetweenTimes:function(e,t){return Math.floor((t-e)/6e4%60)},getNumSecondsBetweenTimes:function(e,t){return Math.floor((t-e)/1e3%60)}});return i}),define("monthly/2018redesign/common/countdown_timer",["require","jquery","hbtemplate!./templates/countdown_timer.tpl.html","common/DOMLessView","countdownTimer/countdownTimerModel"],function(e){"use strict";var t=e("jquery"),n=e("hbtemplate!./templates/countdown_timer.tpl.html"),i=e("common/DOMLessView"),s=e("countdownTimer/countdownTimerModel"),a=i.extend({template:n,ui:{days:".js-countdown-timer-counter[data-unit=days] .js-countdown-timer-number",hours:".js-countdown-timer-counter[data-unit=hours] .js-countdown-timer-number",minutes:".js-countdown-timer-counter[data-unit=minutes] .js-countdown-timer-number",seconds:".js-countdown-timer-counter[data-unit=seconds] .js-countdown-timer-number"},initialize:function(){this.listenTo(this.model,"change:days",this.onNumberChange),this.listenTo(this.model,"change:hours",this.onNumberChange),this.listenTo(this.model,"change:minutes",this.onNumberChange),this.listenTo(this.model,"change:seconds",this.onNumberChange)},onNumberChange:function(e){for(var t in e.changed){var n=e.changed[t];this.ui[t].text(n>9?n:"0"+n)}}}),o=function(e){var n=e.countdownTimerOptions;return new a({el:t('<div class="countdown-timer js-countdown-timer">'),model:new s({atTime:n.at_time,endTime:n.end_time})})};return{init:o}}),define("bundle/sticky_navbar/sticky_navbar",["require","jquery","hbtemplate!./navbar_content.tpl.html","bundle/smooth_scroller/smooth_scroller","sticky_navbar/sticky_navbar","common/DOMLessView","monthly/2018redesign/common/countdown_timer","remindMe/views"],function(e){"use strict";var t=e("jquery"),n=e("hbtemplate!./navbar_content.tpl.html"),i=e("bundle/smooth_scroller/smooth_scroller"),s=e("sticky_navbar/sticky_navbar"),a=e("common/DOMLessView"),o=e("monthly/2018redesign/common/countdown_timer"),r=e("remindMe/views"),l=a.extend({template:n,events:{"click .js-dd-navbar-purchase-button":"onPurchaseButtonClicked"},serializeData:function(){return{productHumanName:this.options.productHumanName}},onPurchaseButtonClicked:function(){i.scrollToCheckout()}}),c=function(e){var n=e.sectionNames,i=e.productHumanName,a=e.countdownTimerOptions,c=e.remindMeOptions,u=new s.Model({hiddenArea:"#js-navbar-hidden-area",sections:t(".js-nav-row"),sectionNames:n}),d=new s.View({model:u}).render(),h=new l({productHumanName:i}).render(),m=o.init({countdownTimerOptions:a}).render();d.ui.countdownEl.html(m.el);var p=new r.RemindMeIconView(c).render();return d.ui.remindMeEl.html(p.el),d.ui.navbarRow.append(h.el),t("body").append(d.el),u};return{init:c}}),define("bundle/slideout/soundtrackPlayer",["lib/jquery/full"],function(e){"use strict";function t(t){e("body").append(l),l.jPlayer({ready:function(){},swfPath:t,supplied:"mp3, m4a",useStateClassSkin:!0,autoBlur:!1,smoothPlayBar:!1})}function n(e){i(e),l.jPlayer("play")}function i(t){var n=e(t);n.addClass("playing"),l.jPlayer("setMedia",{title:n.data("title"),mp3:n.data("url")})}function s(){e(".soundtrack-listing .track-play, .soundtrack-listing .track-number, .soundtrack-listing .track-name").click(function(t){o(),u=e(this).closest(".track"),n(u)}),l.bind(e.jPlayer.event.timeupdate,function(t){t.jPlayer.status.currentTime>0&&e(".jp-play.loading").length&&(e(".jp-play.loading").removeClass("loading hb-play").addClass("hb-pause"),u.find(".track-play").removeClass("hb-spinner hb-play").addClass("hb-pause"));var n=t.jPlayer.status.currentPercentAbsolute/100,i=c.find(".jp-progress").width(),s=n*i;c.find(".jp-play-dot").css("left",s-3+"px");var a=t.jPlayer.status.duration;a!==1/0&&a||(a=e(".track.playing ").data("duration"));for(var o=Math.ceil(a-t.jPlayer.status.currentTime),r=Math.floor(o/60).toString(),l=(o%60).toString();r.length<2;)r="0"+r;for(;l.length<2;)l="0"+l;c.find(".jp-remaining").text(r+":"+l)}),l.bind(e.jPlayer.event.pause,function(e){c.find(".jp-play").removeClass("hb-pause loading").addClass("hb-play"),u.find(".track-play").removeClass("hb-pause hb-loading").addClass("hb-play")}),l.bind(e.jPlayer.event.play,function(e){c.find(".jp-play").removeClass("hb-play hb-pause").addClass("loading"),u.find(".track-play").removeClass("hb-play hb-pause").addClass("hb-spinner")}),l.bind(e.jPlayer.event.ended,function(t){u=e(".track.playing"),i(u)})}function a(t,n){if(o(),c.find(".jp-play").removeClass("hb-pause").addClass("hb-play"),c.find(".jp-no-solution").hide(),null!=t&&t.length>0){s();var a="jp-container-"+n;l.jPlayer("option","cssSelectorAncestor","#"+a),c=e("#"+a);var r=t.find(".track")[0];u=e(r),i(r)}}function o(){l.jPlayer("stop"),l.jPlayer("setMedia",{}),e(".track.playing").removeClass("playing"),u.find(".track-play").removeClass("hb-pause hb-spinner").addClass("hb-play")}var r="music-slideout-jplayer",l=e('<div id="'+r+'" class="jp-jplayer"></div>'),c=e(),u=e();return{init:t,setActivePopup:a}}),define("lib/hbTemplate!bundle/slideout/desktop_slideout_container.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div class="slideout-up-arrow js-slideout-arrow">\n  <div class="slideout-inner-triangle"></div>\n</div>\n\n<div class="close-slideout js-close-slideout">\n  <span class="close js-no-click">X</span>\n</div>\n\n<div class="desktop-slideout-content-container js-desktop-slideout-content-container"></div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!bundle/slideout/desktop_slideout_content.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<div>\n  <div class="navigation-content left js-prev-item">\n    <i class="center hb hb-angle-left js-no-click"></i>\n  </div>\n  <div class="navigation-content right js-next-item">\n    <i class="center hb hb-angle-right js-no-click"></i>\n  </div>\n</div>\n\n<% if (hasMedia) { %>\n  <div class="desktop-slideout-media js-desktop-slideout-media">\n  <% if (render_admin_links) { %>\n    <span class="js-admin-edit" data-entity-kind="display_item"></span>\n  <% } %>\n    <span class="image-holder hb js-image-holder"></span>\n    <div id="js-youtube-target"></div>\n    <i class="hb hb-spinner hb-spin media-load-spinner js-media-load-spinner"></i>\n  <%= book_preview_html %>\n  <%= soundtrack_player_html %>\n  </div>\n<% } %>\n\n<div class="desktop-slideout-body js-desktop-slideout-body\n            <% if (is_text_slideout) { %> text-slideout <% } %>\n            <% if (!hasMedia) { %> full-width <% } %>">\n  <h1 class="desktop-slideout-content-heading">\n<% if (render_admin_links) { %>\n    <span class="js-admin-edit" data-entity-kind="display_item" data-anchor-name="#human-name_anchor"></span>\n<% } %>\n<%- human_name %>\n  </h1>\n<%= developers_info_html %>\n<%= availability_icons_html %>\n\n<% if (render_admin_links) { %>\n  <span class="js-admin-edit" data-entity-kind="display_item" data-anchor-name="#description-text_anchor"></span>\n<% } %>\n  <div class="desktop-slideout-text js-slideout-text">\n<% if (rating_info) { %>\n    <div class="slideout-rating">\n  <% if (render_admin_links) { %>\n      <span class="js-admin-edit" data-entity-kind="display_item" data-anchor-name="#<%- rating_info.system %>-rating_anchor"></span>\n  <% } %>\n      <span class="rating-icon">\n        <i class="rating <%- rating_info.system %> <%- rating_info.rating_icon %>"></i>\n      </span>\n      <ul class="rating-details">\n  <% _.each(rating_info.rating_details, function(rating_detail) { %>\n        <li><%- rating_detail %></li>\n  <% }); %>\n      </ul>\n    </div>\n<% } %>\n<% if (has_soundtracks) { %>\n  <% if (soundtrack_listing.hide_listing) { %>\n    <div class="soundtracks-hidden"><%= soundtrack_listing_html %></div>\n  <% } else { %>\n      <%= soundtrack_listing_html %>\n  <% } %>\n<% } %>\n    <div><%= description_text %></div>\n    <br />\n  </div>\n</div>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!bundle/slideout/slideout_availability_icons.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<% if (availability_icons && availability_icons.delivery_icons) { %>\n  <% if (render_admin_links) { %>\n<div class="js-admin-edit" data-entity-kind="display_item" data-anchor-name="#content_anchor"></div>\n  <% } %>\n<div class="slideout-availability-icons">\n  <% _.each(availability_icons.delivery_icons, function(availability_icon) { %>\n    <% var has_platform_icons = (availability_icons.delivery_to_platform[availability_icon] && availability_icons.delivery_to_platform[availability_icon].available.length); %>\n  <div class="slideout-availability-icon-container">\n    <div class="slideout-availability-icon-wrapper <% if (has_platform_icons) { %>has-delivery-icons<% } %>">\n      <i class="hb <%= availability_icon %> slideout-availability-icon"></i>\n    </div>\n    <% if (has_platform_icons) { %>\n    <div class="slideout-platforms">\n      <% _.each(availability_icons.delivery_to_platform[availability_icon].available, function(icon_class) { %>\n    <i class="hb <%= icon_class %> slideout-platform"></i>\n      <% }); %>\n    </div>\n    <% } %>\n  </div>\n  <% }); %>\n</div>\n<% } %>'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!bundle/slideout/slideout_book_preview.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<% if (book_preview) { %>\n<div class="preview-overlay">\n  <% if (book_preview.preview_file_link) { %>\n  <a class=\'preview-download-link\' href=\'<%- book_preview.preview_file_link %>\' target=\'_blank\'>\n  <% } %>\n    <div class="preview-icon preview-icon-<%- book_preview.preview_icon %>">\n  <% if (render_admin_links) { %>\n      <div class="js-admin-edit" data-entity-kind="display_item" data-anchor-name="#image_extra_anchor"></div>\n  <% } %>\n      <span class="preview-text"><% if (book_preview.preview_prefix) { %><%- book_preview.preview_prefix %><% } %> Preview</span>\n      <span class="preview-size">(<%- book_preview.preview_file_type %>, <%- book_preview.preview_file_size %>)</span>\n    </div>\n  <% if (book_preview.preview_file_link) { %>\n  </a>\n  <% } %>\n</div>\n<% } %>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!bundle/slideout/slideout_developers_info.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<% if (developers && developers.length) { %>\n<div class="<%- layout %>-slideout-content-developers">\n  <% if (render_admin_links) { %>\n      <div class="js-admin-edit" data-entity-kind="display_item" data-anchor-name="#developers_anchor"></div>\n  <% } %>\n  <% _.each(developers, function(developer, i) { %>\n    <% if (developer.developer_url) { %>\n  <a class="slideout-content-dev-anchor" href="<%- developer.developer_url %>" target="_blank" rel="nofollow">\n    <% } %>\n  <span class="slideout-content-dev-name"><%- developer.developer_name %></span>\n    <% if (developer.developer_url) { %>\n  </a>\n    <% } %>\n    <% if (i < developers.length - 1) { %>\n  <span class="slideout-content-developer-separator">|</span>\n    <% } %>\n  <% }); %>\n</div>\n<% } %>\n\n<% if (publishers && publishers.length) { %>\n<div class="<%- layout %>-slideout-content-developers">\n  <% if (render_admin_links) { %>\n      <div class="js-admin-edit" data-entity-kind="display_item" data-anchor-name="#publishers_anchor"></div>\n  <% } %>\n  <% _.each(publishers, function(publisher, i) { %>\n    <% if (publisher.publisher_url) { %>\n  <a class="slideout-content-dev-anchor" href="<%- publisher.publisher_url %>" target="_blank" rel="nofollow">\n    <% } %>\n  <span class="slideout-content-dev-name"><%- publisher.publisher_name %></span>\n    <% if (publisher.publisher_url) { %>\n  </a>\n    <% } %>\n    <% if (i < publishers.length - 1) { %>\n  <span class="slideout-content-developer-separator">|</span>\n    <% } %>\n  <% }); %>\n</div>\n<% } %>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!bundle/slideout/slideout_soundtrack_player.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<% if (num_tracks) { %>\n<div id="jp-container-<%- machine_name %>" class="jp-audio" role="application">\n  <div class="jp-gui">\n    <div class="jp-play hb hb-play"></div><div class="jp-details">\n      <div class="jp-title">&nbsp;</div>\n      <div class="jp-time-info">\n        <div class="jp-progress">\n          <div class="jp-seek-bar">\n            <div class="jp-play-bar"></div>\n            <div class="jp-play-dot hb hb-circle"></div>\n          </div>\n        </div><div class="jp-remaining" role="timer">&nbsp;</div>\n      </div>\n    </div>\n  </div>\n  <div class="jp-no-solution">\n    <span>Update Required</span>\n    To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.\n  </div>\n</div>\n<% } %>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("lib/hbTemplate!bundle/slideout/slideout_soundtrack_item.tpl.html",function(){return function(){var e="www.humblebundle.com"===window.location.hostname,t=e?"https://humblebundle-a.akamaihd.net":"";return'<% if (tracks) { %>\n<div class="soundtrack-listing">\n  <% if (render_admin_links) { %>\n    <div class="js-admin-edit" data-entity-kind="display_item" data-anchor-name="#soundtrack-listing_anchor"></div>\n  <% } %>\n  <div class="soundtrack-listing-container">\n  <% _.each(tracks, function(track) { %>\n    <div class="track" data-title="<%- track.track_name %>"\n      data-duration="<%- track.preview_length || 30 %>"\n      data-url="<%- track.preview_url || \'\' %>">\n      <span class="track-title">\n        <span class="track-play hb hb-play"></span>\n        <span class="track-number"><%- track.track_number %>.</span>\n        <span class="track-name" title="<%- track.track_name %>"><%- track.track_name %></span>\n      </span>\n      <span class="track-length"><%- track.track_length %></span>\n    </div>\n  <% }); %>\n  </div>\n</div>\n<% } %>\n'.replace(/xSTATIC_URLx/g,t)}()}),define("bundle/slideout/desktop_slideout",["require","jquery","backbone","lib/lodash","lib/zenscroll","bundle/slideout/soundtrackPlayer","adminLinks/main","hbtemplate!./desktop_slideout_container.tpl.html","hbtemplate!./desktop_slideout_content.tpl.html","hbtemplate!./slideout_availability_icons.tpl.html","hbtemplate!./slideout_book_preview.tpl.html","hbtemplate!./slideout_developers_info.tpl.html","hbtemplate!./slideout_soundtrack_player.tpl.html","hbtemplate!./slideout_soundtrack_item.tpl.html"],function(e){"use strict";var t,n=e("jquery"),i=e("backbone"),s=e("lib/lodash"),a=e("lib/zenscroll"),o=(a.createScroller(document.body,500,0),e("bundle/slideout/soundtrackPlayer")),r=e("adminLinks/main"),l=e("hbtemplate!./desktop_slideout_container.tpl.html"),c=e("hbtemplate!./desktop_slideout_content.tpl.html"),u=e("hbtemplate!./slideout_availability_icons.tpl.html"),d=e("hbtemplate!./slideout_book_preview.tpl.html"),h=e("hbtemplate!./slideout_developers_info.tpl.html"),m=e("hbtemplate!./slideout_soundtrack_player.tpl.html"),p=e("hbtemplate!./slideout_soundtrack_item.tpl.html");e(["lib/youtube"],function(e){e.onLoad(function(){t=window.YT})});var f=i.Model.extend({}),b=i.View.extend({contentTemplate:s.template(c),iconsTemplate:s.template(u),pdfPreviewTemplate:s.template(d),developersTemplate:s.template(h),soundtrackPlayerTemplate:s.template(m),soundtrackItemsTemplate:s.template(p),className:"desktop-slideout-content",initialize:function(e){this.displayItem=e.displayItem,this.renderAdminLinks=e.renderAdminLinks&&"giving_fund"!=e.displayItem.machine_name,this.hasMedia=this.checkForMedia(),this.initialRender()},initialRender:function(){this.hasSoundtracks=this.displayItem.soundtrack_listing&&this.displayItem.soundtrack_listing.tracks.length>0;var e=1,t=this.displayItem.soundtrack_listing&&this.displayItem.soundtrack_listing.tracks.length<=e,n={rating_info:this.displayItem.rating_info,human_name:this.displayItem.human_name,soundtrack_listing:this.displayItem.soundtrack_listing,has_soundtracks:this.hasSoundtracks,is_text_slideout:t,description_text:this.displayItem.description_text,render_admin_links:this.renderAdminLinks,hasMedia:this.hasMedia};n.availability_icons_html=this.iconsTemplate({availability_icons:this.displayItem.availability_icons,render_admin_links:this.renderAdminLinks}),n.book_preview_html=this.pdfPreviewTemplate({book_preview:this.displayItem.book_preview,render_admin_links:this.renderAdminLinks}),n.developers_info_html=this.developersTemplate({developers:this.displayItem.developers,publishers:this.displayItem.publishers,layout:"desktop",render_admin_links:this.renderAdminLinks}),this.displayItem.soundtrack_listing?(n.soundtrack_player_html=this.soundtrackPlayerTemplate({num_tracks:this.displayItem.soundtrack_listing.tracks.length,machine_name:this.displayItem.machine_name}),n.soundtrack_listing_html=this.soundtrackItemsTemplate({tracks:this.displayItem.soundtrack_listing.tracks,render_admin_links:this.renderAdminLinks})):n.soundtrack_player_html="";var i=this.contentTemplate(n);this.$el.html(i),this.$el.attr("data-slideout",this.displayItem.machine_name),this.mediaDimensions={maxWidth:600,width:"100%",height:350},this.displayItem.youtube_link?this.$(".desktop-slideout-media").css("max-height",this.mediaDimensions.height+"px"):this.displayItem.preview_image&&this.insertImage(this.displayItem.preview_image),r.renderTinyLinks({displayItemMachineName:this.displayItem.machine_name},this.$(".js-admin-edit"));
},checkForMedia:function(){return this.displayItem.youtube_link||this.displayItem.preview_image||this.displayItem.book_preview||this.displayItem.soundtrack_listing&&this.displayItem.soundtrack_listing.tracks.length},insertYoutubeVideo:function(){new t.Player("js-youtube-target",{width:this.mediaDimensions.width,height:this.mediaDimensions.height,videoId:this.displayItem.youtube_link,playerVars:{rel:0,showinfo:0,vq:"large",iv_load_policy:3,wmode:"transparent"}});this.$(".js-media-load-spinner").remove()},insertImage:function(e){this.$(".js-media-load-spinner").remove();var t=this.loadImage(e,function(){var e=n(t);this.$(".js-image-holder").after(t),this.$(".js-media-load-spinner").remove(),this.$(".preview-overlay").show(),e.addClass("slideout-image"),(this.displayItem.youtube_link||e.width()>this.mediaDimensions.maxWidth)&&(t.style.maxWidth=this.mediaDimensions.maxWidth+"px",t.style.width=this.mediaDimensions.width)}.bind(this))},loadImage:function(e,t){var n=new Image;return n.src=e,n.onload=t,n},teardown:function(){this.$el.empty()}}),v=i.View.extend({template:s.template(l),className:"desktop-slideout-container",initialize:function(e){this.renderAdminLinks=e.renderAdminLinks,this.calculateDisplayItemFlexOrder(),this.addSlideoutHolders(),this.setDisplayItemListeners(),this.currentItemMachineName="",this.$currentSlideout=null},calculateDisplayItemFlexOrder:function(){var e=n(".dd-image-box-list, .bonus-items-container, .ch-body");s.each(e,function(e){var t=n(e),i=t.outerWidth(!1),s=0,a=0;t.children().each(function(){var e=n(this),t=e.outerWidth(!0);a+t>i&&(s+=2,a=0),a+=t,e.css("order",s)})})},addSlideoutHolders:function(){var e=n("<span>").addClass("slideout-holder js-slideout-holder"),t=n(".dd-image-box-list, .bonus-items-container, .ch-body");t.addClass("js-slideout-items-row"),t.append(e)},setDisplayItemListeners:function(){var e=this,t=this.model.get("displayItems"),i=n("[data-slideout]");i.each(function(s){var a=n(this),o=a.data("slideout");t[o]&&a.on("click",function(n){if(e.alreadyClicked(n))return void n.stopPropagation();if(e.currentItemMachineName===o)e.hideSlideout();else{var r=s-1>=0?i[s-1]:null,l=s+1<i.length?i[s+1]:null;e.showSlideout(a,t[o],r,l)}})});var s=this;n(window).resize(function(){s.handleResize()})},teardownSubView:function(){this.subview&&(this.subview.teardown(),this.subview=null),o.setActivePopup(null)},removePaddingBelowSlideout:function(){if(this.$currentSlideout){var e=this.$currentSlideout.siblings(),t=e.length?n(e[e.length-1]):null;if(t&&t.css("order")<=this.$currentSlideout.css("order")){var i=this.$currentSlideout.parent();this.paddingBelowSlideout=i.css("padding-bottom"),i.css("padding-bottom",0)}}},restorePaddingBelowSlideout:function(){this.paddingBelowSlideout&&this.$currentSlideout&&(this.$currentSlideout.parent().css("padding-bottom",this.paddingBelowSlideout),this.paddingBelowSlideout=null)},hideSlideout:function(){this.restorePaddingBelowSlideout(),this.currentItemMachineName="",this.$currentSlideout=null,this.$(".js-slideout-arrow").hide(),n(".slideout-holder").slideUp({duration:150}),this.teardownSubView(),n(document).unbind("keydown",this.currentKeydownHandler)},showSlideout:function(e,t,i,s){if(t.is_clickable){this.teardownSubView(),this.restorePaddingBelowSlideout(),this.currentItemMachineName=t.machine_name,this.$currentSlideout=e.closest(".js-slideout-items-row").find(".js-slideout-holder");var r=this.isSlideoutOpen();n(".js-slideout-holder").not(this.$currentSlideout).hide(),this.$currentSlideout.css("order",Number(e.parent().css("order"))+1),a.to(e[0]),r||(this.renderSlideoutFrame(),this.setupCloseSlideout()),this.renderSlideoutContent(t),this.setupNavigation(i,s),_gaTrackEventNoninteractive(void 0,"Product details slideout",this.currentItemMachineName),t.soundtrack_listing&&t.soundtrack_listing.tracks.length>0&&o.setActivePopup(this.subview.$el,this.currentItemMachineName),this.removePaddingBelowSlideout();var l=this;this.$currentSlideout.slideDown({complete:function(){l.adjustArrow(e,r),l.adjustDescriptionFader(),r||l.insertYoutubeVideo()},duration:150})}},setupNavigation:function(e,t){var i=this.$(".js-prev-item");null!==e?(i.show(),i.unbind("click"),i.click(function(){n(e).click()})):i.hide();var s=this.$(".js-next-item");null!==t?(s.show(),s.unbind("click"),s.click(function(){n(t).click()})):s.hide();var a=function(i){"ArrowLeft"===i.key?null!==e&&n(e).click():"ArrowRight"===i.key&&null!==t&&n(t).click()};n(document).unbind("keydown",this.currentKeydownHandler),this.currentKeydownHandler=a,n(document).bind("keydown",this.currentKeydownHandler)},setupCloseSlideout:function(){var e=this,t=this.$(".js-close-slideout");t.click(function(){e.hideSlideout()})},isSlideoutOpen:function(){return this.$currentSlideout.is(":visible")},alreadyClicked:function(e){return e.originalEvent&&(e.originalEvent.detail>1||n(e.srcElement).hasClass("js-no-click"))},handleResize:function(){if(this.calculateDisplayItemFlexOrder(),null!=this.$currentSlideout){var e=n('div[data-slideout="'+this.currentItemMachineName+'"]');this.$currentSlideout.css("order",Number(e.css("order"))+1),this.adjustArrow(e)}},adjustArrow:function(e,t){var n=this.$(".js-slideout-arrow");t?n.addClass("animate"):(n.removeClass("animate"),n.show());var i=e.offset().left+e.outerWidth(!0)/2,s=n.parent().offset().left,a=i-(s+n.outerWidth()/2);n.css("left",a);var o=-n.outerHeight(!0);n.css("top",o)},adjustDescriptionFader:function(){var e=this.$(".js-slideout-text"),t=e.innerHeight(),n=e[0].scrollHeight;t<n&&e.addClass("fade")},renderSlideoutFrame:function(){var e=this.template({});this.$el.html(e),this.$currentSlideout.append(this.$el);var t=this;this.$(".js-slideout-arrow")[0].addEventListener("transitionend",function(){t.insertYoutubeVideo()})},renderSlideoutContent:function(e){var t=new b({model:this.model,displayItem:e,renderAdminLinks:this.renderAdminLinks});this.subview=t;var i=n(".js-desktop-slideout-content-container");i.empty(),i.append(t.$el)},insertYoutubeVideo:function(){this.subview.displayItem.youtube_link&&this.subview.insertYoutubeVideo()}}),g=function(e){var t=e.displayItems,n=new f({displayItems:t}),i=new v({model:n,renderAdminLinks:e.renderAdminLinks});return o.init(e.jQueryPlayerPath),{model:n,view:i}};return{init:g}}),define("bundle/desktop_main",["require","jquery","lib/lodash","bundle/main","bundle/sticky_navbar/sticky_navbar","util/main","bundle/slideout/desktop_slideout"],function(e){"use strict";function t(e,t){var o=e.user.is_logged_in,r=e.product_machine_name,l=e.product_human_name,c=e.user.remind_me_products,u=!!o&&n.includes(c,r),d=new Backbone.Model({isReminded:u}),h={productMachineName:r,productHumanName:l,model:d,isLoggedIn:o};e.remindMeOptions=h,i(e,t);s.init({sectionNames:e.sticky_navbar,productHumanName:e.product_human_name,countdownTimerOptions:e.countdown_timer_vars,remindMeOptions:h});a.init({displayItems:e.slideout_data.display_items,jQueryPlayerPath:e.slideout_data.soundtrack_player_path,renderAdminLinks:e.user.has_admin_access})}var n=(e("jquery"),e("lib/lodash")),i=e("bundle/main"),s=e("bundle/sticky_navbar/sticky_navbar"),a=(e("util/main"),e("bundle/slideout/desktop_slideout"));return{init:t}});
//# sourceMappingURL=desktop_main.js.map